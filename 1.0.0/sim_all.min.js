var sim_states=new Object();var sim_events=new Object();var sim_signals=new Object();var fire_stack=new Array();var syntax_behavior=new Object();syntax_behavior.PRINT_S={nparameters:2,types:["S"],operation:function(a){console.log(a[1]+": "+sim_signals[a[1]].value)}};syntax_behavior.PRINT_E={nparameters:2,types:["E"],operation:function(a){console.log(a[1]+": "+sim_states[a[1]].value)}};var MC=new Object();var ROM=new Object();var FIRMWARE=new Object();sim_states.BR=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];sim_states.REG_PC={name:"PC",visible:true,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.REG_MAR={name:"MAR",visible:true,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.REG_MBR={name:"MBR",visible:true,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.REG_IR={name:"IR",visible:true,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.REG_RT1={name:"RT1",visible:true,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.REG_RT2={name:"RT2",visible:true,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.REG_RT3={name:"RT3",visible:true,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.REG_SR={name:"SR",visible:true,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.BUS_IB={name:"I_BUS",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.BUS_AB={name:"A_BUS",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.BUS_CB={name:"C_BUS",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.BUS_DB={name:"D_BUS",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.C2_T2={name:"C2_T2",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.RA_T9={name:"RA_T9",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.RB_T10={name:"RB_T10",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.SELEC_T3={name:"SELEC_T3",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.RBS_M1={name:"RBS_M1",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.WBS_TD={name:"WBS_TD",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.SELP_M7={name:"SELP_M7",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.SUM4_M2={name:"SUM4_M2",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.ALU_C6={name:"ALU_C6",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.MA_ALU={name:"MA_ALU",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.MB_ALU={name:"MB_ALU",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.FLAG_O={name:"FLAG_O",visible:true,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.FLAG_N={name:"FLAG_N",visible:true,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.FLAG_Z={name:"FLAG_Z",visible:true,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.FLAG_I={name:"FLAG_I",visible:true,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.FLAG_U={name:"FLAG_U",visible:true,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.REG_MICROADDR={name:"µADDR",visible:true,nbits:"12",value:0,default_value:0,draw_data:["svg_cu:text4667"]};sim_states.REG_MICROINS={name:"µINS",visible:true,nbits:"77",value:{SELA:0,SELB:0,SELE:0,COP:0},default_value:{SELA:0,SELB:0,SELE:0,COP:0},draw_data:[]};sim_states.FETCH={name:"FETCH",visible:false,nbits:"12",value:0,default_value:0,draw_data:[]};sim_states.ROM_MUXA={name:"ROM_MUXA",visible:false,nbits:"12",value:0,default_value:0,draw_data:[]};sim_states.SUM_ONE={name:"SUM_ONE",visible:false,nbits:"12",value:1,default_value:1,draw_data:[]};sim_states.MUXA_MICROADDR={name:"MUXA_MICROADDR",visible:false,nbits:"12",value:0,default_value:0,draw_data:[]};sim_states.MUXC_MUXB={name:"MUXC_MUXB",visible:false,nbits:"1",value:0,default_value:0,draw_data:[]};sim_states.WBS_TD={name:"WBS_TD",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.RBS_TD={name:"RBS_TD",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.INTV={name:"INTV",visible:false,nbits:"8",value:0,default_value:0,draw_data:[]};sim_states.M2_C2={name:"M2_C2",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.M1_C1={name:"M1_C1",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.M7_C7={name:"M7_C7",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.VAL_ZERO={name:"VAL_ZERO",visible:false,nbits:"1",value:0,default_value:0,draw_data:[]};sim_states.VAL_ONE={name:"VAL_ONE",visible:false,nbits:"32",value:1,default_value:1,draw_data:[]};sim_states.VAL_FOUR={name:"VAL_FOUR",visible:false,nbits:"32",value:4,default_value:4,draw_data:[]};sim_states.REG_IR_DECO={name:"IR_DECO",visible:true,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.DECO_INS={name:"DECO_INS",visible:true,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.CLK={name:"CLK",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_signals.C={name:"C",visible:true,type:"L",value:0,default_value:0,nbits:"4",behavior:["MV MUXC_MUXB VAL_ZERO; FIRE B","MV MUXC_MUXB INT; FIRE B","MV MUXC_MUXB IORDY; FIRE B","MV MUXC_MUXB MRDY; FIRE B","MBIT_I MUXC_MUXB REG_SR 0 1; FIRE B","MBIT_I MUXC_MUXB REG_SR 1 1; FIRE B","MBIT_I MUXC_MUXB REG_SR 29 1; FIRE B","MBIT_I MUXC_MUXB REG_SR 30 1; FIRE B","MBIT_I MUXC_MUXB REG_SR 31 1; FIRE B"],fire_name:["svg_cu:text3410"],draw_data:[["svg_cu:path3108"],["svg_cu:path3062"],["svg_cu:path3060"],["svg_cu:path3136"],["svg_cu:path3482"],["svg_cu:path3480"],["svg_cu:path3488"],["svg_cu:path3486"],["svg_cu:path3484"]],draw_name:[[]]};sim_signals.B={name:"B",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["MV_ES A1 MUXC_MUXB; FIRE A1","NOT_ES A1 MUXC_MUXB; FIRE A1"],fire_name:["svg_cu:text3408"],draw_data:[["svg_cu:path3370"],["svg_cu:path3392","svg_cu:path3372","svg_cu:path3390","svg_cu:path3384"]],draw_name:[[],["svg_cu:path3420"]]};sim_signals.A0={name:"A0",visible:false,type:"L",value:0,default_value:0,nbits:"1",behavior:["SBIT_S A0A1 A0 1; FIRE A0A1","SBIT_S A0A1 A0 1; FIRE A0A1"],fire_name:["svg_cu:text3406"],draw_data:[[]],draw_name:[["svg_cu:path3096"]]};sim_signals.A1={name:"A1",visible:false,type:"L",value:0,default_value:0,nbits:"1",behavior:["SBIT_S A0A1 A1 0; FIRE A0A1","SBIT_S A0A1 A1 0; FIRE A0A1"],fire_name:[],draw_data:[[],["svg_cu:path3094"]],draw_name:[[]]};sim_signals.A0A1={name:"A0A1",visible:true,type:"L",value:0,default_value:0,nbits:"2",behavior:["ADD MUXA_MICROADDR REG_MICROADDR SUM_ONE","MV_EE MUXA_MICROADDR REG_MICROINS/MADDR","MV MUXA_MICROADDR ROM_MUXA","MV MUXA_MICROADDR FETCH"],fire_name:[],draw_data:[["svg_cu:path3102","svg_cu:path3100","svg_cu:path3098","svg_cu:path3100-9","svg_cu:path3088"],["svg_cu:path3104","svg_cu:path3134","svg_cu:path3500","svg_cu:path3416"],["svg_cu:path3504","svg_cu:path3100-8","svg_cu:path3234-9"],["svg_cu:path3124"]],draw_name:[[]]};sim_signals.C0={name:"C0",visible:true,type:"E",value:0,default_value:0,nbits:"1",behavior:["NOP","MV REG_MAR BUS_IB"],fire_name:["svg_p:text3077"],draw_data:[["svg_p:path3081"]],draw_name:[["svg_p:path3075"]]};sim_signals.C1={name:"C1",visible:true,type:"E",value:0,default_value:0,nbits:"1",behavior:["NOP","MV REG_MBR M1_C1"],fire_name:["svg_p:text3079"],draw_data:[["svg_p:path3055"]],draw_name:[["svg_p:path3073"]]};sim_signals.C2={name:"C2",visible:true,type:"E",value:0,default_value:0,nbits:"1",behavior:["NOP","MV REG_PC M2_C2"],fire_name:["svg_p:text3179"],draw_data:[["svg_p:path3485"]],draw_name:[["svg_p:path3177"]]};sim_signals.C3={name:"C3",visible:true,type:"E",value:0,default_value:0,nbits:"1",behavior:["NOP","MV REG_IR BUS_IB; DECO"],fire_name:["svg_p:text3439"],draw_data:[["svg_p:path3339"]],draw_name:[["svg_p:path3337"]]};sim_signals.C4={name:"C4",visible:true,type:"E",value:0,default_value:0,nbits:"1",behavior:["NOP","MV REG_RT1 BUS_IB"],fire_name:["svg_p:text3441"],draw_data:[["svg_p:path3263"]],draw_name:[["svg_p:path3255"]]};sim_signals.C5={name:"C5",visible:true,type:"E",value:0,default_value:0,nbits:"1",behavior:["NOP","MV REG_RT2 BUS_IB"],fire_name:["svg_p:text3443"],draw_data:[["svg_p:path3277"]],draw_name:[["svg_p:path3269"]]};sim_signals.C6={name:"C6",visible:true,type:"E",value:0,default_value:0,nbits:"1",behavior:["NOP","MV REG_RT3 ALU_C6"],fire_name:["svg_p:text3445"],draw_data:[["svg_p:path3261-8","svg_p:path3901-6"]],draw_name:[["svg_p:path3245"]]};sim_signals.C7={name:"C7",visible:true,type:"E",value:0,default_value:0,nbits:"1",behavior:["NOP","MV REG_SR M7_C7; FIRE C"],fire_name:["svg_p:text3655"],draw_data:[["svg_p:path3651-9"]],draw_name:[["svg_p:path3681"]]};sim_signals.TA={name:"TA",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","MV BUS_AB REG_MAR"],fire_name:["svg_p:text3091"],draw_data:[["svg_p:path3089","svg_p:path3597","svg_p:path3513","svg_p:path3601","svg_p:path3187","svg_p:path3087","svg_p:path2995"]],draw_name:[["svg_p:path3085"]]};sim_signals.TD={name:"TD",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","MV BUS_DB WBS_TD; MOVE_BITSE A1A0 0 2 BUS_AB 0; FIRE A1A0"],fire_name:["svg_p:text3103"],draw_data:[["svg_p:path3101","svg_p:path3587","svg_p:path3515","svg_p:path3505","svg_p:path3419","svg_p:path3099","svg_p:path3097"]],draw_name:[["svg_p:path3095"]]};sim_signals.T1={name:"T1",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","MV BUS_IB REG_MBR; FIRE M7; FIRE M2; FIRE M1"],fire_name:["svg_p:text3105"],draw_data:[["svg_p:path3071","svg_p:path3069","svg_p:path3049"]],draw_name:[["svg_p:path3067"]]};sim_signals.T2={name:"T2",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","MV BUS_IB REG_PC; FIRE M7; FIRE M2; FIRE M1"],fire_name:["svg_p:text3449"],draw_data:[["svg_p:path3199","svg_p:path3201","svg_p:path3049"]],draw_name:[["svg_p:path3329"]]};sim_signals.T3={name:"T3",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","MV BUS_IB SELEC_T3; FIRE M7; FIRE M2; FIRE M1"],fire_name:["svg_p:text3451"],draw_data:[["svg_p:path3349","svg_p:path3931","svg_p:path3345","svg_p:path3049"]],draw_name:[["svg_p:path3351"]]};sim_signals.T4={name:"T4",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","MV BUS_IB REG_RT1; FIRE M7; FIRE M2; FIRE M1"],fire_name:["svg_p:text3453"],draw_data:[["svg_p:path3261","svg_p:path3259","svg_p:path3049"]],draw_name:[["svg_p:path3305"]]};sim_signals.T5={name:"T5",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","MV BUS_IB REG_RT2; FIRE M7; FIRE M2; FIRE M1"],fire_name:["svg_p:text3455"],draw_data:[["svg_p:path3275","svg_p:path3273","svg_p:path3049"]],draw_name:[["svg_p:path3307"]]};sim_signals.T6={name:"T6",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","MV BUS_IB ALU_C6; FIRE M7; FIRE M2; FIRE M1"],fire_name:["svg_p:text3457"],draw_data:[["svg_p:path3589","svg_p:path3317","svg_p:path3321","svg_p:path3901-6","svg_p:path3163-2","svg_p:path3049"]],draw_name:[["svg_p:path3319"]]};sim_signals.T7={name:"T7",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","MV BUS_IB REG_RT3; FIRE M7; FIRE M2; FIRE M1"],fire_name:["svg_p:text3459"],draw_data:[["svg_p:path3327","svg_p:path3311","svg_p:path3325","svg_p:path3323","svg_p:path3049"]],draw_name:[["svg_p:path3313"]]};sim_signals.T8={name:"T8",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","MV BUS_IB REG_SR; FIRE M7; FIRE M2; FIRE M1"],fire_name:["svg_p:text3657"],draw_data:[["svg_p:path3651","svg_p:path3647","svg_p:path3049"]],draw_name:[["svg_p:path3649"]]};sim_signals.T9={name:"T9",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","MV BUS_IB RA_T9; FIRE M7; FIRE M2; FIRE M1"],fire_name:["svg_p:text3147"],draw_data:[["svg_p:path3143","svg_p:path3139","svg_p:path3049"]],draw_name:[["svg_p:path3133"]]};sim_signals.T10={name:"T10",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","MV BUS_IB RB_T10; FIRE M7; FIRE M2; FIRE M1"],fire_name:["svg_p:text3149"],draw_data:[["svg_p:path3145","svg_p:path3141","svg_p:path3049"]],draw_name:[["svg_p:path3137"]]};sim_signals.M1={name:"M1",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["MV M1_C1 RBS_M1","MV M1_C1 BUS_IB"],fire_name:["svg_p:text3469"],draw_data:[["svg_p:path3057"],["svg_p:path3063","svg_p:path3061","svg_p:path3059"]],draw_name:[[],["svg_p:path3447"]]};sim_signals.M2={name:"M2",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["MV M2_C2 BUS_IB","ADD M2_C2 REG_PC VAL_FOUR"],fire_name:["svg_p:text3471"],draw_data:[["svg_p:path3217","svg_p:path3215","svg_p:path3213"],["svg_p:path3211","svg_p:path3209","svg_p:path3193","svg_p:path3207","svg_p:path3197"]],draw_name:[[],["svg_p:path3467","svg_p:path3467"]]};sim_signals.M7={name:"M7",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["MV M7_C7 BUS_IB","MV M7_C7 SELP_M7"],fire_name:["svg_p:text3673"],draw_data:[["svg_p:path3691","svg_p:path3693","svg_p:path3659"],["svg_p:path3695"]],draw_name:[[],["svg_p:path3667"]]};sim_signals.MA={name:"MA",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["MV MA_ALU RA_T9; FIRE COP","MV MA_ALU REG_RT1; FIRE COP"],fire_name:["svg_p:text3463"],draw_data:[["svg_p:path3249","svg_p:path3161","svg_p:path3165"],["svg_p:path3279"]],draw_name:[[],["svg_p:path3423"]]};sim_signals.MB={name:"MB",visible:true,type:"L",value:0,default_value:0,nbits:"2",behavior:["MV MB_ALU RB_T10; FIRE COP","MV MB_ALU REG_RT2; FIRE COP","MV MB_ALU VAL_FOUR; FIRE COP","MV MB_ALU VAL_ONE; FIRE COP"],fire_name:["svg_p:text3465"],draw_data:[["svg_p:path3281","svg_p:path3171","svg_p:path3169"],["svg_p:path3283"],["svg_p:path3295","svg_p:path3293"],["svg_p:path3297","svg_p:path3299"]],draw_name:[[],["svg_p:path3425","svg_p:path3427"]]};sim_signals.COP={name:"COP",visible:true,type:"L",value:0,default_value:0,nbits:"4",behavior:["AND ALU_C6 MA_ALU MB_ALU; FIRE T6; FIRE SELP","OR ALU_C6 MA_ALU MB_ALU; FIRE T6; FIRE SELP","NOT ALU_C6 MA_ALU; FIRE T6; FIRE SELP","XOR ALU_C6 MA_ALU MB_ALU; FIRE T6; FIRE SELP","SRL ALU_C6 MA_ALU; FIRE T6; FIRE SELP","SRA ALU_C6 MA_ALU; FIRE T6; FIRE SELP","SL ALU_C6 MA_ALU; FIRE T6; FIRE SELP","RR ALU_C6 MA_ALU; FIRE T6; FIRE SELP","RL ALU_C6 MA_ALU; FIRE T6; FIRE SELP","ADD ALU_C6 MA_ALU MB_ALU; FIRE T6; FIRE SELP","SUB ALU_C6 MA_ALU MB_ALU; FIRE T6; FIRE SELP","NOP","MUL ALU_C6 MA_ALU MB_ALU; FIRE T6; FIRE SELP","DIV ALU_C6 MA_ALU MB_ALU; FIRE T6; FIRE SELP","MOD ALU_C6 MA_ALU MB_ALU; FIRE T6; FIRE SELP","LUI ALU_C6 MA_ALU; FIRE T6; FIRE SELP"],fire_name:["svg_p:text3303"],draw_data:[["svg_p:path3237","svg_p:path3239"]],draw_name:[["svg_p:path3009","svg_p:path3301"]]};sim_signals.SELP={name:"SELP",visible:true,type:"L",value:0,default_value:0,nbits:"2",behavior:["NOP","MV SELP_M7 REG_SR; SBIT_E SELP_M7 FLAG_U 0; FIRE M7","MV SELP_M7 REG_SR; SBIT_E SELP_M7 FLAG_I 1; FIRE M7","MV SELP_M7 REG_SR; SBIT_E SELP_M7 FLAG_O 31; SBIT_E SELP_M7 FLAG_N 30; SBIT_E SELP_M7 FLAG_Z 29; FIRE M7"],fire_name:["svg_p:text3703"],draw_data:[[],["svg_p:path3643"],["svg_p:path3705"],["svg_p:path3675","svg_p:path3331"]],draw_name:[[]]};sim_signals.I={name:"I",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["MV FLAG_I VAL_ZERO; FIRE SELP","MV FLAG_I VAL_ONE; FIRE SELP"],fire_name:["svg_p:tspan3894"],draw_data:[["svg_p:path3705"]],draw_name:[[]]};sim_signals.U={name:"U",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["MV FLAG_U VAL_ZERO; FIRE SELP","MV FLAG_U VAL_ONE; FIRE SELP"],fire_name:["svg_p:tspan3891"],draw_data:[["svg_p:path3643"]],draw_name:[[]]};sim_signals.SELA={name:"SELA",visible:true,type:"L",value:0,default_value:0,nbits:"5",behavior:["FIRE MR"],fire_name:[],draw_data:[[]],draw_name:[[]]};sim_signals.SELB={name:"SELB",visible:true,type:"L",value:0,default_value:0,nbits:"5",behavior:["FIRE MR"],fire_name:[],draw_data:[[]],draw_name:[[]]};sim_signals.SELE={name:"SELE",visible:true,type:"L",value:0,default_value:0,nbits:"5",behavior:["FIRE MR"],fire_name:[],draw_data:[[]],draw_name:[[]]};sim_signals.RA={name:"RA",visible:true,type:"L",value:0,default_value:0,nbits:"5",behavior:["GET RA_T9 BR RA; FIRE T9; FIRE MA;"],fire_name:["svg_p:text3107"],draw_data:[[]],draw_name:[[]]};sim_signals.RB={name:"RB",visible:true,type:"L",value:0,default_value:0,nbits:"5",behavior:["GET RB_T10 BR RB; FIRE T10; FIRE MB;"],fire_name:["svg_p:text3123"],draw_data:[[]],draw_name:[[]]};sim_signals.RE={name:"RE",visible:true,type:"L",value:0,default_value:0,nbits:"5",behavior:["FIRE LE"],fire_name:["svg_p:text3125"],draw_data:[[]],draw_name:[[]]};sim_signals.LE={name:"LE",visible:true,type:"E",value:0,default_value:0,nbits:"1",behavior:["NOP","SET BR RE BUS_IB"],fire_name:["svg_p:text3127"],draw_data:[["svg_p:path3153","svg_p:path3151","svg_p:path3129"]],draw_name:[["svg_p:path3121"]]};sim_signals.SE={name:"SE",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["MBITS SELEC_T3 0 REG_IR OFFSET SIZE 0 SE; FIRE T3"],fire_name:["svg_p:text3593","svg_p:text3431"],draw_data:[[]],draw_name:[["svg_p:path3591"]]};sim_signals.SIZE={name:"SIZE",visible:true,type:"L",value:0,default_value:0,nbits:"5",behavior:["MBITS SELEC_T3 0 REG_IR OFFSET SIZE 0 SE; FIRE T3"],fire_name:["svg_p:text3363"],draw_data:[[]],draw_name:[[]]};sim_signals.OFFSET={name:"OFFSET",visible:true,type:"L",value:0,default_value:0,nbits:"5",behavior:["MBITS SELEC_T3 0 REG_IR OFFSET SIZE 0 SE; FIRE T3"],fire_name:["svg_p:text3707"],draw_data:[[]],draw_name:[[]]};sim_signals.MC={name:"MC",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["MV_ES COP REG_IR/COP; FIRE COP","MV_ES COP REG_MICROINS/COP; FIRE COP"],fire_name:["svg_cu:text3322"],draw_data:[["svg_cu:path3320","svg_cu:path3142"],["svg_cu:path3318"]],draw_name:[[],["svg_cu:path3306"]]};sim_signals.MR={name:"MR",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["MBIT_SN RA REG_IR REG_MICROINS/SELA 5; FIRE RA; MBIT_SN RB REG_IR REG_MICROINS/SELB 5; FIRE RB; MBIT_SN RE REG_IR REG_MICROINS/SELE 5; FIRE RE","MV_ES RA REG_MICROINS/SELA; MV_ES RB REG_MICROINS/SELB; MV_ES RE REG_MICROINS/SELE;"],fire_name:["svg_cu:text3222","svg_cu:text3242","svg_cu:text3254"],draw_data:[["svg_cu:path3494","svg_cu:path3492","svg_cu:path3490","svg_cu:path3142b","svg_cu:path3188","svg_cu:path3190","svg_cu:path3192","svg_cu:path3194","svg_cu:path3276","svg_cu:path3290","svg_cu:path3260","svg_cu:path3196","svg_cu:path3502","svg_cu:path3278","svg_cu:path3232","svg_cu:path3292"],["svg_cu:path3270","svg_cu:path3282","svg_cu:path3300","svg_cu:path3258","svg_cu:path3260","svg_cu:path3278","svg_cu:path3196","svg_cu:path3502","svg_cu:path3294","svg_cu:path3292","svg_cu:path3288","svg_cu:path3232","svg_cu:path3280"]],draw_name:[[],["svg_cu:path3220","svg_cu:path3240","svg_cu:path3252"]]};sim_signals.BW={name:"BW",visible:true,type:"L",value:0,default_value:0,nbits:"2",behavior:["MOVE_BITS BWA 2 2 BW; MOVE_BITS SBWA 2 2 BW; MOVE_BITS RWBWA 2 2 BW; FIRE BWA; FIRE SBWA; FIRE RWBWA","MOVE_BITS BWA 2 2 BW; MOVE_BITS SBWA 2 2 BW; MOVE_BITS RWBWA 2 2 BW; FIRE BWA; FIRE SBWA; FIRE RWBWA","MOVE_BITS BWA 2 2 BW; MOVE_BITS SBWA 2 2 BW; MOVE_BITS RWBWA 2 2 BW; FIRE BWA; FIRE SBWA; FIRE RWBWA","MOVE_BITS BWA 2 2 BW; MOVE_BITS SBWA 2 2 BW; MOVE_BITS RWBWA 2 2 BW; FIRE BWA; FIRE SBWA; FIRE RWBWA"],fire_name:["svg_p:text3433","svg_p:text3611"],draw_data:[[],[]],draw_name:[[],[]]};sim_signals.A1A0={name:"A1A0",visible:true,type:"L",value:0,default_value:0,nbits:"2",behavior:["MOVE_BITS BWA 0 2 A1A0; MOVE_BITS SBWA 0 2 A1A0; FIRE BWA; FIRE SBWA","MOVE_BITS BWA 0 2 A1A0; MOVE_BITS SBWA 0 2 A1A0; FIRE BWA; FIRE SBWA","MOVE_BITS BWA 0 2 A1A0; MOVE_BITS SBWA 0 2 A1A0; FIRE BWA; FIRE SBWA","MOVE_BITS BWA 0 2 A1A0; MOVE_BITS SBWA 0 2 A1A0; FIRE BWA; FIRE SBWA"],fire_name:["svg_p:text3603","svg_p:text3609"],draw_data:[[],[]],draw_name:[[],[]]};sim_signals.BWA={name:"BWA",visible:false,type:"L",value:0,default_value:0,nbits:"4",behavior:["BSEL WBS_TD 0 8 REG_MBR 0; FIRE TD","BSEL WBS_TD 8 8 REG_MBR 0; FIRE TD","BSEL WBS_TD 16 8 REG_MBR 0; FIRE TD","BSEL WBS_TD 24 8 REG_MBR 0; FIRE TD","BSEL WBS_TD 0 16 REG_MBR 0; FIRE TD","BSEL WBS_TD 0 16 REG_MBR 0; FIRE TD","BSEL WBS_TD 0 16 REG_MBR 0; FIRE TD","BSEL WBS_TD 0 16 REG_MBR 0; FIRE TD","BSEL WBS_TD 16 16 REG_MBR 0; FIRE TD","BSEL WBS_TD 16 16 REG_MBR 0; FIRE TD","BSEL WBS_TD 16 16 REG_MBR 0; FIRE TD","BSEL WBS_TD 16 16 REG_MBR 0; FIRE TD","MV WBS_TD REG_MBR; FIRE TD","MV WBS_TD REG_MBR; FIRE TD","MV WBS_TD REG_MBR; FIRE TD","MV WBS_TD REG_MBR; FIRE TD"],fire_name:[],draw_data:[[],[]],draw_name:[[],[]]};sim_signals.SBWA={name:"SBWA",visible:false,type:"L",value:0,default_value:0,nbits:"5",behavior:["BSEL RBS_M1 0 8 BUS_DB 0; FIRE M1","BSEL RBS_M1 0 8 BUS_DB 8; FIRE M1","BSEL RBS_M1 0 8 BUS_DB 16; FIRE M1","BSEL RBS_M1 0 8 BUS_DB 24; FIRE M1","BSEL RBS_M1 0 16 BUS_DB 0; FIRE M1","BSEL RBS_M1 0 16 BUS_DB 0; FIRE M1","BSEL RBS_M1 0 16 BUS_DB 0; FIRE M1","BSEL RBS_M1 0 16 BUS_DB 0; FIRE M1","BSEL RBS_M1 0 16 BUS_DB 16; FIRE M1","BSEL RBS_M1 0 16 BUS_DB 16; FIRE M1","BSEL RBS_M1 0 16 BUS_DB 16; FIRE M1","BSEL RBS_M1 0 16 BUS_DB 16; FIRE M1","MV RBS_M1 BUS_DB; FIRE M1","MV RBS_M1 BUS_DB; FIRE M1","MV RBS_M1 BUS_DB; FIRE M1","MV RBS_M1 BUS_DB; FIRE M1","BSEL RBS_M1 0 8 BUS_DB 0; EXT_SIG RBS_M1 7; FIRE M1","BSEL RBS_M1 0 8 BUS_DB 8; EXT_SIG RBS_M1 7; FIRE M1","BSEL RBS_M1 0 8 BUS_DB 16; EXT_SIG RBS_M1 7; FIRE M1","BSEL RBS_M1 0 8 BUS_DB 24; EXT_SIG RBS_M1 7; FIRE M1","BSEL RBS_M1 0 16 BUS_DB 0; EXT_SIG RBS_M1 15; FIRE M1","BSEL RBS_M1 0 16 BUS_DB 0; EXT_SIG RBS_M1 15; FIRE M1","BSEL RBS_M1 0 16 BUS_DB 0; EXT_SIG RBS_M1 15; FIRE M1","BSEL RBS_M1 0 16 BUS_DB 0; EXT_SIG RBS_M1 15; FIRE M1","BSEL RBS_M1 0 16 BUS_DB 16; EXT_SIG RBS_M1 15; FIRE M1","BSEL RBS_M1 0 16 BUS_DB 16; EXT_SIG RBS_M1 15; FIRE M1","BSEL RBS_M1 0 16 BUS_DB 16; EXT_SIG RBS_M1 15; FIRE M1","BSEL RBS_M1 0 16 BUS_DB 16; EXT_SIG RBS_M1 15; FIRE M1","MV RBS_M1 BUS_DB; FIRE M1","MV RBS_M1 BUS_DB; FIRE M1","MV RBS_M1 BUS_DB; FIRE M1","MV RBS_M1 BUS_DB; FIRE M1"],fire_name:[],draw_data:[[],[]],draw_name:[[],[]]};sim_signals.IOR={name:"IOR",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","MOVE_BITS KBD_IOR 0 1 IOR; MOVE_BITS SCR_IOR 0 1 IOR; FIRE KBD_IOR; FIRE SCR_IOR"],fire_name:["svg_p:text3715"],draw_data:[[],["svg_p:path3733","svg_p:path3493","svg_p:text3715","svg_p:path3493"]],draw_name:[[],[]]};sim_signals.IOW={name:"IOW",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","MOVE_BITS SCR_IOW 0 1 IOW; FIRE SCR_IOW"],fire_name:["svg_p:text3715"],draw_data:[[],["svg_p:path3735","svg_p:path3493","svg_p:text3717","svg_p:path3493"]],draw_name:[[],[]]};syntax_behavior.NOP={nparameters:1,operation:function(a){}};syntax_behavior.MV={nparameters:3,types:["E","E"],operation:function(a){var b=a[2].split("/");if(1==b.length){sim_states[a[1]].value=sim_states[a[2]].value}else{sim_states[a[1]].value=sim_states[b[0]].value[b[1]]}}};syntax_behavior.MV_ES={nparameters:3,types:["S","E"],operation:function(a){var b=a[2].split("/");if(1==b.length){sim_signals[a[1]].value=sim_states[a[2]].value;return}if(typeof sim_states[b[0]].value[b[1]]!="undefined"){sim_signals[a[1]].value=sim_states[b[0]].value[b[1]]}}};syntax_behavior.MV_EE={nparameters:3,types:["E","E"],operation:function(a){var b=a[2].split("/");if(1==b.length){sim_states[a[1]].value=parseInt(sim_states[a[2]].value);return}if(typeof sim_states[b[0]].value[b[1]]!="undefined"){sim_states[a[1]].value=parseInt(sim_states[b[0]].value[b[1]])}}};syntax_behavior.NOT_ES={nparameters:3,types:["S","E"],operation:function(a){sim_signals[a[1]].value=Math.abs(sim_states[a[2]].value-1)}};syntax_behavior.GET={nparameters:4,types:["E","E","S"],operation:function(a){sim_states[a[1]].value=sim_states[a[2]][sim_signals[a[3]].value]}};syntax_behavior.SET={nparameters:4,types:["E","S","E"],operation:function(a){sim_states[a[1]][sim_signals[a[2]].value]=sim_states[a[3]].value}};syntax_behavior.AND={nparameters:4,types:["E","E","E"],operation:function(a){sim_states[a[1]].value=sim_states[a[2]].value&sim_states[a[3]].value;sim_states.FLAG_N.value=(sim_states[a[1]].value<0)?1:0;sim_states.FLAG_Z.value=(sim_states[a[1]].value==0)?1:0;sim_states.FLAG_O.value=0}};syntax_behavior.OR={nparameters:4,types:["E","E","E"],operation:function(a){sim_states[a[1]].value=sim_states[a[2]].value|sim_states[a[3]].value;sim_states.FLAG_N.value=(sim_states[a[1]].value<0)?1:0;sim_states.FLAG_Z.value=(sim_states[a[1]].value==0)?1:0;sim_states.FLAG_O.value=0}};syntax_behavior.NOT={nparameters:3,types:["E","E"],operation:function(a){sim_states[a[1]].value=~(sim_states[a[2]].value);sim_states.FLAG_N.value=(sim_states[a[1]].value<0)?1:0;sim_states.FLAG_Z.value=(sim_states[a[1]].value==0)?1:0;sim_states.FLAG_O.value=0}};syntax_behavior.XOR={nparameters:4,types:["E","E","E"],operation:function(a){sim_states[a[1]].value=(sim_states[a[2]].value)^(sim_states[a[3]].value);sim_states.FLAG_N.value=(sim_states[a[1]].value<0)?1:0;sim_states.FLAG_Z.value=(sim_states[a[1]].value==0)?1:0;sim_states.FLAG_O.value=0}};syntax_behavior.SRL={nparameters:3,types:["E","E"],operation:function(a){sim_states[a[1]].value=(sim_states[a[2]].value)>>>1;sim_states.FLAG_N.value=(sim_states[a[1]].value<0)?1:0;sim_states.FLAG_Z.value=(sim_states[a[1]].value==0)?1:0;sim_states.FLAG_O.value=0}};syntax_behavior.SRA={nparameters:3,types:["E","E"],operation:function(a){sim_states[a[1]].value=(sim_states[a[2]].value)>>1;sim_states.FLAG_N.value=(sim_states[a[1]].value<0)?1:0;sim_states.FLAG_Z.value=(sim_states[a[1]].value==0)?1:0;sim_states.FLAG_O.value=0}};syntax_behavior.SL={nparameters:3,types:["E","E"],operation:function(a){sim_states[a[1]].value=(sim_states[a[2]].value)<<1;sim_states.FLAG_N.value=(sim_states[a[1]].value<0)?1:0;sim_states.FLAG_Z.value=(sim_states[a[1]].value==0)?1:0;sim_states.FLAG_O.value=0}};syntax_behavior.RR={nparameters:3,types:["E","E"],operation:function(a){sim_states[a[1]].value=((sim_states[a[2]].value)>>>1)|(((sim_states[a[2]].value)&1)<<31);sim_states.FLAG_N.value=(sim_states[a[1]].value<0)?1:0;sim_states.FLAG_Z.value=(sim_states[a[1]].value==0)?1:0;sim_states.FLAG_O.value=0}};syntax_behavior.RL={nparameters:3,types:["E","E"],operation:function(a){sim_states[a[1]].value=((sim_states[a[2]].value)<<1)|(((sim_states[a[2]].value)&2147483648)>>>31);sim_states.FLAG_N.value=(sim_states[a[1]].value<0)?1:0;sim_states.FLAG_Z.value=(sim_states[a[1]].value==0)?1:0;sim_states.FLAG_O.value=0}};syntax_behavior.ADD={nparameters:4,types:["E","E","E"],operation:function(a){sim_states[a[1]].value=(sim_states[a[2]].value<<0)+(sim_states[a[3]].value<<0);sim_states[a[1]].value=sim_states[a[1]].value&4294967295;sim_states.FLAG_N.value=(sim_states[a[1]].value<0)?1:0;sim_states.FLAG_Z.value=(sim_states[a[1]].value==0)?1:0;if((sim_states[a[1]].value<0)&&(sim_states[a[2]].value>=0)&&(sim_states[a[3]].value>=0)){sim_states.FLAG_O.value=1}else{sim_states.FLAG_O.value=0}}};syntax_behavior.SUB={nparameters:4,types:["E","E","E"],operation:function(a){sim_states[a[1]].value=(sim_states[a[2]].value<<0)-(sim_states[a[3]].value<<0);sim_states.FLAG_N.value=(sim_states[a[1]].value<0)?1:0;sim_states.FLAG_Z.value=(sim_states[a[1]].value==0)?1:0;if((sim_states[a[1]].value<0)&&(sim_states[a[2]].value>=0)&&(sim_states[a[3]].value>=0)){sim_states.FLAG_O.value=1}else{sim_states.FLAG_O.value=0}}};syntax_behavior.MUL={nparameters:4,types:["E","E","E"],operation:function(a){sim_states[a[1]].value=(sim_states[a[2]].value<<0)*(sim_states[a[3]].value<<0);sim_states.FLAG_N.value=(sim_states[a[1]].value<0)?1:0;sim_states.FLAG_Z.value=(sim_states[a[1]].value==0)?1:0;if((sim_states[a[1]].value<0)&&(sim_states[a[2]].value>=0)&&(sim_states[a[3]].value>=0)){sim_states.FLAG_O.value=1}else{sim_states.FLAG_O.value=0}}};syntax_behavior.DIV={nparameters:4,types:["E","E","E"],operation:function(a){sim_states[a[1]].value=(sim_states[a[2]].value<<0)/(sim_states[a[3]].value<<0);sim_states[a[1]].value=Math.floor(sim_states[a[1]].value);sim_states.FLAG_N.value=(sim_states[a[1]].value<0)?1:0;sim_states.FLAG_Z.value=(sim_states[a[1]].value==0)?1:0;sim_states.FLAG_O.value=0}};syntax_behavior.MOD={nparameters:4,types:["E","E","E"],operation:function(a){sim_states[a[1]].value=(sim_states[a[2]].value<<0)%(sim_states[a[3]].value<<0);sim_states.FLAG_N.value=(sim_states[a[1]].value<0)?1:0;sim_states.FLAG_Z.value=(sim_states[a[1]].value==0)?1:0;sim_states.FLAG_O.value=0}};syntax_behavior.LUI={nparameters:3,types:["E","E"],operation:function(a){sim_states[a[1]].value=(sim_states[a[2]].value)<<16;sim_states.FLAG_N.value=(sim_states[a[1]].value<0)?1:0;sim_states.FLAG_Z.value=(sim_states[a[1]].value==0)?1:0;sim_states.FLAG_O.value=0}};syntax_behavior.MBIT_I={nparameters:5,types:["E","E","I","I"],operation:function(a){var f=parseInt(a[3]);var d=parseInt(a[4]);var e=sim_states[a[2]].value.toString(2);var b="00000000000000000000000000000000".substring(0,32-e.length)+e;b=b.substr(31-(f+d-1),d);sim_states[a[1]].value=parseInt(b,2)}};syntax_behavior.MBIT_S={nparameters:5,types:["S","E","I","I"],operation:function(a){var f=parseInt(a[3]);var d=parseInt(a[4]);var e=sim_states[a[2]].value.toString(2);var b="00000000000000000000000000000000".substring(0,32-e.length)+e;b=b.substr(31-(f+d-1),d);sim_signals[a[1]].value=parseInt(b,2)}};syntax_behavior.MBIT_SN={nparameters:5,types:["S","E","E","I"],operation:function(b){var g=0;var f=b[3].split("/");if(1==f.length){g=sim_states[b[3]].value}else{if(typeof sim_states[f[0]].value[f[1]]!="undefined"){g=sim_states[f[0]].value[f[1]]}else{alert("WARN: undefined state/field pair -> "+f[0]+"/"+f[1])}}var h=parseInt(b[4]);var e=sim_states[b[2]].value.toString(2);var d="00000000000000000000000000000000".substring(0,32-e.length)+e;var a=d.substr(31-(g+h-1),h);sim_signals[b[1]].value=parseInt(a,2)}};syntax_behavior.SBIT_E={nparameters:4,types:["E","E","I"],operation:function(a){sim_states[a[1]].value=(sim_states[a[1]].value&~(1<<a[3]))|(sim_states[a[2]].value<<a[3])}};syntax_behavior.SBIT_S={nparameters:4,types:["S","S","I"],operation:function(a){sim_signals[a[1]].value=(sim_signals[a[1]].value&~(1<<a[3]))|(sim_signals[a[2]].value<<a[3])}};syntax_behavior.MBITS={nparameters:8,types:["E","I","E","S","S","I","S"],operation:function(b){var g=parseInt(sim_signals[b[4]].value);var e=parseInt(sim_signals[b[5]].value);var f=sim_states[b[3]].value.toString(2);var d=("00000000000000000000000000000000".substring(0,32-f.length)+f);d=d.substr(31-(g+e-1),e);var a="00000000000000000000000000000000".substring(0,32-d.length)+d;if(("1"==sim_signals[b[7]].value)&&("1"==d.substr(0,1))){a="11111111111111111111111111111111".substring(0,32-d.length)+d}sim_states[b[1]].value=parseInt(a,2)}};syntax_behavior.BSEL={nparameters:6,types:["E","I","I","E","I"],operation:function(e){var i=parseInt(e[2]);var h=parseInt(e[5]);var a=parseInt(e[3]);var g=sim_states[e[4]].value.toString(2);var f="00000000000000000000000000000000".substring(0,32-g.length)+g;f=f.substr(31-(h+a)+1,a);var d="00000000000000000000000000000000".substring(0,32-f.length)+f;var b="00000000000000000000000000000000".substr(0,i);d=d+b;sim_states[e[1]].value=parseInt(d,2)}};syntax_behavior.EXT_SIG={nparameters:3,types:["E","I"],operation:function(d){var f=sim_states[d[1]].value.toString(2);var e=("00000000000000000000000000000000".substring(0,32-f.length)+f);var b=e.substr(31-d[2],31);var a=b;if("1"==e[31-d[2]]){a="11111111111111111111111111111111".substring(0,32-b.length)+a}sim_states[d[1]].value=parseInt(a,2)}};syntax_behavior.MOVE_BITS={nparameters:5,types:["S","I","I","S"],operation:function(h){var d=parseInt(h[2]);var a=0;var f=parseInt(h[3]);var g=sim_signals[h[4]].value.toString(2);g=("00000000000000000000000000000000".substring(0,32-g.length)+g);g=g.substr(31-a-f+1,f);var e=sim_signals[h[1]].value.toString(2);e=("00000000000000000000000000000000".substring(0,32-e.length)+e);var k=e.substr(0,32-(d+f));var i=e.substr(31-d+1,d);var b=k+g+i;sim_signals[h[1]].value=parseInt(b,2)}};syntax_behavior.MOVE_BITSE={nparameters:6,types:["S","I","I","E","I"],operation:function(h){var d=parseInt(h[2]);var a=parseInt(h[5]);var f=parseInt(h[3]);var g=sim_states[h[4]].value.toString(2);g=("00000000000000000000000000000000".substring(0,32-g.length)+g);g=g.substr(31-a-f+1,f);var e=sim_signals[h[1]].value.toString(2);e=("00000000000000000000000000000000".substring(0,32-e.length)+e);var k=e.substr(0,32-(d+f));var i=e.substr(31-d+1,d);var b=k+g+i;sim_signals[h[1]].value=parseInt(b,2)}};syntax_behavior.DECO={nparameters:1,operation:function(a){var f=sim_states.REG_IR.value.toString(2);f="00000000000000000000000000000000".substring(0,32-f.length)+f;var h=parseInt(f.substr(0,6),2);var b=parseInt(f.substr(28,4),2);var e=decode_instruction(f);if(null==e){alert("ERROR: undefined instruction code "+h+"/"+b+" in firmware");sim_states.ROM_MUXA.value=0;return -1}var d=h<<6;if(typeof e.cop!="undefined"){d=d+b}if(typeof ROM[d]=="undefined"){alert("ERROR: undefined rom address "+d+" in firmware");sim_states.ROM_MUXA.value=0;return -1}sim_states.REG_IR_DECO.value="<font color=blue>"+show_decode_instruction(e,f)+"</font>";sim_states.DECO_INS.value=sim_states.DECO_INS.value+1;var g=document.getElementById("svg_p").contentDocument.getElementById("tspan3899");if(g!=null){g.innerHTML=show_decode_instruction(e,f)}sim_states.ROM_MUXA.value=ROM[d]}};syntax_behavior.FIRE={nparameters:2,types:["S"],operation:function(a){if(fire_stack.indexOf(a[1])!=-1){return}fire_stack.push(a[1]);update_draw(sim_signals[a[1]],sim_signals[a[1]].value);if("L"==sim_signals[a[1]].type){update_state(a[1])}fire_stack.pop(a[1]);check_ib(a[1])}};syntax_behavior.CLOCK={nparameters:1,operation:function(d){var f=sim_states.CLK.value();sim_states.CLK.value(f+1);for(var e in sim_signals){if("E"==sim_signals[e].type){update_state(e)}}sim_states.REG_MICROINS.value=Object.create(sim_states.REG_MICROINS.default_value);sim_states.REG_MICROADDR.value=sim_states.MUXA_MICROADDR.value;if(typeof MC[sim_states.REG_MICROADDR.value]!="undefined"){var a=MC[sim_states.REG_MICROADDR.value];for(var b in a){sim_states.REG_MICROINS.value[b]=a[b]}}show_memories("MC",MC,sim_states.REG_MICROADDR.value);show_asmdbg_pc();for(var e in sim_signals){sim_signals[e].value=sim_signals[e].default_value;if(typeof sim_states.REG_MICROINS.value[e]!="undefined"){sim_signals[e].value=sim_states.REG_MICROINS.value[e]}}for(var e in sim_signals){update_draw(sim_signals[e],sim_signals[e].value);if("L"==sim_signals[e].type){update_state(e)}}show_states();show_rf()}};syntax_behavior.RESET={nparameters:1,operation:function(a){for(var d in sim_states){if(typeof sim_states[d].value=="function"){sim_states[d].value(sim_states[d].default_value)}else{if(typeof sim_states[d].default_value=="object"){sim_states[d].value=Object.create(sim_states[d].default_value)}else{sim_states[d].value=sim_states[d].default_value}}}for(var d=0;d<sim_states.BR.length;d++){sim_states.BR[d]=0}sim_events.screen=new Object();sim_events.keybd=new Object();sim_events.io=new Object();for(var b=0;b<IO_INT_FACTORY.length;b++){IO_INT_FACTORY[b].accumulated(0);IO_INT_FACTORY[b].active=false}show_states();show_rf();show_memories("MP",MP,1);show_memories("MC",MC,1)}};var MP=new Object();var segments=new Object();sim_states.MRDY={name:"MRDY",visible:false,nbits:"1",value:0,default_value:0,draw_data:[]};sim_signals.R={name:"R",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","MEM_READ BUS_AB BUS_DB; MOVE_BITS RWBWA 5 1 R; FIRE RWBWA"],fire_name:["svg_p:text3533-5-2","svg_p:text3713"],draw_data:[[],["svg_p:path3557","svg_p:path3571"]],draw_name:[[],[]]};sim_signals.W={name:"W",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","MOVE_BITS RWBWA 4 1 W; FIRE RWBWA; MEM_WRITE BUS_AB BUS_DB"],fire_name:["svg_p:text3533-5-08","svg_p:text3527"],draw_data:[[],["svg_p:path3559","svg_p:path3575"]],draw_name:[[],[]]};sim_signals.RWBWA={name:"RWBWA",visible:false,type:"L",value:0,default_value:0,nbits:"6",behavior:["NOP","NOP","NOP","NOP","NOP","NOP","NOP","NOP","NOP","NOP","NOP","NOP","NOP","NOP","NOP","NOP","BSEL BUS_DB 0 8 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 8 8 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 16 8 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 24 8 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 0 16 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 0 16 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 0 16 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 0 16 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 16 16 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 16 16 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 16 16 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 16 16 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 0 32 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 0 32 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 0 32 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 0 32 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 0 8 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 8 8 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 16 8 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 24 8 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 0 16 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 0 16 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 0 16 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 0 16 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 16 16 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 16 16 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 16 16 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 16 16 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 0 32 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 0 32 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 0 32 BUS_DB 0; FIRE SBWA","BSEL BUS_DB 0 32 BUS_DB 0; FIRE SBWA","NOP","NOP","NOP","NOP","NOP","NOP","NOP","NOP","NOP","NOP","NOP","NOP","NOP","NOP","NOP","NOP"],fire_name:[],draw_data:[[],[]],draw_name:[[],[]]};syntax_behavior.MEM_READ={nparameters:3,types:["E","E"],operation:function(b){var d=0;var a=sim_states[b[1]].value;if(typeof MP[a]!="undefined"){d=MP[a]}sim_states[b[2]].value=d;show_memories("MP",MP,a)}};syntax_behavior.MEM_WRITE={nparameters:3,types:["E","E"],operation:function(b){var d=sim_states[b[2]].value;var a=sim_states[b[1]].value;MP[a]=d;show_memories("MP",MP,a)}};var IO_INT_FACTORY=new Array();IO_INT_FACTORY[0]={period:0,probability:0.5,accumulated:0,active:false};IO_INT_FACTORY[1]={period:0,probability:0.5,accumulated:0,active:false};IO_INT_FACTORY[2]={period:0,probability:0.5,accumulated:0,active:false};IO_INT_FACTORY[3]={period:0,probability:0.5,accumulated:0,active:false};IO_INT_FACTORY[4]={period:0,probability:0.5,accumulated:0,active:false};IO_INT_FACTORY[5]={period:0,probability:0.5,accumulated:0,active:false};IO_INT_FACTORY[6]={period:0,probability:0.5,accumulated:0,active:false};IO_INT_FACTORY[7]={period:0,probability:0.5,accumulated:0,active:false};var IOSR_ID=4352;var IOCR_ID=4356;var IODR_ID=4360;sim_states.IOSR={name:"IOSR",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.IOCR={name:"IOCR",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.IODR={name:"IODR",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.INT={name:"INT",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.IORDY={name:"IORDY",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_signals.IO_IOR={name:"IO_IOR",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","IO_IOR BUS_AB BUS_DB IOSR IOCR IODR CLK; FIRE SBWA"],fire_name:["svg_p:tspan4173","svg_p:text3715"],draw_data:[[],["svg_p:path3795","svg_p:path3733"]],draw_name:[[],[]]};sim_signals.IO_IOW={name:"IO_IOW",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","IO_IOW BUS_AB BUS_DB IOSR IOCR IODR CLK; FIRE SBWA"],fire_name:["svg_p:text3785-0-6-0-5-5","svg_p:text3717"],draw_data:[[],["svg_p:path3805","svg_p:path3733"]],draw_name:[[],[]]};sim_signals.IO_IE={name:"IO_IE",visible:true,type:"L",value:1,default_value:1,nbits:"1",behavior:["NOP","IO_CHK_I CLK INT INTA"],fire_name:[],draw_data:[[],[]],draw_name:[[],[]]};sim_signals.INTA={name:"INTA",visible:true,type:"L",value:1,default_value:1,nbits:"1",behavior:["NOP","INTA CLK INT INTA BUS_DB INTV"],fire_name:["svg_p:text3785-0-6-0-5-5-1-1"],draw_data:[[],["svg_p:path3807","svg_p:path3737"]],draw_name:[[],[]]};syntax_behavior.IO_IOR={nparameters:7,types:["E","E","E","E","E","E"],operation:function(a){var f=sim_states[a[1]].value;var b=sim_states[a[3]].value;var d=sim_states[a[4]].value;var e=sim_states[a[5]].value;if(f==IOSR_ID){sim_states[a[2]].value=b}if(f==IOCR_ID){sim_states[a[2]].value=d}if(f==IODR_ID){sim_states[a[2]].value=e}}};syntax_behavior.IO_IOW={nparameters:7,types:["E","E","E","E","E","E"],operation:function(a){var d=sim_states[a[1]].value;var b=sim_states[a[2]].value;if((d!=IOSR_ID)&&(d!=IOCR_ID)&&(d!=IODR_ID)){return}if(d==IOSR_ID){sim_states[a[3]].value=b}if(d==IOCR_ID){sim_states[a[4]].value=b}if(d==IODR_ID){sim_states[a[5]].value=b}}};syntax_behavior.IO_CHK_I={nparameters:4,types:["E","E","S"],operation:function(a){var d=sim_states[a[1]].value();for(var b=0;b<IO_INT_FACTORY.length;b++){if(IO_INT_FACTORY[b].period()==0){continue}if((d%IO_INT_FACTORY[b].period())==0){if(Math.random()>IO_INT_FACTORY[b].probability()){continue}IO_INT_FACTORY[b].accumulated(IO_INT_FACTORY[b].accumulated()+1);IO_INT_FACTORY[b].active=true;if(typeof sim_events.io[d]=="undefined"){sim_events.io[d]=new Array()}sim_events.io[d].push(b);sim_states[a[2]].value=1}}}};syntax_behavior.INTA={nparameters:6,types:["E","E","S","E","E"],operation:function(a){var e=sim_states[a[1]].value();if(typeof sim_events.io[e]!="undefined"){sim_states[a[4]].value=sim_states[a[5]].value;return}var d=false;for(var b=0;b<IO_INT_FACTORY.length;b++){if(IO_INT_FACTORY[b].active){if(!d){IO_INT_FACTORY[b].active=false;sim_states[a[2]].value=0;sim_states[a[4]].value=b;sim_states[a[5]].value=b;continue}if(typeof sim_events.io[e]=="undefined"){sim_events.io[e]=new Array()}sim_events.io[e].push(b);sim_states[a[2]].value=1}}}};var KBDR_ID=256;var KBSR_ID=260;sim_states.KBDR={name:"KBDR",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.KBSR={name:"KBSR",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_signals.KBD_IOR={name:"IOR",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","KBD_IOR BUS_AB BUS_DB KBDR KBSR CLK; FIRE SBWA"],fire_name:["svg_p:tspan4057"],draw_data:[[],["svg_p:path3863","svg_p:path3847"]],draw_name:[[],[]]};syntax_behavior.KBD_IOR={nparameters:6,types:["E","E","E","E","E"],operation:function(d){var f=sim_states[d[1]].value;var e=sim_states[d[5]].value();if((f!=KBDR_ID)&&(f!=KBSR_ID)){return}if(typeof sim_events.keybd[e]!="undefined"){if(f==KBDR_ID){sim_states[d[2]].value=sim_events.keybd[e]}if(f==KBSR_ID){sim_states[d[2]].value=1}return}if(sim_states[d[4]].value==0){var b=document.getElementById("kdb_key").value;if(b.length!=0){var a=b.substr(1,b.length-1);document.getElementById("kdb_key").value=a;sim_states[d[4]].value=1;sim_states[d[3]].value=b[0].charCodeAt(0)}}if(sim_states[d[4]].value==1){sim_events.keybd[e]=sim_states[d[3]].value}if(f==KBSR_ID){sim_states[d[2]].value=sim_states[d[4]].value}if(f==KBDR_ID){if(sim_states[d[4]].value==1){sim_states[d[2]].value=sim_states[d[3]].value}sim_states[d[4]].value=0}}};var DDR_ID=4096;var DSR_ID=4100;sim_states.DDR={name:"DDR",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_states.DSR={name:"DSR",visible:false,nbits:"32",value:0,default_value:0,draw_data:[]};sim_signals.SCR_IOR={name:"IOR",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","SCR_IOR BUS_AB BUS_DB DDR DSR CLK"],fire_name:["svg_p:tspan4004"],draw_data:[[],["svg_p:path3871","svg_p:path3857"]],draw_name:[[],[]]};sim_signals.SCR_IOW={name:"IOW",visible:true,type:"L",value:0,default_value:0,nbits:"1",behavior:["NOP","SCR_IOW BUS_AB BUS_DB DDR DSR CLK"],fire_name:["svg_p:tspan4004"],draw_data:[[],["svg_p:path3873","svg_p:path3857"]],draw_name:[[],[]]};syntax_behavior.SCR_IOR={nparameters:6,types:["E","E","E","E","E"],operation:function(b){var e=sim_states[b[1]].value;var d=sim_states[b[3]].value;var a=sim_states[b[4]].value;if(e==DDR_ID){sim_states[b[2]].value=d}if(e==DSR_ID){sim_states[b[2]].value=a}}};syntax_behavior.SCR_IOW={nparameters:6,types:["E","E","E","E","E"],operation:function(b){var f=sim_states[b[1]].value;var d=sim_states[b[2]].value;var e=sim_states[b[5]].value();if(f!=DDR_ID){return}var a=document.getElementById("kdb_con").value;if(typeof sim_events.screen[e]!="undefined"){a=a.substr(0,a.length-1)}a=a+String.fromCharCode(d);document.getElementById("kdb_con").value=a;sim_states[b[3]].value=d;sim_states[b[4]].value=1;sim_events.screen[e]=d}};var color_data_active="#0066FF";var color_data_inactive="rgb(0, 0, 0)";var color_name_active="red";var color_name_inactive="rgb(0, 0, 0)";var is_interactive=false;var size_active=1.22;var size_inactive=0.02;function get_simware(){if(typeof FIRMWARE.firmware=="undefined"){FIRMWARE.firmware=new Array();FIRMWARE.mp=new Object();FIRMWARE.seg=new Object();FIRMWARE.assembly=new Object();FIRMWARE.labels=new Object();FIRMWARE.registers=new Object();FIRMWARE.cihash=new Object();FIRMWARE.pseudoInstructions=new Object();FIRMWARE.stackRegister=new Object()}return FIRMWARE}function set_simware(a){if(typeof a.firmware!="undefined"){FIRMWARE.firmware=a.firmware}if(typeof a.mp!="undefined"){FIRMWARE.mp=a.mp}if(typeof a.seg!="undefined"){FIRMWARE.seg=a.seg}if(typeof a.assembly!="undefined"){FIRMWARE.assembly=a.assembly}if(typeof a.labels!="undefined"){FIRMWARE.labels=a.labels}if(typeof a.registers!="undefined"){FIRMWARE.registers=a.registers}if(typeof a.cihash!="undefined"){FIRMWARE.cihash=a.cihash}if(typeof a.pseudoInstructions!="undefined"){FIRMWARE.pseudoInstructions=a.pseudoInstructions}if(typeof a.stackRegister!="undefined"){FIRMWARE.stackRegister=a.stackRegister}}function obj_draw(a,g,i,e,f,d){var b=a.split(":");var h=document.getElementById(b[0]);if(h==null){return}h=h.contentDocument;if(h==null){return}h=h.getElementById(b[1]);if(h==null){return}if(g){h.style.setProperty("stroke",i,"");h.style.setProperty("fill",i,"");h.style.setProperty("stroke-width",f,"")}else{if(h.style.getPropertyValue("stroke")==e){return}h.style.setProperty("stroke",e,"");h.style.setProperty("fill",e,"");h.style.setProperty("stroke-width",d,"")}}function update_draw(e,d){if(e.draw_data.length>1){for(var b=0;b<e.draw_data.length;b++){for(var a=0;a<e.draw_data[b].length;a++){obj_draw(e.draw_data[b][a],(b==d),color_data_active,color_data_inactive,size_active,size_inactive)}}for(var b=0;b<e.draw_name.length;b++){for(var a=0;a<e.draw_name[b].length;a++){obj_draw(e.draw_name[b][a],(b==d),color_name_active,color_name_inactive,size_active,size_inactive)}}}else{if(e.nbits==1){for(var a=0;a<e.draw_data[0].length;a++){obj_draw(e.draw_data[0][a],(0!=d),color_data_active,color_data_inactive,size_active,size_inactive)}for(var a=0;a<e.draw_name[0].length;a++){obj_draw(e.draw_name[0][a],(0!=d),color_name_active,color_name_inactive,size_active,size_inactive)}}else{if(e.draw_data.length==1){for(var a=0;a<e.draw_data[0].length;a++){obj_draw(e.draw_data[0][a],true,color_data_active,color_data_inactive,size_active,size_inactive)}for(var a=0;a<e.draw_name[0].length;a++){obj_draw(e.draw_name[0][a],true,color_name_active,color_name_inactive,size_active,size_inactive)}}}}}function refresh(){for(var a in sim_signals){update_draw(sim_signals[a],sim_signals[a].value)}}function init_rf(d){if(d==""){return}var a="";for(var b=0;b<sim_states.BR.length;b++){a+="<div class='col-xs-2 col-sm-1 col-md-2 col-lg-1' id='name_RF"+b+"' style='padding: 0 15 0 5;'>R"+b+"</div><div class='col-xs-4 col-sm-3 col-md-4 col-lg-3' id='tbl_RF"+b+"' style='padding: 0 5 0 35;'>"+sim_states.BR[b]+"</div>"}$(d).html("<div class='row-fluid'>"+a+"</div>")}function show_rf(){var b=get_simware();for(var d=0;d<sim_states.BR.length;d++){var a=(sim_states.BR[d]>>>0).toString(16).toUpperCase();a="00000000".substring(0,8-a.length)+a;var e=document.getElementById("tbl_RF"+d);if(e!=null){e.innerHTML=a}var e=document.getElementById("name_RF"+d);if(e!=null){if(typeof b.registers[d]!="undefined"){e.innerHTML=d+"="+b.registers[d]}}}}var filter_states=["REG_IR_DECO,1","REG_PC,0","REG_MAR,0","REG_MBR,0","REG_IR,0","REG_RT1,0","REG_RT2,0","REG_RT3,0","REG_SR,0","FLAG_O,0","FLAG_N,0","FLAG_Z,0","FLAG_I,0","FLAG_U,0","REG_MICROADDR,0"];var divclasses=["col-xs-3 col-sm-3 col-md-3 col-lg-2","col-xs-6 col-sm-6 col-md-6 col-lg-6"];function init_eltos(f,n,a,h){if(f==""){return}var d="";for(var g=0;g<a.length;g++){var o=a[g].split(",")[0];var e=n[o].name;if(e.length>7){e=e.substring(0,7)+"..."}var m=a[g].split(",")[1];var k=h[m];d+="<div class='"+k+"' style='padding: 0 5 0 5;'>"+e+"</div><div class='"+k+"' id='tbl_"+o+"' style='padding: 0 5 0 0;'>"+n[o].value.toString(16)+"</div>"}$(f).html("<div class='row-fluid'>"+d+"</div>")}function show_eltos(f,d){for(var b=0;b<d.length;b++){var a=d[b].split(",")[0];var e=document.getElementById("tbl_"+a);if(e!=null){e.innerHTML=f[a].value.toString(16)}}}function init_states(a){return init_eltos(a,sim_states,filter_states,divclasses)}function show_states(){return show_eltos(sim_states,filter_states)}function init_stats(e){if(e==""){sim_states.CLK.value=ko.observable(sim_states.CLK.value);sim_states.DECO_INS.value=ko.observable(sim_states.DECO_INS.value);for(var b=0;b<IO_INT_FACTORY.length;b++){IO_INT_FACTORY[b].accumulated=ko.observable(IO_INT_FACTORY[b].accumulated)}return}var d="<center>";d+="<div class='col-xs-6 col-sm-6 col-md-6 col-lg-6'>Instructions</div><div class='col-xs-6 col-sm-6 col-md-6 col-lg-6' id='ins_context'><span data-bind='text: value'>&nbsp;</span></div>";d+="<div class='col-xs-6 col-sm-6 col-md-6 col-lg-6'>CLK ticks</div><div class='col-xs-6 col-sm-6 col-md-6 col-lg-6' id='clk_context'><span data-bind='text: value'>&nbsp;</span></div>";d+="<div class='col-xs-12 col-sm-12 col-md-12 col-lg-12'>&nbsp;</div>";for(var b=0;b<IO_INT_FACTORY.length;b++){d+="<div class='col-xs-6 col-sm-6 col-md-6 col-lg-6'>Interrupt "+b+"</div><div class='col-xs-6 col-sm-6 col-md-6 col-lg-6' id='int"+b+"_context'><span data-bind='text: accumulated'>&nbsp;</span></div>"}d+="</center>";$(e).html("<div class='row-fluid'>"+d+"</div>");sim_states.CLK.value=ko.observable(sim_states.CLK.value);var a=document.getElementById("clk_context");ko.applyBindings(sim_states.CLK,a);sim_states.DECO_INS.value=ko.observable(sim_states.DECO_INS.value);var a=document.getElementById("ins_context");ko.applyBindings(sim_states.DECO_INS,a);for(var b=0;b<IO_INT_FACTORY.length;b++){IO_INT_FACTORY[b].accumulated=ko.observable(IO_INT_FACTORY[b].accumulated);var a=document.getElementById("int"+b+"_context");ko.applyBindings(IO_INT_FACTORY[b],a)}}function init_io(e){if(e==""){for(var b=0;b<IO_INT_FACTORY.length;b++){IO_INT_FACTORY[b].period=ko.observable(IO_INT_FACTORY[b].period);IO_INT_FACTORY[b].probability=ko.observable(IO_INT_FACTORY[b].probability)}return}var d="<center>";for(var b=0;b<8;b++){if(4==b){d+="<div class='col-xs-4 col-sm-4 col-md-4 col-lg-4'>Interrupt</div><div class='col-xs-4 col-sm-4 col-md-4 col-lg-4'>Period</div><div class='col-xs-4 col-sm-4 col-md-4 col-lg-4'>Probability</div>"}d+="<div class='col-xs-4 col-sm-4 col-md-4 col-lg-4' style='padding: 15 5 0 10;'>"+b+"</div><div class='col-xs-4 col-sm-4 col-md-4 col-lg-4' style='padding: 0 5 0 10;' id='int"+b+"_per'><input type=number data-bind='value: period'></div><div class='col-xs-4 col-sm-4 col-md-4 col-lg-4' style='padding: 0 5 0 10;' id='int"+b+"_pro'><input type=number data-bind='value: probability' min='0' max='1' step='.1'></div>"}d+="</center>";$(e).html("<div class='row-fluid'>"+d+"</div>");for(var b=0;b<IO_INT_FACTORY.length;b++){IO_INT_FACTORY[b].period=ko.observable(IO_INT_FACTORY[b].period);var a=document.getElementById("int"+b+"_per");ko.applyBindings(IO_INT_FACTORY[b],a);IO_INT_FACTORY[b].probability=ko.observable(IO_INT_FACTORY[b].probability);var a=document.getElementById("int"+b+"_pro");ko.applyBindings(IO_INT_FACTORY[b],a)}}function show_memories(b,h,a){var f="";var e="";for(var d in h){if(typeof h[d]=="object"){e="";for(var g in h[d]){if(g=="MADDR"){e+=g+"=0x"+parseInt(h[d][g]).toString(16)+" "}else{if(h[d][g]==1){e+=g+" "}else{e+=g+"="+h[d][g]+" "}}}if(d==a){f+="<tr><td width=15%>0x"+parseInt(d).toString(16)+"</td><td><b><div style='color: blue'>"+e+"</div></b></td></tr>"}else{f+="<tr><td width=15%><small>0x"+parseInt(d).toString(16)+"</small></td><td          ><div><small>"+e+"</small></div></td></tr>"}}else{e=h[d].toString(16);e="00000000".substring(0,8-e.length)+e;value2=e[0]+e[1]+" "+e[2]+e[3]+" "+e[4]+e[5]+" "+e[6]+e[7];key2=parseInt(d).toString(16);key3=(parseInt(d)+3).toString(16);for(skey in segments){if(parseInt(segments[skey].begin)==parseInt(d)){f+="</tbody><tbody id=begin_"+skey+">"}}if(d==a){f+="<tr><td width=50%><font color=blue><b>0x"+key3+"-"+key2+"</b></font></td><td          ><font color=blue><b>"+value2+"</b></font></td></tr>"}else{f+="<tr><td width=50%><small>0x"+key3+"-"+key2+"</small></td><td          ><small>"+value2+"</small></td></tr>"}}}if(typeof h[a]=="undefined"){f+="<tr><td width=15%><font color=blue>0x"+parseInt(a).toString(16)+"</font></td><td><font color=blue><b>&nbsp;</b></font></td></tr>"}$("#memory_"+b).html("<center><table class='table table-hover table-condensed table-responsive'><tbody id=none>"+f+"</tbody></table></center>")}function show_asmdbg_pc(){var a=get_simware();var d=null;for(l in a.assembly){d=$("#asmdbg"+l);d.css("background-color",a.assembly[l].bgcolor)}var b=sim_states.REG_PC.value;var e="0x"+b.toString(16);d=$("#asmdbg"+e);d.css("background-color","#00EE88")}function firmware2html(z,B){var n=["A0,0","B,0","C,0","SELA,5","SELB,5","SELE,2","MR,0","MC,0","C0,0","C1,0","C2,0","C3,0","C4,0","C5,0","C6,0","C7,0","T1,0","T2,0","T3,0","T4,0","T5,0","T6,0","T7,0","T8,0","T9,0","T10,0","M1,0","M2,0","M7,0","MA,0","MB,0","SELP,0","LE,0","SE,0","SIZE,0","OFFSET,0","BW,0","R,0","W,0","TA,0","TD,0","IOR,0","IOW,0","I,0","U,0","COP,0"];var D="<tr bgcolor=#FF9900><td bgcolor=white     style='border-style: solid; border-width:0px; border-color:lightgray;'></td><td bgcolor=lightblue style='border-style: solid; border-width:1px; border-color:lightgray;'>co</td><td bgcolor=#FFCC00   style='border-style: solid; border-width:1px; border-color:lightgray;' align=center><small><b>&#181;dir</b></small></td><td bgcolor=white     style='border-style: solid; border-width:0px; border-color:lightgray;'>&nbsp;&nbsp;</td>";var A=1;for(var C=0;C<n.length;C++){var q=n[C].split(",")[0];D+="<td align=center style='border-style: solid; border-width:1px;'><small><b>"+sim_signals[q].name+"</b></small></td>";A++}D+="</tr>";var w="<center>";w+="<table style='table-layout:auto; border-style: solid: border-width:0px; border-collapse:collapse;'>";var x=0;var m="";var g="";var F="";for(var C=0;C<z.length;C++){var v=z[C]["mc-start"];var e=z[C].microcode;for(j=0;j<e.length;j++){if(++x%10==1){w=w+D}g="";if(typeof z[C].co!="undefined"){g=parseInt(z[C].co,2)}var t=z[C].signature.split(",")[0];m="";if(j==0){m+="<td style='border-style: solid; border-width:0px; border-color:lightgray;'><span class='badge'>"+t+"</span>&nbsp;</td><td style='border-style: solid; border-width:1px; border-color:lightgray;'>"+g+"</td>"}else{m+="<td style='border-style: solid; border-width:0px; border-color:lightgray;'>&nbsp;</td><td style='border-style: solid; border-width:1px; border-color:lightgray;'>&nbsp;</td>"}if(B){F="0x"+(v+j).toString(16)}else{F=v+j}m+="<td align=center  style='border-style: solid; border-width:1px; border-color:lightgray;' bgcolor=white>"+F+"</td><td bgcolor=white style='border-style: solid; border-width:0px; border-color:lightgray;'>&nbsp;</td>";var f=e[j];for(var y=0;y<n.length;y++){var q=n[y].split(",")[0];var E=parseInt(sim_signals[q].default_value);var p=false;if((typeof f[q]!="undefined")&&(!isNaN(parseInt(f[q])))){E=parseInt(f[q]);p=true}if((q=="SELA"||q=="SELB"||q=="SELE")&&(typeof f.MADDR!="undefined")&&(!isNaN(parseInt(f.MADDR)))){var b=parseInt(f.MADDR).toString(2);b="000000000000".substring(0,12-b.length)+b+"000";if(q=="SELA"){E=parseInt(b.substring(0,5),2);p=true}if(q=="SELB"){E=parseInt(b.substring(5,10),2);p=true}if(q=="SELE"){E=parseInt(b.substring(10,15),2);p=true}}if(B){var b=E.toString(2);var u=parseInt(sim_signals[q].nbits);E="00000000000000000000000000000000".substring(0,u-b.length)+b;var G=n[y].split(",")[1];var d=E.substring(0,G);var a=E.substring(G);E="<font color=green>"+d+"</font>"+a}if(p){m+="<td align=center style='border-style: solid; border-width:1px;'><b>"+E+"</b></td>"}else{m+="<td align=center style='border-style: solid; border-width:1px;'><font color='grey'>"+E+"</font></td>"}}w+="<tr>"+m+"</tr>"}}w+="</table></center>";return w}function labels2html_aux(a,e){var d="";var b="";b="0x"+(parseInt(e)+0).toString(16);if(typeof a[b]!="undefined"){d=d+"<span class='badge'>"+a[b]+"</span>"}else{d=d+"&nbsp;"}b="0x"+(parseInt(e)+1).toString(16);if(typeof a[b]!="undefined"){d=d+"<span class='badge'>"+a[b]+"</span>"}else{d=d+"&nbsp;"}b="0x"+(parseInt(e)+2).toString(16);if(typeof a[b]!="undefined"){d=d+"<span class='badge'>"+a[b]+"</span>"}else{d=d+"&nbsp;"}b="0x"+(parseInt(e)+3).toString(16);if(typeof a[b]!="undefined"){d=d+"<span class='badge'>"+a[b]+"</span>"}else{d=d+"&nbsp;"}return d}function mp2html(g,k,b){var e=new Object();for(l in k){e[k[l]]=l}var h="";h+="<center><table style='table-layout:auto; border-style: solid; border-width:0px;'><tr><th style='border-style: solid; border-width:0px;'>labels</th><th style='border-style: solid; border-width:1px;'>address</th><th style='border-style: solid; border-width:1px;'><table border=0 width=100%><tr><td width=20% align=left>&nbsp;<sub>31</sub></td><td width=60% align=center>content (binary)</td><td width=20% align=right><sub>0</sub>&nbsp;</td></tr></table><th style='border-style: solid; border-width:0px;' align=right>&nbsp;&nbsp;segment</th></tr>";var d="white";for(skey in b){c_begin=parseInt(b[skey].begin);c_end=parseInt(b[skey].end);d=b[skey].color;rows=0;var a="";for(var f=c_begin;f<c_end;f++){c="0x"+f.toString(16);if(typeof g[c]=="undefined"){continue}if(0==rows){h+="<tr style='font-family:verdana; font-size:12pt;'><td align=right  style='border-style: solid; border-width:0px;'>"+labels2html_aux(e,c)+"</td><td              style='border-style: solid; border-width:1px;' bgcolor="+d+">"+c+"</td><td              style='border-style: solid; border-width:1px;' bgcolor="+d+">"+g[c].substr(0,8)+"&nbsp;"+g[c].substr(8,8)+"&nbsp;"+g[c].substr(16,8)+"&nbsp;"+g[c].substr(24,8)+"</td><td rowspan="}else{a+="<tr style='font-family:verdana; font-size:12pt;'><td align=right  style='border-style: solid; border-width:0px;'>"+labels2html_aux(e,c)+"</td><td              style='border-style: solid; border-width:1px;' bgcolor="+d+">"+c+"</td><td              style='border-style: solid; border-width:1px;' bgcolor="+d+">"+g[c].substr(0,8)+"&nbsp;"+g[c].substr(8,8)+"&nbsp;"+g[c].substr(16,8)+"&nbsp;"+g[c].substr(24,8)+"</td></tr>"}rows++}if(0==rows){h+="<tr style='font-family:verdana; font-size:12pt;'><td>&nbsp;</td><td style='border-style: solid; border-width:1px;' bgcolor="+d+">0x"+parseInt(b[skey].begin).toString(16)+"</td><td style='border-style: solid; border-width:1px;' bgcolor="+d+">&nbsp;</td><td rowspan=";a+="<tr style='font-family:verdana; font-size:12pt;'><td>&nbsp;</td><td style='border-style: solid; border-width:1px;' bgcolor="+d+">0x"+parseInt(b[skey].end).toString(16)+"</td><td style='border-style: solid; border-width:1px;' bgcolor="+d+">&nbsp;</td><td>&nbsp;</td></tr>";rows=2}h+=rows+" align=right>"+b[skey].name+"&nbsp;</td></tr>"+a;if(b[skey].name!="stack"){h+="<tr style='font-family:verdana; font-size:12pt;'><td>&nbsp;</td><td valign=middle align=center height=25px>...</td><td valign=middle align=center height=25px>...</td><td>&nbsp;</td></tr>"}}h+="</table></center><br>";return h}function segments2html(a){var b="<br>";b+=" <center> <table height=400px> <tr> <td><table style='border-style: solid' border=1 width=100% height=100%>";for(skey in a){if(a[skey].name!="stack"){b+="<tr><td valign=middle align=center bgcolor="+a[skey].color+">"+a[skey].name+"</td></tr><tr><td valign=middle align=center height=25px>...</td></tr>"}}b+="<tr><td valign=middle align=center bgcolor="+a.stack.color+">"+a.stack.name+"</td></tr></table> </td> <td width=20px>&nbsp;</td> <td> <table style='border-style: solid; border-width:0px; width:100%; height:100%'>";var d=0;for(skey in a){d+=1;if(a[skey].name!="stack"){b+="<tr>    <td valign=middle align=center style='display: block; position: absolute;'>    <div id='compile_begin_"+a[skey].name+"'          style='position:relative; bottom:"+(3*d)+"px;'>"+a[skey].begin+"</div>    </td> </tr> <tr>    <td valign=middle align=center style='display: block; position: absolute;'>    <div id='compile_end_"+a[skey].name+"'          style='position:relative; bottom:"+(2*d)+"px;'>"+a[skey].end+"</div>    </td> </tr>"}}b+="  <tr>  <td valign=middle align=center style='display: block; position: absolute;'><div id='compile_end_"+a.stack.name+"' style='position:relative;bottom:25px;'>[SP_n]</div><div id='compile_begin_"+a.stack.name+"' style='position:relative;bottom:-20px;'>[SP_0]</div>  </td>  </tr> </table> </td> </tr> </table> </center>";return b}function assembly2html(d,h,f,e){var k="";var m="";var g="";var i="";var b="#F0F0F0";var a="";a+="<center><table data-role=table class='table ui-responsive'><tbody>";for(l in e){if(b=="#F0F0F0"){b="#F8F8F8"}else{b="#F0F0F0"}e[l].bgcolor=b;r=e[l].source.split(":");if(r.length>1){k=r[0]+":";m=r[1]}else{k="&nbsp;";m=r[0]}r=e[l].source_original.split(":");if(r.length>1){g=r[0]+":";i=r[1]}else{g="&nbsp;";i=r[0]}a+="<tr id='asmdbg"+l+"' bgcolor='"+e[l].bgcolor+"'><td style='line-height:0.9;' width='10%' id='bp"+l+"'     onclick='asmdbg_set_breakpoint("+l+"); if(event.stopPropagation) event.stopPropagation();'>&nbsp;</td><td style='line-height:0.9;' width='15%'>"+l+"</td><td style='line-height:0.9;' width='12%' align=right>"+k+"</td><td style='line-height:0.9;' width='25%' align=left>"+m+"</td><td style='line-height:0.9;' width='12%' align=right>"+g+"</td><td style='line-height:0.9;' width='25%' align=left>"+i+"</td></tr>"}a+="</tbody></table></center>";return a}function asmdbg_set_breakpoint(f){var a=get_simware();var b="0x"+f.toString(16);var e=document.getElementById("bp"+b);var d=a.assembly[b].breakpoint;if(d===true){d=false;e.innerHTML="&nbsp;"}else{d=true;e.innerHTML='<img height=22 src="images/stop.png">'}a.assembly[b].breakpoint=d}var DBG_stop=true;var DBG_delay=300;var DBG_level="instruction";function asmdbg_stop(a){$(a).text("Run");$(a).removeClass("ui-icon-minus");$(a).addClass("ui-icon-carat-r");$(a).css("backgroundColor","#313131");DBG_stop=true}function asmdbg_play(d){$(d).css("backgroundColor","rgb(51, 136, 204)");$(d).text("Stop");$(d).removeClass("ui-icon-carat-r");$(d).addClass("ui-icon-minus");if(DBG_stop){asmdbg_stop(d);return}var b=false;if(DBG_level=="instruction"){b=execute_instruction()}else{b=execute_microinstruction()}if(b===false){asmdbg_stop(d);return}var a=get_simware();reg_pc=sim_states.REG_PC.value;curr_addr="0x"+reg_pc.toString(16);if((typeof a.assembly[curr_addr]!="undefined")&&(a.assembly[curr_addr].breakpoint)){asmdbg_stop(d);alert("Breakpoint @ "+curr_addr+":\nInstruction at "+curr_addr+" is going to be fetched.");return}setTimeout(asmdbg_play,DBG_delay,d)}function check_ib(g){var a="";var e=["T1","T2","T3","T4","T5","T6","T7","T8","T9","T10"];if(e.indexOf(g)==-1){return}var d=0;var f="";for(var b=0;b<e.length;b++){a=e[b];if(sim_signals[a].value!=0){d++;f=a}if(d>1){break}}if(d>0){update_draw(sim_signals[f],1)}$("#busfire").hide();if(d>1){$("#busfire").show();sim_states.BUS_IB.value=4294967295}}function check_behavior(){for(var e in sim_signals){for(var g in sim_signals[e].behavior){var a=sim_signals[e].behavior[g].split(";");for(var d=0;d<a.length;d++){var b=a[d].trim();var h=b.split(" ");if(typeof(syntax_behavior[h[0]])=="undefined"){alert("ALERT: Unknown operation -> "+h[0]+" ("+b+")");return}if(h.length!=syntax_behavior[h[0]].nparameters){alert("ALERT: Behavior has an incorrect number of elements --> "+b+"/"+syntax_behavior[h[0]].nparameters);return}for(var d=1;d<h.length;d++){if("E"==syntax_behavior[h[0]].types[d-1]){var f=h[d].split("/");if(typeof(sim_states[f[0]])=="undefined"){alert("ALERT: Behavior has an undefined reference to a object state -> '"+b);return}}else{if("S"==syntax_behavior[h[0]].types[d-1]){var f=h[d].split("/");if(typeof(sim_signals[f[0]])=="undefined"){alert("ALERT: Behavior has an undefined reference to a signal -> '"+b);return}}}}}}}}function load_check(){if(0==sim_signals.length){alert("ALERT: empty signals!!!")}if(0==sim_states.length){alert("ALERT: empty states!!!")}check_behavior()}function compute_behavior(d){var e=d.split(";");for(var b=0;b<e.length;b++){e[b]=e[b].trim();if(""==e[b]){continue}var a=e[b].split(" ");syntax_behavior[a[0]].operation(a)}}function update_state(b){var a=0;var d="";switch(sim_signals[b].behavior.length){case 0:return;break;case 1:a=sim_signals[b].value;d=sim_signals[b].behavior[0];break;default:a=sim_signals[b].value;if(a<sim_signals[b].behavior.length){d=sim_signals[b].behavior[a]}else{alert("ALERT: there are more signals values than behaviors defined!!!!\nkey: "+b+" and signal value: "+a)}break}compute_behavior(d)}function update_signal_firmware(d){var a=get_simware();var g=-1;for(var b=0;b<a.firmware.length;b++){if(parseInt(a.firmware[b]["mc-start"])>sim_states.REG_MICROADDR.value){break}g=b}if(-1==g){alert("A new 'unknown' instruction is inserted,\nplease edit it (co, nwords, etc.) in the firmware textarea.");var e=new Object();e.name="unknown";e.signature="unknown";e.signatureGlobal="unknown";e.co=0;e.nwords=0;e["mc-start"]=0;e.fields=new Array();e.microcode=new Array();a.firmware.push(e);g=a.firmware.length-1}var h=sim_states.REG_MICROADDR.value-parseInt(a.firmware[g]["mc-start"]);if(typeof a.firmware[g]["microcode"][h]=="undefined"){a.firmware[g]["microcode"][h]=new Object()}a.firmware[g]["microcode"][h][d]=sim_signals[d].value;if(sim_signals[d].default_value==sim_signals[d].value){delete a.firmware[g]["microcode"][h][d]}var f=sim_states.REG_IR.value.toString(2);f="00000000000000000000000000000000".substring(0,32-f.length)+f;show_memories("MP",MP,sim_states.REG_PC.value);show_memories("MC",MC,sim_states.REG_MICROADDR.value)}function update_signal(b){if(false===is_interactive){return}var e=null;for(var m in sim_signals){for(var f=0;f<sim_signals[m].fire_name.length;f++){var a=sim_signals[m].fire_name[f].split(":");if(a[1]==b.currentTarget.id){if(sim_signals[m].nbits==1){sim_signals[m].value=(sim_signals[m].value+1)%2}if(sim_signals[m].nbits>1){var i="";var h=Math.pow(2,sim_signals[m].nbits);if(sim_signals[m].behavior.length==h){for(var d=0;d<sim_signals[m].behavior.length;d++){i=i+"\n  "+d.toString(10);i=i+": "+sim_signals[m].behavior[d].split(";")[0]}}else{i=i+"\n  0 - "+(h-1)}if(e==null){e=prompt("Decimal values for "+m+": "+i+"\n",sim_signals[m].value)}if(e!=null){sim_signals[m].value=e}}if(true===is_interactive){sim_states.REG_MICROINS.value[m]=sim_signals[m].value;if(typeof MC[sim_states.REG_MICROADDR.value]=="undefined"){MC[sim_states.REG_MICROADDR.value]=new Object()}MC[sim_states.REG_MICROADDR.value][m]=sim_signals[m].value;update_signal_firmware(m);var g=get_simware();document.getElementById("inputFirmware").value=saveFirmware(g)}compute_behavior("FIRE "+m)}}}show_states();show_rf()}function update_memories(q){set_simware(q);var h=get_simware();MC=new Object();for(var d=0;d<h.firmware.length;d++){var p=h.firmware[d]["microcode"].length;var k=h.firmware[d]["mc-start"];for(var b=0;b<p;b++){MC[k]=h.firmware[d]["microcode"][b];k++}}ROM=new Object();for(var d=0;d<h.firmware.length;d++){if("fetch"==h.firmware[d]["name"]){continue}var o=h.firmware[d]["mc-start"];var m=parseInt(h.firmware[d]["co"],2);var a=0;if(typeof h.firmware[d]["cop"]!="undefined"){a=parseInt(h.firmware[d]["cop"],2)}var e=64*m+a;ROM[e]=o;h.cihash[e]=h.firmware[d]["signature"]}MP=new Object();for(var n in h.mp){var f=parseInt(n);var g=parseInt(h.mp[n].replace(/ /g,""),2);MP[f]=g}segments=new Object();for(var n in h.seg){segments[n]=h.seg[n]}show_memories("MP",MP,1);show_memories("MC",MC,1)}function init(){load_check();init_states("#states_ALL");init_rf("#states_BR");init_stats("#stats_ALL");init_io("#io_ALL")}function init_eventlistener(){for(var b in sim_signals){for(var a=0;a<sim_signals[b].fire_name.length;a++){var d=sim_signals[b].fire_name[a].split(":");var e=document.getElementById(d[0]).contentDocument;if(e!=null){e.getElementById(d[1]).addEventListener("click",update_signal,false)}}}}function set_interactive_mode(a){is_interactive=a}function get_interactive_mode(){return is_interactive}function reset(){compute_behavior("RESET");if(typeof segments.code!="undefined"){sim_states.REG_PC.value=parseInt(segments.code.begin);show_asmdbg_pc()}if(typeof segments.stack!="undefined"){sim_states.BR[FIRMWARE.stackRegister]=parseInt(segments.stack.begin)}compute_behavior("CLOCK")}function execute_microinstruction(){if(false===is_interactive){if(typeof segments.code=="undefined"){alert("code segment does not exist!");return false}if((parseInt(sim_states.REG_MICROADDR.value)==0)&&((parseInt(sim_states.REG_PC.value)>=parseInt(segments.code.end))||(parseInt(sim_states.REG_PC.value)<parseInt(segments.code.begin)))){alert("PC register points outside the code segment!");return false}}compute_behavior("CLOCK")}function execute_microprogram(){do{compute_behavior("CLOCK")}while((0!=sim_states.REG_MICROADDR.value)&&(typeof MC[sim_states.REG_MICROADDR.value]!="undefined"))}function execute_instruction(){if(typeof segments.code=="undefined"){alert("code segment does not exist!");return false}if((parseInt(sim_states.REG_MICROADDR.value)==0)&&((parseInt(sim_states.REG_PC.value)>=parseInt(segments.code.end))||(parseInt(sim_states.REG_PC.value)<parseInt(segments.code.begin)))){alert("PC register points outside the code segment!");return false}execute_microprogram();return true}function load_firmware(a){if(""==a.trim()){var d=new Object();d.error="Empty Firmware";return d}try{var d=JSON.parse(a);update_memories(d);d.error=null;return d}catch(b){try{var d=loadFirmware(a);if(d.error==null){update_memories(d)}return d}catch(b){var d=new Object();d.error="ERROR: at line: "+b.lineNumber+" and column: "+b.columnNumber;return d}}}function nextToken(b){while(("# \t\n\r".indexOf(b.text[b.t])!=-1)&&(b.t<b.text.length)){if(b.text[b.t]=="#"){while(("\n".indexOf(b.text[b.t])==-1)&&(b.t<b.text.length)){b.t++}}if(b.text[b.t]=="\n"){b.line++;b.newlines.push(b.t)}b.t++}if(("{},()=:".indexOf(b.text[b.t])!=-1)&&(b.t<b.text.length)){var a=b.text[b.t];b.t++;b.tokens.push(a);b.i=b.tokens.length-1;return b}var e=b.t;while(("{},()=:# \t\n\r".indexOf(b.text[b.t])==-1)&&(b.t<b.text.length)){b.t++}var d=b.t;var a=b.text.substring(e,d);a=a.toLowerCase().trim();b.tokens.push(a);b.i=b.tokens.length-1;return b}function getToken(a){return a.tokens[a.i]}function isToken(a,b){return(getToken(a)==b.trim())}function firmwareError(f,g){var a=0;if(f.newlines.length>0){a=f.newlines[f.newlines.length-1]+1}var d=0;if(f.newlines.length>1){d=f.newlines[f.newlines.length-2]+1}var b=d;var h=f.t;for(;(typeof f.text[h+1]!="undefined")&&(f.text[h+1]!="\n");h++){}var k=h+2;h++;for(;(typeof f.text[h+1]!="undefined")&&(f.text[h+1]!="\n");h++){}f.error="...\n";for(var e=b;e<h;e++){if(e==d){f.error+=" "+(f.line-1)+"\t"}if(e==a){f.error+="*"+f.line+"\t"}if(e==k){f.error+=" "+(f.line+1)+"\t"}f.error+=f.text[e]}f.error+="\n...\n\n(*) Problem around line "+f.line+": "+g+".\n";return f}function read_microprg(a){var d=new Array();if(!isToken(a,"{")){return firmwareError(a,"Expected '{' not found")}nextToken(a);while(!isToken(a,"}")){var h=new Object();if(!isToken(a,"(")){var i=getToken(a);for(var b in a.etiquetas){if(a.etiquetas[b]==i){return firmwareError(a,"Label '"+getToken(a)+"' is repeated")}}a.etiquetas[a.contadorMC]=i;if(a.tokens[a.i].match("[a-zA-Z_0-9]*")[0]!=getToken(a)){return firmwareError(a,"Label '"+getToken(a)+"' not valid")}nextToken(a);if(!isToken(a,":")){return firmwareError(a,"Expected ':' for label '"+a.etiquetas[a.contadorMC]+"' not found")}nextToken(a)}if(!isToken(a,"(")){return firmwareError(a,"Expected '(' not found")}nextToken(a);while(!isToken(a,")")){var f=getToken(a).toUpperCase();if(f=="MADDR"){nextToken(a);if(!isToken(a,"=")){return firmwareError(a,"Expected '=' not found")}nextToken(a);var m=new Object();m.nombre=getToken(a);m.cycle=d.length;m.index=a.i;m.instruction=a.instrucciones.length;var e=0;for(var g in a.etiquetas){if(isToken(a,a.etiquetas[g])){h[f]=g.toString();e=1}}if(e==0){a.labelsNotFound.push(m)}nextToken(a);if(isToken(a,",")){nextToken(a)}continue}if(typeof sim_signals[f]=="undefined"){return firmwareError(a,"Signal '"+f+"' does not exists")}h[f]=1;nextToken(a);if(isToken(a,"=")){nextToken(a);h[f]=parseInt(getToken(a),2);if(getToken(a).match("[01]*")[0]!=getToken(a)){return firmwareError(a,"Incorrect binary format: "+getToken(a))}if(h[f]>=Math.pow(2,sim_signals[f].nbits)){return firmwareError(a,"Value out of range: "+getToken(a))}nextToken(a)}if(isToken(a,",")){nextToken(a)}}d.push(h);a.contadorMC++;nextToken(a);if(isToken(a,",")){nextToken(a)}}nextToken(a);return d}function loadFirmware(n){var b=new Object();b.line=1;b.error=null;b.i=0;b.contadorMC=0;b.etiquetas=new Object();b.labelsNotFound=new Array();b.instrucciones=new Array();b.co_cop=new Object();b.registers=new Array();b.text=n;b.tokens=new Array();b.t=0;b.newlines=new Array();b.pseudoInstructions=new Array();b.stackRegister=null;nextToken(b);while(b.t<b.text.length){if(isToken(b,"registers")){nextToken(b);if(!isToken(b,"{")){return firmwareError(b,"Expected '{' not found")}nextToken(b);while(!isToken(b,"}")){var d=getToken(b);nextToken(b);if(!isToken(b,"=")){return firmwareError(b,"Expected '=' not found")}nextToken(b);b.registers[d]=getToken(b);nextToken(b);if(isToken(b,"(")){if(b.stackRegister!=null){return firmwareError(b,"Duplicate definition of stack pointer")}nextToken(b);if(!isToken(b,"stack_pointer")){return firmwareError(b,"Expected stack_pointer token not found")}b.stackRegister=d;nextToken(b);if(!isToken(b,")")){return firmwareError(b,"Expected ')' not found")}nextToken(b)}if(isToken(b,",")){nextToken(b)}}nextToken(b);continue}if(isToken(b,"pseudoinstructions")){nextToken(b);if(!isToken(b,"{")){return firmwareError(b,"Expected '{' not found")}nextToken(b);while(!isToken(b,"}")){var q=new Object();var p=new Object();p.signature="";p.name="";p.fields=new Array();p.name=getToken(b);p.signature=p.signature+getToken(b)+",";nextToken(b);while(!isToken(b,"{")){var h=new Object();h.name=getToken(b);p.fields.push(h);p.signature=p.signature+getToken(b)+",";nextToken(b);if(isToken(b,",")){nextToken(b)}}nextToken(b);q.initial=p;var v=0;var x=new Object();x.signature="";while(!isToken(b,"}")){x.signature=x.signature+getToken(b)+" ";nextToken(b)}q.finish=x;q.finish.signature=q.finish.signature.replace(";","\n");b.pseudoInstructions.push(q);nextToken(b)}nextToken(b);continue}if(isToken(b,"fetch")){var o=new Object();o.name=getToken(b);o["mc-start"]=b.contadorMC;nextToken(b);var y=read_microprg(b);if(typeof y.error!="undefined"){return y}o.signature="fetch";o.signatureGlobal="fetch";o.microcode=y;b.instrucciones.push(o);b.contadorMC=b.contadorMC+9;continue}var o=new Object();o.name=getToken(b);o["mc-start"]=b.contadorMC;var s="";var f="";var a=0;var k=new Array();s=s+getToken(b)+",";nextToken(b);while(isToken(b,",")){nextToken(b)}while(!isToken(b,"{")){while(isToken(b,",")){nextToken(b)}if(!isToken(b,",")&&!isToken(b,"(")&&!isToken(b,")")){var w=new Object();w.name=getToken(b);k.push(w);a++;s=s+getToken(b);nextToken(b)}if(isToken(b,"(")){s=s+"(";nextToken(b);if(!isToken(b,",")&&!isToken(b,"(")&&!isToken(b,")")){var w=new Object();w.name=getToken(b);k.push(w);a++;s=s+getToken(b);nextToken(b)}else{return firmwareError(b,"'token' is missing after '(' on: "+b.co_cop[o.co].signature)}if(isToken(b,")")){s=s+")";nextToken(b)}else{return firmwareError(b,"')' is missing on: "+b.co_cop[o.co].signature)}}s=s+","}s=s.substr(0,s.length-1);o.signature=s;o.signatureGlobal=s;nextToken(b);if(!isToken(b,"co")){return firmwareError(b,"Expected keyword 'co' not found")}nextToken(b);if(!isToken(b,"=")){return firmwareError(b,"Expected '=' not found")}nextToken(b);o.co=getToken(b);if((getToken(b).match("[01]*")[0]!=getToken(b))||(getToken(b).length!=6)){return firmwareError(b,"Incorrect binary format on 'co': "+getToken(b))}if((typeof b.co_cop[o.co]!="undefined")&&(b.co_cop[o.co].cop==null)){return firmwareError(b,"'co' is already been used by: "+b.co_cop[o.co].signature)}b.co_cop[o.co]=new Object();b.co_cop[o.co].signature=o.signature;b.co_cop[o.co].cop=null;nextToken(b);if(isToken(b,",")){nextToken(b)}if(isToken(b,"cop")){nextToken(b);if(!isToken(b,"=")){return firmwareError(b,"Expected '=' not found")}nextToken(b);o.cop=getToken(b);if((getToken(b).match("[01]*")[0]!=getToken(b))||(getToken(b).length!=4)){return firmwareError(b,"Incorrect binary format on 'cop': "+getToken(b))}if((b.co_cop[o.co].cop!=null)&&(typeof b.co_cop[o.co].cop[o.cop]!="undefined")){return firmwareError(b,"'co+cop' is already been used by: "+b.co_cop[o.co].cop[o.cop])}if(b.co_cop[o.co].cop==null){b.co_cop[o.co].cop=new Object()}b.co_cop[o.co].cop[o.cop]=o.signature;nextToken(b);if(isToken(b,",")){nextToken(b)}}if(!isToken(b,"nwords")){return firmwareError(b,"Expected keyword 'nwords' not found")}nextToken(b);if(!isToken(b,"=")){return firmwareError(b,"Expected '=' not found")}nextToken(b);o.nwords=getToken(b);nextToken(b);if(isToken(b,",")){nextToken(b)}var g=0;while(g<a){k[g]["name"]=getToken(b);nextToken(b);if(!isToken(b,"=")){return firmwareError(b,"Expected '=' not found")}nextToken(b);if(!isToken(b,"reg")&&!isToken(b,"inm")&&!isToken(b,"address")){return firmwareError(b,"Incorrect type of field (reg, inm or address)")}k[g]["type"]=getToken(b);s=s.replace(","+k[g]["name"],","+k[g]["type"]);s=s.replace("("+k[g]["name"],"("+k[g]["type"]);s=s.replace(")"+k[g]["name"],")"+k[g]["type"]);o.signature=s;f=s.replace("address","num");f=f.replace("inm","num");o.signatureGlobal=f;nextToken(b);if(!isToken(b,"(")){return firmwareError(b,"Expected '(' not found")}nextToken(b);k[g]["startbit"]=getToken(b);if(parseInt(k[g]["startbit"])>32*parseInt(o.nwords)){return firmwareError(b,"startbit out of range: "+getToken(b))}nextToken(b);if(!isToken(b,",")){return firmwareError(b,"Expected ',' not found")}nextToken(b);k[g]["stopbit"]=getToken(b);if(parseInt(k[g]["stopbit"])>32*parseInt(o.nwords)){return firmwareError(b,"stopbit out of range: "+getToken(b))}nextToken(b);if(!isToken(b,")")){return firmwareError(b,"Expected ')' not found")}nextToken(b);if(k[g]["type"]=="address"){if(getToken(b)!="abs"&&getToken(b)!="rel"){return firmwareError(b,"Type of addressing incorrect (abs or rel)")}k[g]["address_type"]=getToken(b);nextToken(b)}if(isToken(b,",")){nextToken(b)}g++}o.fields=k;var y=read_microprg(b);if(typeof y.error!="undefined"){return y}o.microcode=y;b.instrucciones.push(o);b.contadorMC=b.contadorMC+9;if(!isToken(b,"}")){return firmwareError(b,"Expected '}' not found")}nextToken(b)}var m=false;for(var u=0;u<b.instrucciones.length;u++){if(b.instrucciones[u].name=="fetch"){for(var t=0;t<b.instrucciones[u].microcode.length;t++){if((typeof b.etiquetas[t]!="undefined")&&(b.etiquetas[t]=="fetch")){m=true}}if(m===false){return firmwareError(b,"label 'fetch' not defined")}}}if(m===false){return firmwareError(b,"'fetch' not found")}var e=0;if(b.labelsNotFound.length>0){for(var u=0;u<b.labelsNotFound.length;u++){for(var t in b.etiquetas){if(b.etiquetas[t]==b.labelsNotFound[u].nombre){b.instrucciones[b.labelsNotFound[u].instruction].microcode[b.labelsNotFound[u].cycle].MADDR=t;e++}}if(e==0){return firmwareError(b,"MADDR label not found : "+b.labelsNotFound[u].nombre)}}}var y=new Object();y.error=null;y.firmware=b.instrucciones;y.labels=b.etiquetas;y.mp=new Object();y.seg=new Object();y.registers=b.registers;y.pseudoInstructions=b.pseudoInstructions;y.stackRegister=b.stackRegister;return y}function saveFirmware(a){var f="";for(var e=0;e<a.firmware.length;e++){f+=a.firmware[e].name;if(typeof a.firmware[e].fields!="undefined"){if(a.firmware[e].fields.length>0){for(var d=0;d<a.firmware[e].fields.length;d++){f+=" "+a.firmware[e].fields[d].name}}}f+=" {\n";if(typeof a.firmware[e].co!="undefined"){f+="\tco="+a.firmware[e].co+",\n"}if(typeof a.firmware[e].cop!="undefined"){f+="\tcop="+a.firmware[e].cop+",\n"}if(typeof a.firmware[e].nwords!="undefined"){f+="\tnwords="+a.firmware[e].nwords+",\n"}if(typeof a.firmware[e].fields!="undefined"){if(a.firmware[e].fields.length>0){for(var d=0;d<a.firmware[e].fields.length;d++){f+="\t"+a.firmware[e].fields[d].name+" = "+a.firmware[e].fields[d].type;f+=" ("+a.firmware[e].fields[d].startbit+","+a.firmware[e].fields[d].stopbit+")";if(a.firmware[e].fields[d].type=="address"){f+=a.firmware[e].fields[d].address_type}f+=",\n"}}}if(typeof a.firmware[e].microcode!="undefined"){var h=a.firmware[e]["mc-start"];if(a.firmware[e].name!="fetch"){f+="\t{"}for(var d=0;d<a.firmware[e].microcode.length;d++){f+="\n\t\t";if(typeof a.labels[h]!="undefined"){f+=a.labels[h]+" : "}f+="( ";var g=0;for(var b in a.firmware[e].microcode[d]){if(b!="MADDR"){f+=b+"="+a.firmware[e].microcode[d][b].toString(2)+", "}else{f+=b+"="+a.labels[a.firmware[e].microcode[d][b]]+", "}g=1}if(g==1){f=f.substr(0,f.length-1)}f+="),";h++}f=f.substr(0,f.length-1);if(a.firmware[e].name!="fetch"){f+="\n\t}"}}f+="\n}\n\n"}if((typeof a.registers!="undefined")&&(a.registers.length>0)){f+="registers\n{\n";for(var e=0;e<a.registers.length;e++){if(a.stackRegister==e){f+="\t$"+e+"="+a.registers[e]+" (stack_pointer),\n"}else{f+="\t$"+e+"="+a.registers[e]+",\n"}}f=f.substr(0,f.length-2);f+="\n}\n"}return f}function decode_instruction(b){var d=b.substring(0,6);var f=b.substring(28,32);var a=null;for(var e in FIRMWARE.firmware){if(FIRMWARE.firmware[e].name=="fetch"){continue}if((FIRMWARE.firmware[e].co==d)&&(typeof FIRMWARE.firmware[e].cop=="undefined")){a=FIRMWARE.firmware[e];break}if((FIRMWARE.firmware[e].co==d)&&(typeof FIRMWARE.firmware[e].cop!="undefined")&&(FIRMWARE.firmware[e].cop==f)){a=FIRMWARE.firmware[e];break}}return a}function show_decode_instruction(f,h){if(null==f){return"ERROR: instruction "+co+" not found"}var b=f.name+" ";var a=f.signature.split(",");var g=parseInt(f.nwords)*32;for(var d=1;d<a.length;d++){if(((f.fields[d-1].stopbit)<(g-1))&&((f.fields[d-1].stopbit)>(g-1-32))){var e=h.substring(g-f.fields[d-1].startbit-1,g-f.fields[d-1].stopbit);if(a[d]=="reg"){b+="$"+parseInt(e,2)+" "}else{b+="0x"+parseInt(e,2).toString(16)+" "}}else{b+="... "}}return b}function decode_ram(){var d="\n";for(var a in MP){var b=MP[a].toString(2);b="00000000000000000000000000000000".substring(0,32-b.length)+b;d+="0x"+parseInt(a).toString(16)+":"+decode_instruction(b)+"\n"}return d}function dataSegment(v,D){var s=parseInt(D.begin);var q=1;var f=new Array();var w=new Array();var b=new Object();var g=new Object();var x=s;var E=s;var C=0;var A=0;var o=0;for(C=0;C<v.length;C++){A=0;var t=v[C].split('"');if(t.length>1){t[0]=t[0].replace(/:/g," : ");t[0]=t[0].replace(/,/g," , ");t[0]=t[0].replace(/\(/g," ( ");t[0]=t[0].replace(/\)/g," )");t[0]=t[0].replace(/#/g,"# ");t[0]=t[0].replace(/\t/g,"");t[0]=t[0].replace(/  /g," ");t[0]=t[0].replace(/\s{2,}/g," ");t[0]=t[0].trim();var p=t[0].split(" ");if(p[0].trim()=="#"||p[0].trim()==""){if(p[0].trim()=="#"){}else{}}else{var e=new Object();var u=0;var d="";var a=new Array();var B;e.name=p[A].trim();A++;if(p[A].trim()!=":"){return assemblyError("Error, ':' not found: ",t[0],A)}A++;switch(p[A].trim()){case".ascii":B=0;if(B>q){q=B}e.tipo=p[A].trim();A++;d=t[1];for(o=0;o<d.length;o++){var n="00000000";if(d[o]=='"'){if(d[o+1]=="t"){var m=9;n=n+m.toString(2);m=n.substr(n.length-1-8,8);a.push(m);o++}else{if(d[o+1]=="n"){var m=10;n=n+m.toString(2);m=n.substr(n.length-1-8,8);a.push(m);o++}else{if(d[o+1]=="0"){var m=0;n=n+m.toString(2);m=n.substr(n.length-1-8,8);a.push(m);o++}else{var m=d.charCodeAt(o).toString(2);n=n+m;m=n.substr(n.length-1-8,8);a.push(m)}}}}else{var m=d.charCodeAt(o).toString(2);n=n+m;m=n.substr(n.length-1-8,8);a.push(m)}}u=a.length;e.contenido=d;e.longitud=u;e.traduccion=a;while(s%Math.pow(2,q)!=0){b[x]="00000000";x++;s++}for(o=0;o<a.length;o++){b[x]=a[o];x++}e.posicion="0x"+s.toString(16);s=s+u;x=s;q=0;break;case".asciiz":B=0;e.tipo=p[A].trim();if(B>q){q=B}A++;d=t[1];A++;for(o=0;o<d.length;o++){var n="00000000";if(d[o]=='"'){if(d[o+1]=="t"){var m=9;n=n+m.toString(2);m=n.substr(n.length-1-8,8);a.push(m);o++}else{if(d[o+1]=="n"){var m=10;n=n+m.toString(2);m=n.substr(n.length-1-8,8);a.push(m);o++}else{if(d[o+1]=="0"){var m=0;n=n+m.toString(2);m=n.substr(n.length-1-8,8);a.push(m);o++}else{var m=d.charCodeAt(o).toString(2);n=n+m;m=n.substr(n.length-1-8,8);a.push(m)}}}}else{var m=d.charCodeAt(o).toString(2);n=n+m;m=n.substr(n.length-1-8,8);a.push(m)}}var m=0;n="00000000";n=n+m.toString(2);m=n.substr(n.length-1-8,8);a.push(m);u=a.length;d=d+"\0";e.contenido=d;e.traduccion=a;e.longitud=u;while(s%Math.pow(2,q)!=0){b[x]="00000000";x++;s++}for(o=0;o<a.length;o++){b[x]=a[o];x++}e.posicion="0x"+s.toString(16);s=s+u;x=s;q=0;break;default:return assemblyError("Error, type of variable incorrect: ",t[0],A);break}w.push(e)}}else{v[C]=v[C].replace(/:/g," : ");v[C]=v[C].replace(/,/g," , ");v[C]=v[C].replace(/\(/g," ( ");v[C]=v[C].replace(/\)/g," ) ");v[C]=v[C].replace(/#/g,"# ");v[C]=v[C].replace(/\t/g,"");v[C]=v[C].replace(/  /g," ");v[C]=v[C].replace(/\s{2,}/g," ");v[C]=v[C].trim();var t=v[C].split(" ");if(t[A]=="#"||t[A].trim()==""){if(t[A]=="#"){}else{}}else{if(t[A].trim()==".align"||t[A].trim()==".text"){if(t[A].trim()==".text"){break}else{A++;q=parseInt(t[A].trim())}}else{var e=new Object();var a=new Array();var u=0;var d="";var y="";var k=0;var B;e.name=t[A].trim();A++;if(t[A].trim()!=":"){return assemblyError("Error, ':' not found: ",t,A)}A++;switch(t[A].trim()){case".byte":B=0;if(B>q){q=B}e.tipo=t[A].trim();A++;do{if(t[A].trim()==","){y=y+",";A++}if(t[A].trim().toLowerCase().substring(0,2)=="0x"){if(t[A].trim().substr(2,t[A].trim().length-2).match(/^[0-9a-fA-F]+$/)){d=parseInt(t[A].trim()).toString()}else{return assemblyError("Error in Hex format: ",t,A)}}else{if(t[A].trim().substring(0,1)=="0"&&t[A].trim().match(/^[0-9]+$/)){d=parseInt(t[A].trim(),8).toString()}else{if(t[A].trim().match(/^[0-9]+$/)){d=parseInt(t[A].trim(),10).toString()}else{if(t[A].trim().substring(0,1)=="'"&&t[A].trim().length>2){if(t[A].trim().substring(t[A].trim().length-1,1)!="'"){var h=t[A];if(h.length==3){d=h[1].charCodeAt()}else{if(h==4){if(h[2]=="t"){d=parseInt("9")}else{if(h[2]=="n"){d=parseInt("10")}else{if(h[2]=="0"){d=parseInt("10")}else{return assemblyError("Error, char format incorrect: ",t,A)}}}}else{return assemblyError("Error, char format incorrect: ",t,A)}}}else{return assemblyError("Error, char format incorrect: ",t,A)}}else{if(t[A].trim()=="'"&&t[A+1].trim()=="'"){var h=" ";d=h.charCodeAt();A++}else{if(t[A].trim()=="'#"&&t[A+1].trim()=="'"){var h="#";d=h.charCodeAt();A++}else{if((t[A].trim()=="'"&&t[A+2].trim()=="'")&&(t[A+1].trim()==":"||t[A+1].trim()==","||t[A+1].trim()=="("||t[A+1].trim()==")")){var h=t[A+1].trim();d=h.charCodeAt();A=A+2}else{return assemblyError("Error, numeric format incorrect: ",t,A)}}}}}}}y=y+d;d=parseInt(d).toString(2);if(d.length>8){}var n="00000000000000000000000000000000".substring(0,32-d.length)+d;d=n.substr(24,8);a.push(d);k++;A++}while(A<t.length&&t[A].trim()==",");e.contenido=y;e.traduccion=a;e.longitud=k;while(s%Math.pow(2,q)!=0){b[x]="00000000";x++;s++}for(o=0;o<a.length;o++){b[x]=a[o];x++}e.posicion="0x"+s.toString(16);s=s+k;x=s;q=0;break;case".half":B=1;if(B>q){q=B}e.tipo=t[A].trim();A++;do{if(t[A].trim()==","){y=y+",";A++}if(t[A].trim().toLowerCase().substring(0,2)=="0x"){if(t[A].trim().substr(2,t[A].trim().length-2).match(/^[0-9a-fA-F]+$/)){d=parseInt(t[A].trim()).toString()}else{return assemblyError("Error in Hex format: ",t,A)}}else{if(t[A].trim().substring(0,1)=="0"&&t[A].trim().match(/^[0-9]+$/)){d=parseInt(t[A].trim(),8).toString()}else{if(t[A].trim().match(/^[0-9]+$/)){d=parseInt(t[A].trim(),10).toString()}else{return assemblyError("Error, numeric format incorrect: ",t,A)}}}y=y+d;d=parseInt(d).toString(2);if(d.length>16){}var n="00000000000000000000000000000000".substring(0,32-d.length)+d;d=n.substr(16,16);a.push(d);k=k+2;A++}while(A<t.length&&t[A].trim()==",");e.contenido=y;e.traduccion=a;e.longitud=k;while(s%Math.pow(2,q)!=0){b[x]="00000000";x++;s++}for(o=0;o<a.length;o++){b[x]=a[o].substr(8,8);x++;b[x]=a[o].substr(0,8);x++}e.posicion="0x"+s.toString(16);s=s+k;x=s;q=0;break;case".word":B=2;if(B>q){q=B}e.tipo=t[A].trim();A++;do{if(t[A].trim()==","){y=y+",";A++}if(t[A].trim().toLowerCase().substring(0,2)=="0x"){if(t[A].trim().substr(2,t[A].trim().length-2).match(/^[0-9a-fA-F]+$/)){d=parseInt(t[A].trim()).toString()}else{return assemblyError("Error in Hex format: ",t,A)}}else{if(t[A].trim().substring(0,1)=="0"&&t[A].trim().match(/^[0-9]+$/)){d=parseInt(t[A].trim(),8).toString()}else{if(t[A].trim().match(/^[0-9]+$/)){d=parseInt(t[A].trim(),10).toString()}else{return assemblyError("Error, numeric format incorrect: ",t,A)}}}y=y+d;d=parseInt(d).toString(2);if(d.length>32){}var n="00000000000000000000000000000000".substring(0,32-d.length)+d;d=n;a.push(d);k=k+4;A++}while(A<t.length&&t[A].trim()==",");e.contenido=y;e.traduccion=a;e.longitud=k;while(s%Math.pow(2,q)!=0){b[x]="00000000";x++;s++}for(o=0;o<a.length;o++){b[x]=a[o].substr(24,8);x++;b[x]=a[o].substr(16,8);x++;b[x]=a[o].substr(8,8);x++;b[x]=a[o].substr(0,8);x++}e.posicion="0x"+s.toString(16);s=s+k;x=s;q=0;break;case".space":B=0;if(B>q){q=B}e.tipo=t[A].trim();A++;if(t[A].trim().match(/^[0-9]+$/)){u=parseInt(t[A].trim(),10)}else{return assemblyError("Error, numeric format incorrect: ",t,A)}e.contenido="";e.longitud=u;while(s%Math.pow(2,q)!=0){b[x]="00000000";x++;s++}for(o=0;o<u;o++){b[x]="00000000";x++}e.posicion="0x"+s.toString(16);s=s+u;x=s;q=0;break;default:return assemblyError("Error, type of variable incorrect: ",t,A);break}w.push(e)}}}}g["0x"+E.toString(16)]="";for(o=parseInt(D.begin);o<x;o++){if(o%4==0){if(o!=parseInt(D.begin)){E=E+4;word="";g["0x"+E.toString(16)]=""}g["0x"+E.toString(16)]=b[o]+g["0x"+E.toString(16)]}else{g["0x"+E.toString(16)]=b[o]+g["0x"+E.toString(16)]}}while(g["0x"+E.toString(16)].length<32){g["0x"+E.toString(16)]="00000000"+g["0x"+E.toString(16)]}E=E+4;D.end=parseInt(E.toString(16),16);f.segmentData=w;f.compileSegmentData=g;return f}function textSegment(W,d,A){var ad=parseInt(A.begin);var o=new Array();var av=new Array();var w=new Array();var v=new Object();var ax=0;var B=0;var g=new Object();var aj=new Object;var q=new Array();var ap=0;var O=0;var Y=new Object();var b=new Array();for(ap=0;ap<W.length;ap++){W[ap]=W[ap].toLowerCase();W[ap]=W[ap].replace(/:/g," : ");W[ap]=W[ap].replace(/,/g," , ");W[ap]=W[ap].replace(/\(/g," ( ");W[ap]=W[ap].replace(/\)/g," )");W[ap]=W[ap].replace(/\t/g,"");W[ap]=W[ap].replace(/#/g,"# ");W[ap]=W[ap].replace(/  /g," ");W[ap]=W[ap].replace(/\s{2,}/g," ");W[ap]=W[ap].trim();var ah=W[ap].toString().split(" ");var ao=0;if(ah[ao]=="#"){q.push(ap)}}ao=q.length-1;for(ao=q.length-1;ao>=0;ao--){W.splice(parseInt(q[ao]),1)}var X=new Array();var s=new Array();var p=new Array();for(ap=0;ap<W.length;ap++){ao=0;var U=0;var D=W[ap].trim().toString().split(" ");var n=0;if(D[1+ao]==":"){ao+=2;var e="";e=D[0]+" : ";U=1}var E="";if(typeof D[ao]=="undefined"){return assemblyError("Error in syntax of label, is have not instruction associated: ",D,ao)}E=D[ao].trim();ao++;for(var aa=0;aa<d.pseudoInstructions.length;aa++){if(d.pseudoInstructions[aa]["initial"].name==E){var J="";var af=new Array();J=d.pseudoInstructions[aa]["finish"].signature;for(var am=0;am<d.pseudoInstructions[aa]["initial"].fields.length;am++){var aq="";aq=d.pseudoInstructions[aa]["initial"].fields[am].name;var ac=new RegExp(aq,"g");J=J.replace(ac,D[ao]);ao++}n=1;var af=J.split("\n");break}}if(n==0){X.push(W[ap]);s.push(W[ap]);p.push(W[ap]);continue}for(var am=0;am<af.length;am++){var N;if(N=af[am].search("sel ")!=-1){var H=af[am].trim().split(" ");var al="";var P=new Object();P.pos=X.length;P.label="";P.bi=0;P.bf=0;var ak=0;while(H[ak]!="sel"){al=al+" "+H[ak];ak++}if(am==0&&U==1){P.fieldPos=ak+2}else{P.fieldPos=ak}al=al.trim();ak=ak+2;P.bi=H[ak];ak=ak+2;P.bf=H[ak];ak=ak+2;P.label=H[ak];al=al+" "+H[ak];b.push(P);if(am==0&&U==1){af[am]=e+al}else{af[am]=al}}X.push(af[am]);if(am==0){s.push(W[ap])}else{s.push("&nbsp;")}p.push(af[am])}}W=X;for(ap=0;ap<W.length;ap++){var C=new Array();ao=0;var D=W[ap].trim().toString().split(" ");var h="";if(D.length>1){if(D[1+ao]==":"){aj[D[ao].trim()]=ad.toString(16);ao+=2}}h+=D[ao].trim();ao++;while(ao<D.length){if(D[ao].trim().substring(0,1)=="$"){if(D[ao-1].trim()=="("){h+="reg"}else{h+=",reg"}ao++}else{if(D[ao].trim().substring(0,2)=="0x"){if(D[ao].trim().substr(2,D[ao].trim().length-2).match(/^[0-9a-fA-F]+$/)){h+=",num";ao++}else{return assemblyError("Error in Hex format: ",D,ao)}}else{if(D[ao].trim().substring(0,1)=="0"&&D[ao].trim().match(/^[0-9]+$/)){h+=",num";ao++}else{if((D[ao].trim().substring(0,1)=="-"&&D[ao].trim().substr(1,D[ao].trim().length-1).match(/^[0-9]+$/))||(D[ao].trim().match(/^[0-9]+$/))){h+=",num";ao++}else{if(D[ao].trim()=="("){h+="(";ao++}else{if(D[ao].trim()==")"){h+=")";ao++}else{if(D[ao].trim()==","){ao++}else{h+=",num";ao++}}}}}}}}var L=0;for(ao=1;ao<d.firmware.length;ao++){if(d.firmware[ao].signatureGlobal==h.trim()){ad=ad+4*parseInt(d.firmware[ao].nwords);L=1;break}}if(L==0){return assemblyError("Signature not found, assembly instruction incorrect: ",D,0)}}var ab;for(ab in aj){for(ap=0;ap<W.length;ap++){W[ap]=W[ap]+" ";W[ap]=W[ap].replace(" "+ab+" "," 0x"+aj[ab]+" ");W[ap]=W[ap].trim()}}for(ap=0;ap<b.length;ap++){var I=b[ap].pos;var M=b[ap].fieldPos;var G=b[ap].label;var aq=W[I].split(" ");var a=aq[M].toString();aq=parseInt(aq[M]).toString(2);var T="00000000000000000000000000000000";var R=T+aq;R=R.substr(R.length-32,32);R=R.substr(31-b[ap].bi,(b[ap].bi-b[ap].bf)+1);W[I]=W[I].replace(a,parseInt(R,2).toString());p[I]=W[I]}ad=parseInt(A.begin);var V=new Object();var O=0;for(ap=0;ap<W.length;ap++){var at=new Array();ao=0;var ah=W[ap].trim().toString().split(" ");var ag="";if(ah.length>1){if(ah[1+ao].trim()==":"){ao+=2}}ag+=ah[ao].trim();at.push(ah[ao].trim());ao++;while(ao<ah.length){if(ah[ao].trim().substring(0,1)=="$"){if(ah[ao-1].trim()=="("){ag+="reg"}else{ag+=",reg"}at.push(ah[ao].trim());ao++}else{if(ah[ao].trim().substring(0,2)=="0x"){if(ah[ao].trim().substr(2,ah[ao].trim().length-2).match(/^[0-9a-fA-F]+$/)){ag+=",num";at.push(ah[ao].trim());ao++}else{}}else{if(ah[ao].trim().substring(0,1)=="0"&&ah[ao].trim().match(/^[0-9]+$/)){ag+=",num";at.push(ah[ao].trim());ao++}else{if((ah[ao].trim().substring(0,1)=="-"&&ah[ao].trim().substr(1,ah[ao].trim().length-1).match(/^[0-9]+$/))||(ah[ao].trim().match(/^[0-9]+$/))){ag+=",num";at.push(ah[ao].trim());ao++}else{if(ah[ao].trim()=="("){ag+="(";ao++}else{if(ah[ao].trim()==")"){ag+=")";ao++}else{if(ah[ao].trim()==","){ao++}else{return assemblyError("Error, field not correct: ",ah,ao)}}}}}}}}for(ao=1;ao<d.firmware.length;ao++){var Q="";if(d.firmware[ao].signatureGlobal==ag){var ae=parseInt(d.firmware[ao].nwords);Q="00000000000000000000000000000000";for(aa=1;aa<ae;aa++){Q=Q+"00000000000000000000000000000000"}var f=d.firmware[ao].co;Q=f+Q.substr(6,Q.length-6);for(aa=0;aa<d.firmware[ao].fields.length;aa++){switch(f=d.firmware[ao].fields[aa].type){case"reg":var u="";u=at[aa+1].substr(1,at[aa+1].length-1);u=parseInt(u);if(u>=0&&u<=32){f=(parseInt(at[aa+1].substr(1,at[aa+1].length-1))).toString(2)}else{var y=0;for(var am in d.registers){if(d.registers[am]==at[aa+1]){f=parseInt(am).toString(2);y=1}}if(y==0){return assemblyError("Error, name of register incorrect: ",at,aa+1)}}break;case"address":if(at[aa+1].trim().substring(0,2)=="0x"){if(at[aa+1].trim().substr(2,at[aa+1].trim().length-2).match(/^[0-9a-fA-F]+$/)){f=parseInt(at[aa+1]).toString(2)}else{return assemblyError("Error in Hex format: ",at,aa+1)}}else{if(at[aa+1].trim().substring(0,1)=="0"&&at[aa+1].trim().match(/^[0-9]+$/)){f=parseInt(at[aa+1],8).toString(2)}else{if((at[aa+1].trim().substring(0,1)=="-"&&at[aa+1].trim().substr(1,at[aa+1].trim().length).match(/^[0-9]+$/))||(at[aa+1].trim().match(/^[0-9]+$/))){f=parseInt(at[aa+1]>>>0).toString(2)}else{return assemblyError("Error in numeric format: ",at,aa+1)}}}if(d.firmware[ao].fields[aa].address_type=="abs"){}else{if(d.firmware[ao].fields[aa].address_type=="rel"){var Z=parseInt(f,2);Z=Z-ad-4;f=(Z>>>0).toString(2)}else{}}break;case"inm":if(at[aa+1].trim().substring(0,2)=="0x"){if(at[aa+1].trim().substr(2,at[aa+1].trim().length-2).match(/^[0-9a-fA-F]+$/)){f=parseInt(at[aa+1]).toString(2)}else{return assemblyError("Error in Hex format: ",at,aa+1)}}else{if(at[aa+1].trim().substring(0,1)=="0"&&at[aa+1].trim().match(/^[0-9]+$/)){f=parseInt(at[aa+1],8).toString(2)}else{if((at[aa+1].trim().substring(0,1)=="-"&&at[aa+1].trim().substr(1,at[aa+1].trim().length).match(/^[0-9]+$/))||(at[aa+1].trim().match(/^[0-9]+$/))){f=parseInt(at[aa+1]>>>0).toString(2)}else{return assemblyError("Error in numeric format: ",at,aa+1)}}}f=parseInt(at[aa+1]>>>0).toString(2);break}var ar=((ae*32)-1)-parseInt(d.firmware[ao].fields[aa].startbit);var au=((ae*32)-1)-parseInt(d.firmware[ao].fields[aa].stopbit);var an="00000000000000000000000000000000";f=an+f;f=f.substr((f.length-1)-(au-ar),(au-ar)+1);Q=Q.substr(0,ar)+f+Q.substr(au+1,parseInt(d.firmware[ao].fields[aa].stopbit))}var K="0x"+ad.toString(16);for(var am=0;am<ae;am++){if((am==0)&&(typeof d.firmware[ao].cop!="undefined")){var F=Q.substr(0,32-4);Q=Q.substr(32,Q.length-32);F=F+d.firmware[ao].cop;Q=F+Q}V["0x"+ad.toString(16)]=Q.substr(32*am,32);ad=ad+4}var t="";for(var ai=0;ai<at.length;ai++){t=t+" "+at[ai]}var S=new Object();S.source_original=s[ap];S.source=p[ap];S.breakpoint=false;S.binary=V[K];Y[K]=S;break}}}A.end=parseInt(ad.toString(16),16);var aw=new Object();aw.binaryCode=V;aw.assemblyCode=Y;aw.etiquetas=aj;aw.error=null;return aw}function simlang_compile(o,u){var s=new Array();var p=o.split("\n");var h=new Array();var y=new Array();var w=0;var v=0;var f=0;var A=new Object();A.seg={system:{name:"system",begin:0,end:512,color:"#A9D0F5"},data:{name:"data",begin:4096,end:65535,color:"#FACC2E"},code:{name:"code",begin:32768,end:65535,color:"#BEF781"},stack:{name:"stack",begin:65535,end:65535,color:"#F1F2A3"}};for(w=0;w<p.length;w++){var b=p[w];b=b.replace(/:/g," : ");b=b.replace(/,/g," , ");b=b.replace(/\(/g," ( ");b=b.replace(/\)/g," )");b=b.replace(/#/g,"# ");b=b.replace(/\t/g,"");b=b.replace(/  /g," ");b=b.replace(/\s{2,}/g," ");b=b.trim();var k=b.split(" ");if(k[0].trim()==".data"){f=1}if(k[0].trim()==".text"){f=2}switch(f){case 1:if(k[0].length>0){if(k[0][0].trim()=="#"||k[0].trim()==".data"){}else{h.push(p[w].trim())}}break;case 2:if(k[0].length>0){if(k[0][0].trim()=="#"||k[0].trim()==".text"||(k[0].trim()==".globl")){}else{y.push(p[w].trim())}}break;default:break}}if(f==1){A.mp=null;A.labels2=null;A.error="Error, '.text' not defined.";return A}var z=dataSegment(h,A.seg.data);if(z.error!=null){A.mp=null;A.labels2=null;A.error=z.error;return A}var a=z.segmentData;var e=z.compileSegmentData;var q=new Object;for(w=0;w<a.length;w++){q[a[w].name]=a[w].posicion}var m;for(m in q){for(w=0;w<y.length;w++){y[w]=y[w]+" ";y[w]=y[w].replace(" "+m+" "," "+q[m].toString(16)+" ");y[w]=y[w].trim()}}var g=textSegment(y,u,A.seg.code);if(g.error!=null){A.mp=null;A.labels2=null;A.error=g.error;return A}var t=g.binaryCode;for(m in g.etiquetas){q[m]="0x"+g.etiquetas[m]}var d={};for(var n in t){d[n]=t[n]}for(var n in e){d[n]=e[n]}A.mp=d;A.labels2=q;A.error=null;A.assembly=g.assemblyCode;return A}function assemblyError(e,f,b){var a=new Object();a.binaryCode=null;a.etiquetas=null;a.error=null;a.error=e+":\n";for(var d=b-8;d<(b+8);d++){if(typeof f[d]!="undefined"){a.error=a.error+" "+f[d]}}a.error="..."+a.error+"...";return a}function dataError(e,f,b){var a=new Object();a.binaryCode=null;a.etiquetas=null;a.error=null;a.assemblyCode=null;a.error=e+":\n";for(var d=b-8;d<(b+8);d++){if(typeof f[d]!="undefined"){a.error=a.error+" "+f[d]}}a.error="..."+a.error+"...";return a};