var WSCFG=new Object();WSCFG.version={value:"1.7.2",type:"string"};function get_cfg(a){return WSCFG[a].value}function set_cfg(b,a){WSCFG[b].value=a}function reset_cfg(){WSCFG.color_data_active={value:"#0066FF",type:"string"};WSCFG.color_data_inactive={value:"rgb(0, 0, 0)",type:"string"};WSCFG.color_name_active={value:"red",type:"string"};WSCFG.color_name_inactive={value:"rgb(0, 0, 0)",type:"string"};WSCFG.size_active={value:1.22,type:"float"};WSCFG.size_inactive={value:0.02,type:"float"};WSCFG.DBG_delay={value:10,type:"int"};WSCFG.DBG_level={value:"instruction",type:"string"};WSCFG.RF_display_format={value:16,type:"int"};WSCFG.RF_display_name={value:"numerical",type:"string"};WSCFG.NOTIF_delay={value:500,type:"int"};WSCFG.ICON_theme={value:"classic",type:"string"};WSCFG.CPUCU_size={value:55,type:"int"};WSCFG.is_interactive={value:true,type:"boolean"};WSCFG.is_byvalue={value:false,type:"boolean"};WSCFG.is_editable={value:false,type:"boolean"};WSCFG.ws_idiom={value:"es",type:"string"};WSCFG.editor_theme={value:"default",type:"string"};WSCFG.editor_mode={value:"default",type:"string"}}function save_cfg(){try{for(var b in WSCFG){localStorage.setItem("wepsim_"+b,get_cfg(b))}}catch(a){console.log("WepSIM can not save the configuration in a persistent way on this web browser, found error: \n"+a.message)}}function restore_cfg(){reset_cfg();for(var b in WSCFG){if(b=="version"){continue}try{set_cfg(b,localStorage.getItem("wepsim_"+b));if(WSCFG[b].type!="string"){set_cfg(b,JSON.parse(get_cfg(b)))}if(get_cfg(b)==null){throw"null values discarted"}}catch(a){console.log("WepSIM can not restore the configuration on this web browser, found error: \n"+a.message);reset_cfg();return}}}function get_simware(){if(typeof FIRMWARE.firmware=="undefined"){FIRMWARE.firmware=new Array();FIRMWARE.mp=new Object();FIRMWARE.seg=new Object();FIRMWARE.assembly=new Object();FIRMWARE.labels=new Object();FIRMWARE.labels2=new Object();FIRMWARE.labels_firm=new Object();FIRMWARE.registers=new Object();FIRMWARE.cihash=new Object();FIRMWARE.pseudoInstructions=new Object();FIRMWARE.stackRegister=new Object()}return FIRMWARE}function set_simware(a){if(typeof a.firmware!="undefined"){FIRMWARE.firmware=a.firmware}if(typeof a.mp!="undefined"){FIRMWARE.mp=a.mp}if(typeof a.registers!="undefined"){FIRMWARE.registers=a.registers}if(typeof a.cihash!="undefined"){FIRMWARE.cihash=a.cihash}if(typeof a.assembly!="undefined"){FIRMWARE.assembly=a.assembly}if(typeof a.pseudoInstructions!="undefined"){FIRMWARE.pseudoInstructions=a.pseudoInstructions}if(typeof a.seg!="undefined"){FIRMWARE.seg=a.seg}if(typeof a.labels!="undefined"){FIRMWARE.labels=a.labels}if(typeof a.labels2!="undefined"){FIRMWARE.labels2=a.labels2}if(typeof a.labels_firm!="undefined"){FIRMWARE.labels_firm=a.labels_firm}if(typeof a.stackRegister!="undefined"){FIRMWARE.stackRegister=a.stackRegister}}function obj_draw(a,g,k,e,f,d){var b=a.split(":");var h=document.getElementById(b[0]);if(h==null){return}h=h.contentDocument;if(h==null){return}h=h.getElementById(b[1]);if(h==null){return}if(g){h.style.setProperty("stroke",k,"");h.style.setProperty("fill",k,"");h.style.setProperty("stroke-width",f,"")}else{if(h.style.getPropertyValue("stroke")==e){return}h.style.setProperty("stroke",e,"");h.style.setProperty("fill",e,"");h.style.setProperty("stroke-width",d,"")}}var DRAW_stop=false;function start_drawing(){DRAW_stop=false}function stop_drawing(){DRAW_stop=true}function is_drawing(){return DRAW_stop}function update_draw(g,f){if(true==DRAW_stop){return}var h=get_cfg("is_byvalue");if(typeof sim_states.REG_MICROINS.value[g.name]!="undefined"){h=true}if((false==h)&&(typeof g.depends_on!="undefined")){for(var b=0;b<g.depends_on.length;b++){var a=g.depends_on[b];if(typeof sim_states.REG_MICROINS.value[a]!="undefined"){h=true;break}else{if("CLK"==a){h=true;break}}}}if(g.draw_data.length>1){for(var e=0;e<g.draw_data.length;e++){for(var d=0;d<g.draw_data[e].length;d++){obj_draw(g.draw_data[e][d],(e==f)&&h,get_cfg("color_data_active"),get_cfg("color_data_inactive"),get_cfg("size_active"),get_cfg("size_inactive"))}}}else{if(g.nbits==1){for(var d=0;d<g.draw_data[0].length;d++){obj_draw(g.draw_data[0][d],(0!=f)&&h,get_cfg("color_data_active"),get_cfg("color_data_inactive"),get_cfg("size_active"),get_cfg("size_inactive"))}}else{if(g.draw_data.length==1){for(var d=0;d<g.draw_data[0].length;d++){obj_draw(g.draw_data[0][d],h,get_cfg("color_data_active"),get_cfg("color_data_inactive"),get_cfg("size_active"),get_cfg("size_inactive"))}}}}if(g.draw_name.length>1){for(var e=0;e<g.draw_name.length;e++){for(var d=0;d<g.draw_name[e].length;d++){obj_draw(g.draw_name[e][d],(e==f)&&h,get_cfg("color_name_active"),get_cfg("color_name_inactive"),get_cfg("size_active"),get_cfg("size_inactive"))}}}else{if(g.nbits==1){for(var d=0;d<g.draw_name[0].length;d++){obj_draw(g.draw_name[0][d],(0!=f)&&h,get_cfg("color_name_active"),get_cfg("color_name_inactive"),get_cfg("size_active"),get_cfg("size_inactive"))}}else{if(g.draw_name.length==1){for(var d=0;d<g.draw_name[0].length;d++){obj_draw(g.draw_name[0][d],h,get_cfg("color_name_active"),get_cfg("color_name_inactive"),get_cfg("size_active"),get_cfg("size_inactive"))}}}}}function refresh(){for(var a in sim_signals){update_draw(sim_signals[a],sim_signals[a].value)}show_dbg_ir(get_value(sim_states.REG_IR_DECO))}function hex2float(d){var a=(d&2147483648)?-1:1;var f=((d>>23)&255)-127;var b=1+((d&8388607)/8388608);var e=a*b*Math.pow(2,f);if(-127==f){if(1==b){e=(a==1)?"+0":"-0"}else{e=a*((d&8388607)/8388607)*Math.pow(2,126)}}if(128==f){if(1==b){e=(a==1)?"+Inf":"-Inf"}else{e="NaN"}}return e}function hex2char8(a){var b=new Array();b[0]=String.fromCharCode((a&4278190080)>>24);b[1]=String.fromCharCode((a&16711680)>>16);b[2]=String.fromCharCode((a&65280)>>8);b[3]=String.fromCharCode((a&255)>>0);return b}function hex2bin(a){var b=a.toString(2);b="00000000000000000000000000000000".substring(0,32-b.length)+b;b=b.substring(0,4)+" "+b.substring(4,8)+" "+b.substring(8,12)+" "+b.substring(12,16)+" "+b.substring(16,20)+" "+b.substring(20,24)+" "+b.substring(24,28)+" "+b.substring(28,32);return b}function hex2values_update(a){var b=parseInt($("#popover1")[0].value);if(typeof sim_states.BR[a]!="undefined"){set_value(sim_states.BR[a],b);fullshow_rf_values();$("#rf"+a).click();$("#rf"+a).click()}if(typeof sim_states[a]!="undefined"){if(1==sim_states[a].nbits){b=b%2}set_value(sim_states[a],b);fullshow_eltos(sim_states,filter_states);$("#rp"+a).click();$("#rp"+a).click()}}function hex2values(o,m){var k=/[0-9A-F]{1,8}/gi;if(!k.test(o)){o=0}var f=o>>0;var n=o>>>0;var a=hex2char8(n);var h=hex2float(n);var d=hex2bin(n);var g=n.toString(16).toUpperCase();g="0x"+"00000000".substring(0,8-g.length)+g;var b="";if(get_cfg("is_editable")==true){b="<tr><td colspan=5 align=center><input type=text id='popover1' value='"+n+"' data-mini='true' style='width:65%'>&nbsp;<span class='badge'       onclick='hex2values_update(\""+m+"\");'>update</span></td></tr>"}var e="<table width='100%' class='table table-bordered table-condensed'><tr><td><small><b>hex.</b></small></td>    <td colspan=4><small>"+g+"</small></td></tr><tr><td><small><b>bin.</b></small></td>    <td colspan=4><small><font face='monospace'><b>"+d+"</b></font></smallspan></td></tr><tr><td><small><b>signed</b></small></td>    <td colspan=4><small>"+f+"</small></td></tr><tr><td><small><b>unsig.</b></small></td>    <td colspan=4><small>"+n+"</small></td></tr><tr><td width=30%><small><b>char</b></small></td>    <td width=15% align=center><small>"+a[0]+"</small></td>    <td width=15% align=center><small>"+a[1]+"</small></td>    <td width=15% align=center><small>"+a[2]+"</small></td>    <td width=15% align=center><small>"+a[3]+"</small></td></tr><tr><td><small><b>float</b></small></td>    <td colspan=4><small><font face='monospace'><b>"+h+"</b></font></small></td></tr>"+b+"</table>";return e}function init_rf(d){if(d==""){return}var a="<div class='hidden' id='popover_rf'>  <div class='popover-heading'></div>  <div class='popover-body'></div></div>";for(var b=0;b<sim_states.BR.length;b++){a+="<div class='col-xs-6 col-sm-4 col-md-4 col-lg-3' style='padding:0 5 0 5;'><button type='button' class='btn btn-outline-primary' style='padding:0 0 0 0; outline:none; box-shadow:none;'         data-toggle='popover-up' data-popover-content='"+b+"' data-container='body'         id='rf"+b+"'>  <span id='name_RF"+b+"' style='float:center; padding:0 0 0 0'>R"+b+"</span>  <span class='badge' style='background-color:#CEECF5; color:black;' id='tbl_RF"+b+"'>"+(get_value(sim_states.BR[b])>>>0).toString(get_cfg("RF_display_format")).toUpperCase()+"  </span></button></div>"}$(d).html("<div class='row-fluid'>"+a+"</div>");$("[data-toggle=popover-up]").popover({html:true,placement:"top",content:function(){var f=$(this).attr("data-popover-content");var e=get_value(sim_states.BR[f]);return hex2values(e,f)},title:function(){var e=$(this).attr("data-popover-content");var f="&quot;#rf"+e+"&quot;";return'<span class="text-info"><strong>R'+e+'</strong></span><button type="button" id="close" class="close"         onclick="$('+f+').click();">&times;</button>'}})}function fullshow_rf_values(){var b=get_simware();for(var d=0;d<sim_states.BR.length;d++){var a=(get_value(sim_states.BR[d])>>>0).toString(get_cfg("RF_display_format")).toUpperCase();if(16==get_cfg("RF_display_format")){a="00000000".substring(0,8-a.length)+a}$("#tbl_RF"+d).html(a)}}var show_rf_values_deffered=null;function show_rf_values(){if(null==show_rf_values_deffered){show_rf_values_deffered=setTimeout(function(){fullshow_rf_values();show_rf_values_deffered=null},120)}}function show_rf_names(){var b=get_simware();for(var d=0;d<sim_states.BR.length;d++){var a="R"+d;if("logical"==get_cfg("RF_display_name")){if(typeof b.registers[d]!="undefined"){a=b.registers[d]}}var e=document.getElementById("name_RF"+d);if(e!=null){e.innerHTML=a}}}function init_eltos(f,n,a,h){if(f==""){return}var d="";for(var g=0;g<a.length;g++){var o=a[g].split(",")[0];var e=n[o].name;if(n[o].nbits>1){e=e.substring(0,2)+'<span class="hidden-xs">'+e.substring(2,e.length)+"</span>"}var m=a[g].split(",")[1];var k=h[m];d+="<div class='"+k+"' style='padding: 0 5 0 5;'><button type='button' class='btn btn-outline-primary' style='padding:0 0 0 0; outline:none; box-shadow:none;'         data-toggle='popover-bottom' data-popover-content='"+o+"' data-container='body'         id='rp"+o+"'>"+e+"<span class='badge' style='background-color:#CEECF5; color:black;' id='tbl_"+o+"'>"+n[o].value.toString(get_cfg("RF_display_format"))+"</span></button></div>"}$(f).html("<div class='row-fluid'>"+d+"</div>");$("[data-toggle=popover-bottom]").popover({html:true,placement:"bottom",content:function(){var p=$(this).attr("data-popover-content");var b=get_value(sim_states[p]);return hex2values(b,p)},title:function(){var b=$(this).attr("data-popover-content");var p="&quot;#rp"+b+"&quot;";return'<span class="text-info"><strong>'+sim_states[b].name+'</strong></span><button type="button" id="close" class="close"         onclick="$('+p+').click();">&times;</button>'}})}function fullshow_eltos(h,d){for(var b=0;b<d.length;b++){var e=d[b].split(",");var a=e[0];var f=h[a].value.toString(get_cfg("RF_display_format"));if(h[a].nbits>1){f=(sim_states[a].value>>>0).toString(get_cfg("RF_display_format")).toUpperCase();if(16==get_cfg("RF_display_format")){f="00000000".substring(0,8-f.length)+f}}var g=document.getElementById("tbl_"+a);if(g!=null){g.innerHTML=f}}}var show_eltos_deffered=null;function show_eltos(b,a){if(null==show_eltos_deffered){show_eltos_deffered=setTimeout(function(){fullshow_eltos(b,a);show_eltos_deffered=null},130)}}var filter_states=["REG_IR_DECO,0","REG_IR,1","REG_PC,1","REG_SR,1","REG_RT1,1","REG_RT2,1","REG_RT3,1","REG_MAR,1","REG_MBR,1","REG_MICROADDR,1"];var divclasses=["col-xs-12 col-sm-12 col-md-12 col-lg-12","col-xs-4 col-sm-4 col-md-4 col-lg-4"];function init_states(a){return init_eltos(a,sim_states,filter_states,divclasses)}function show_states(){return show_eltos(sim_states,filter_states)}function init_io(e){if(e==""){sim_states.CLK.value=ko.observable(sim_states.CLK.value);sim_states.DECO_INS.value=ko.observable(sim_states.DECO_INS.value);for(var b=0;b<IO_INT_FACTORY.length;b++){IO_INT_FACTORY[b].accumulated=ko.observable(IO_INT_FACTORY[b].accumulated);IO_INT_FACTORY[b].active=ko.observable(IO_INT_FACTORY[b].active)}return}var d="<center><table class='table table-hover table-condensed table-bordered table-responsive'><tr><td align=center width=50%>Instructions</td><td align=center width=50%><div id='ins_context'><span data-bind='text: value'>&nbsp;</span></div></td></tr><tr><td align=center width=50%>CLK ticks</td><td align=center width=50%><div id='clk_context'><span data-bind='text: value'>&nbsp;</span></div></td></tr>";d+="<tr><td colspan=2>&nbsp;</td></tr>";for(var b=0;b<IO_INT_FACTORY.length;b++){d+="<tr id='int"+b+"_context'><td align=center width=50%><span data-bind=\"style: {fontWeight: active() ? 'bold' : ''}\">Interrupt "+b+"</span></td><td align=center width=50%><span data-bind='text: accumulated'>&nbsp;</span></td></tr>"}d+="</table></center>";$(e).html("<div class='row-fluid'>"+d+"</div>");sim_states.CLK.value=ko.observable(sim_states.CLK.value);var a=document.getElementById("clk_context");ko.applyBindings(sim_states.CLK,a);sim_states.DECO_INS.value=ko.observable(sim_states.DECO_INS.value);var a=document.getElementById("ins_context");ko.applyBindings(sim_states.DECO_INS,a);for(var b=0;b<IO_INT_FACTORY.length;b++){IO_INT_FACTORY[b].accumulated=ko.observable(IO_INT_FACTORY[b].accumulated);IO_INT_FACTORY[b].active=ko.observable(IO_INT_FACTORY[b].active);var a=document.getElementById("int"+b+"_context");ko.applyBindings(IO_INT_FACTORY[b],a)}}function init_config(e){if(e==""){for(var b=0;b<IO_INT_FACTORY.length;b++){IO_INT_FACTORY[b].period=ko.observable(IO_INT_FACTORY[b].period);IO_INT_FACTORY[b].probability=ko.observable(IO_INT_FACTORY[b].probability)}MP_wc=ko.observable(MP_wc);return}var d="<div class='container-fluid' style='padding:0 0 0 0; overflow-x:auto'><div class='row-fluid'><div class='col-xs-8 col-md-8' style='padding:0 0 0 0;'><div class='panel panel-default' style='margin:0 0 0 0;'><div class='panel-heading'> <h3 class='panel-title'>I/O</h3></div><div class='panel-body' id='iopanel' style='padding: 0 0 0 0'>";d+="<center><table class='table table-hover table-condensed table-bordered table-responsive'        style='margin:0'><tbody class='ui-mini'><tr><td align=center width=33%>  <span class='hidden-xs'>Interruption<br>identificator</span>  <span class='visible-xs'>Int.<br>Id.</span></td><td align=center width=33%>CLK period<br>(<b>0</b> - &infin;)</td><td align=center width=33%>Probability<br>(0 - 1)</td></tr>";for(var b=0;b<8;b++){d+="<tr><td align=center style='padding:0 0 0 0; vertical-align: middle !important'><span style='padding:0 0 0 0; margin:0 0 0 0'>"+b+"</span></td><td align=center style='padding:0 0 0 0'><div id='int"+b+"_per' style='margin:0 3 0 3'><input type=number data-bind='value: period' min='0'        style='margin:0 0 0 3; padding:0 0 0 5'></div></td><td align=center style='padding:0 0 0 0'><div id='int"+b+"_pro' style='margin:0 3 0 3'><input type=number data-bind='value: probability' min='0' max='1' step='.05'        style='margin:0 0 0 3; padding:0 0 0 5'></div></td></tr>"}d+="</tbody></table></center>";d+="</div></div></div>";d+="<div class='col-xs-4 col-md-4' style='padding:0 0 0 10;'><div class='panel panel-default'><div class='panel-heading'> <h3 class='panel-title'>Memory</h3></div><div class='panel-body' id='mempanel' style='padding:0 0 0 0;'>  <div class='row-fluid'>  <center>  <div class='col-xs-12 col-sm-12 col-md-12 col-lg-12' style='padding: 0 0 0 0;'>Wait cycles <br>(<b>0</b> - &infin;)</div>  <div class='col-xs-12 col-sm-12 col-md-12 col-lg-12' id='mp_wc'><input type=number data-bind='value: MP_wc' min=0></div>  </center>  </div></div></div></div></div></div>";$(e).html(d);for(var b=0;b<IO_INT_FACTORY.length;b++){IO_INT_FACTORY[b].period=ko.observable(IO_INT_FACTORY[b].period);var a=document.getElementById("int"+b+"_per");ko.applyBindings(IO_INT_FACTORY[b],a);IO_INT_FACTORY[b].probability=ko.observable(IO_INT_FACTORY[b].probability);var a=document.getElementById("int"+b+"_pro");ko.applyBindings(IO_INT_FACTORY[b],a)}MP_wc=ko.observable(MP_wc);var a=document.getElementById("mp_wc");ko.applyBindings(MP_wc,a)}function show_main_memory(k,d,h){if(h==false){return refresh_main_memory(k,d)}var g="";var f="";for(var e in k){f=k[e].toString(16);f="00000000".substring(0,8-f.length)+f;value2=f[0]+f[1]+" "+f[2]+f[3]+" "+f[4]+f[5]+" "+f[6]+f[7];key2=parseInt(e).toString(16);key3=(parseInt(e)+3).toString(16);for(skey in segments){if(parseInt(segments[skey].begin)==parseInt(e)){g+="</tbody><tbody id=begin_"+skey+">"}}if(e==d){g+="<tr id='addr"+e+"'    style='color:blue; font-size:normal; font-weight:bold'><td width=50%>0x"+key3+"-"+key2+"</td><td          >"+value2+"</td></tr>"}else{g+="<tr id='addr"+e+"'    style='color:black; font-size:small; font-weight:normal'><td width=50%>0x"+key3+"-"+key2+"</td><td          >"+value2+"</td></tr>"}}if(typeof k[d]=="undefined"){g+="<tr><td width=15%><font color=blue>0x"+parseInt(d).toString(16)+"</font></td><td><font color=blue><b>00 00 00 00</b></font></td></tr>"}$("#memory_MP").html("<center><table class='table table-hover table-condensed table-responsive'><tbody id=none>"+g+"</tbody></table></center>");var a=$("#addr"+d);if((h)&&(a.length>0)){var b=a[0].offsetTop;var a=$("#memory_MP");if(a.length>0){a[0].scrollTop=b}}}var old_main_addr=0;function refresh_main_memory(b,a){o1=$("#addr"+old_main_addr);o1.css("color","black");o1.css("font-size","small");o1.css("font-weight","normal");old_main_addr=a;o1=$("#addr"+old_main_addr);o1.css("color","blue");o1.css("font-size","initial");o1.css("font-weight","bold")}function show_control_memory(f,e,k,p){if(false==p){return refresh_control_memory(f,e,k)}var d="";var n="";var a=get_cfg("ICON_theme");for(var o in f){n="";for(var m in f[o]){if(1==f[o][m]){n+=m+" ";continue}n+=m+"="+parseInt(f[o][m]).toString(2)+" "}var b="&nbsp;";if(true==e[o].breakpoint){b="<img alt='stop icon' height=22 src='images/stop_"+a+".gif'>"}if(o==k){d+="<tr id='maddr"+o+"'     style='color:blue; font-size:normal; font-weight:bold'     onclick='dbg_set_breakpoint("+o+");              if (event.stopPropagation) event.stopPropagation();'><td width=12% align=right>0x"+parseInt(o).toString(16)+"</td><td width=1% id='mcpin"+o+"' style='padding:5 0 0 0;'>"+b+"</td><td>"+n+"</td></tr>"}else{d+="<tr id='maddr"+o+"'     style='color:black; font-size:small; font-weight:normal'     onclick='dbg_set_breakpoint("+o+");              if (event.stopPropagation) event.stopPropagation();'><td width=12% align=right>0x"+parseInt(o).toString(16)+"</td><td width=1% id='mcpin"+o+"' style='padding:5 0 0 0;'>"+b+"</td><td>"+n+"</td></tr>"}}if(typeof f[k]=="undefined"){d+="<tr><td width=15%><font color=blue>0x"+parseInt(k).toString(16)+"</font></td><td><font color=blue><b>&nbsp;</b></font></td></tr>"}$("#memory_MC").html("<center><table class='table table-hover table-condensed table-responsive'><tbody id=none>"+d+"</tbody></table></center>");var h=$("#maddr"+k);if((p)&&(h.length>0)){var g=h[0].offsetTop;var h=$("#memory_MC");if(h.length>0){h[0].scrollTop=g}}}var old_mc_addr=0;function refresh_control_memory(d,a,b){o1=$("#maddr"+old_mc_addr);o1.css("color","black");o1.css("font-size","small");o1.css("font-weight","normal");old_mc_addr=b;o1=$("#maddr"+old_mc_addr);o1.css("color","blue");o1.css("font-size","initial");o1.css("font-weight","bold")}function get_deco_from_pc(a){var b="0x"+a.toString(16);if((typeof FIRMWARE.assembly=="undefined")||(typeof FIRMWARE.assembly[b]=="undefined")||(typeof FIRMWARE.assembly[b].source=="undefined")){return""}return FIRMWARE.assembly[b].source}var old_addr=0;function show_asmdbg_pc(){var b=null;var a=get_value(sim_states.REG_PC);var d="0x"+a.toString(16);if(typeof FIRMWARE.assembly[old_addr]!="undefined"){b=$("#asmdbg"+old_addr);b.css("background-color",FIRMWARE.assembly[old_addr].bgcolor)}else{for(l in FIRMWARE.assembly){b=$("#asmdbg"+l);b.css("background-color",FIRMWARE.assembly[l].bgcolor)}}old_addr=d;b=$("#asmdbg"+d);b.css("background-color","#00EE88");return b}function asmdbg_set_breakpoint(f){var b=get_cfg("ICON_theme");var a="0x"+f.toString(16);var e=document.getElementById("bp"+a);var d=FIRMWARE.assembly[a].breakpoint;if(d===true){d=false;e.innerHTML="&nbsp;"}else{d=true;e.innerHTML="<img alt='stop icon' height=22 src='images/stop_"+b+".gif'>"}FIRMWARE.assembly[a].breakpoint=d}function dbg_set_breakpoint(e){var a=get_cfg("ICON_theme");var d=document.getElementById("mcpin"+e);var b=MC_dashboard[e].breakpoint;if(b===true){b=false;d.innerHTML="&nbsp;"}else{b=true;d.innerHTML="<img alt='stop icon' height='22' src='images/stop_"+a+".gif'>"}MC_dashboard[e].breakpoint=b;if(b&&("instruction"==get_cfg("DBG_level"))){$.notify({title:"<strong>INFO</strong>",message:"Please remember to change configuration to execute at microinstruction level."},{type:"success",newest_on_top:true,delay:get_cfg("NOTIF_delay"),placement:{from:"top",align:"center"}})}}function show_dbg_mpc(){show_control_memory(MC,MC_dashboard,get_value(sim_states.REG_MICROADDR),false)}function show_dbg_ir(a){var b=document.getElementById("svg_p");if(b!=null){b=b.contentDocument}if(b!=null){b=b.getElementById("tspan3899")}if(b!=null){b.innerHTML=a}var b=document.getElementById("svg_cu");if(b!=null){b=b.contentDocument}if(b!=null){b=b.getElementById("text3611")}if(b!=null){b.innerHTML=a}}var screen_content="";function get_screen_content(){var a=document.getElementById("kdb_con");if(a!=null){screen_content=a.value}return screen_content}function set_screen_content(a){var b=document.getElementById("kdb_con");if(b!=null){b.value=a}screen_content=a}function firmware2html(y,A){var n=["A0,0","B,0","C,0","SELA,5","SELB,5","SELC,2","SELCOP,0","MR,0","MC,0","C0,0","C1,0","C2,0","C3,0","C4,0","C5,0","C6,0","C7,0","T1,0","T2,0","T3,0","T4,0","T5,0","T6,0","T7,0","T8,0","T9,0","T10,0","T11,0","M1,0","M2,0","M7,0","MA,0","MB,0","SELP,0","LC,0","SE,0","SIZE,0","OFFSET,0","BW,0","R,0","W,0","TA,0","TD,0","IOR,0","IOW,0","TEST_I,0","TEST_U,0"];var C="<tr bgcolor=#FF9900><td bgcolor=white     style='border-style: solid; border-width:0px; border-color:lightgray;'></td><td bgcolor=lightblue style='border-style: solid; border-width:1px; border-color:lightgray;'>co</td><td bgcolor=#FFCC00   style='border-style: solid; border-width:1px; border-color:lightgray;' align=center><small><b>&#181;dir</b></small></td><td bgcolor=white     style='border-style: solid; border-width:0px; border-color:lightgray;'>&nbsp;&nbsp;</td>";var z=1;for(var B=0;B<n.length;B++){var q=n[B].split(",")[0];C+="<td align=center style='border-style: solid; border-width:1px;'><small><b>"+sim_signals[q].name+"</b></small></td>";z++}C+="</tr>";var v="<center>";v+="<table style='table-layout:auto; border-style: solid: border-width:0px; border-collapse:collapse;'>";var w=0;var m="";var g="";var E="";for(var B=0;B<y.length;B++){var u=y[B]["mc-start"];var e=y[B].microcode;for(j=0;j<e.length;j++){if(++w%10==1){v=v+C}g="";if(typeof y[B].co!="undefined"){g=parseInt(y[B].co,2)}var r=y[B].signature.split(",")[0];m="";if(j==0){m+="<td style='border-style: solid; border-width:0px; border-color:lightgray;'><span class='badge'>"+r+"</span>&nbsp;</td><td style='border-style: solid; border-width:1px; border-color:lightgray;'>"+g+"</td>"}else{m+="<td style='border-style: solid; border-width:0px; border-color:lightgray;'>&nbsp;</td><td style='border-style: solid; border-width:1px; border-color:lightgray;'>&nbsp;</td>"}if(A){E="0x"+(u+j).toString(16)}else{E=u+j}m+="<td align=center  style='border-style: solid; border-width:1px; border-color:lightgray;' bgcolor=white>"+E+"</td><td bgcolor=white style='border-style: solid; border-width:0px; border-color:lightgray;'>&nbsp;</td>";var f=e[j];for(var x=0;x<n.length;x++){var q=n[x].split(",")[0];var D=parseInt(sim_signals[q].default_value);var p=false;if((typeof f[q]!="undefined")&&(!isNaN(parseInt(f[q])))){D=parseInt(f[q]);p=true}if((q=="SELA"||q=="SELB"||q=="SELC")&&(typeof f.MADDR!="undefined")&&(!isNaN(parseInt(f.MADDR)))){var b=parseInt(f.MADDR).toString(2);b="000000000000".substring(0,12-b.length)+b+"000";if(q=="SELA"){D=parseInt(b.substring(0,5),2);p=true}if(q=="SELB"){D=parseInt(b.substring(5,10),2);p=true}if(q=="SELC"){D=parseInt(b.substring(10,15),2);p=true}}if(A){var b=D.toString(2);var t=parseInt(sim_signals[q].nbits);D="00000000000000000000000000000000".substring(0,t-b.length)+b;var F=n[x].split(",")[1];var d=D.substring(0,F);var a=D.substring(F);D="<font color=green>"+d+"</font>"+a}if(p){m+="<td align=center style='border-style: solid; border-width:1px;'><b>"+D+"</b></td>"}else{m+="<td align=center style='border-style: solid; border-width:1px;'><font color='grey'>"+D+"</font></td>"}}v+="<tr>"+m+"</tr>"}}v+="</table></center>";return v}function labels2html_aux(a,g){var f="";var d="";for(var b=3;b>=0;b--){d="0x"+(parseInt(g)+b).toString(16);if(typeof a[d]!="undefined"){for(var e=0;e<a[d].length;e++){f=f+"<span class='badge'>"+a[d][e]+"</span>"}}else{f=f+"&nbsp;"}}return f}function mp2html(g,k,b){var e=new Object();for(l in k){if(typeof e[k[l]]=="undefined"){e[k[l]]=new Array()}e[k[l]].push(l)}var h="";h+="<center><table style='table-layout:auto; border-style: solid; border-width:0px;'><tr><th style='border-style: solid; border-width:0px;'>labels</th><th style='border-style: solid; border-width:1px;'>address</th><th style='border-style: solid; border-width:1px;'><table border=0 width=100%><tr align=center>  <td width=25% align=center><small><b>byte 3</b></small></td>  <td width=25% align=center><small><b>byte 2</b></small></td>  <td width=25% align=center><small><b>byte 1</b></small></td>  <td width=25% align=center><small><b>byte 0</b></small></td></tr><tr>  <td width=12% align=center >&nbsp;<sup>31&nbsp;&nbsp;......&nbsp;&nbsp;24</sup>&nbsp;</td>  <td width=12% align=center >&nbsp;<sup>23&nbsp;&nbsp;......&nbsp;&nbsp;16</sup>&nbsp;</td>  <td width=12% align=center >&nbsp;<sup>15&nbsp;&nbsp;......&nbsp;&nbsp;8</sup>&nbsp;</td>  <td width=12% align=center >&nbsp;<sup>7&nbsp;&nbsp;......&nbsp;&nbsp;0</sup>&nbsp;</td></tr></table><th style='border-style: solid; border-width:0px;' align=right>&nbsp;&nbsp;segment</th></tr>";var d="white";for(skey in b){c_begin=parseInt(b[skey].begin);c_end=parseInt(b[skey].end);d=b[skey].color;rows=0;var a="";for(var f=c_begin;f<c_end;f++){c="0x"+f.toString(16);if(typeof g[c]=="undefined"){continue}if(0==rows){h+="<tr style=\"font-family:'Consolas'; font-size:11pt;\"><td align=right  style='border-style: solid; border-width:0px;'>"+labels2html_aux(e,c)+"</td><td              style='border-style: solid; border-width:1px;' bgcolor="+d+">"+c.toUpperCase()+"</td><td              style='border-style: solid; border-width:1px;' bgcolor="+d+">"+g[c].substr(0,8)+"&nbsp;"+g[c].substr(8,8)+"&nbsp;"+g[c].substr(16,8)+"&nbsp;"+g[c].substr(24,8)+"</td><td rowspan="}else{a+="<tr style=\"font-family:'Consolas'; font-size:11pt;\"><td align=right  style='border-style: solid; border-width:0px;'>"+labels2html_aux(e,c)+"</td><td              style='border-style: solid; border-width:1px;' bgcolor="+d+">"+c.toUpperCase()+"</td><td              style='border-style: solid; border-width:1px;' bgcolor="+d+">"+g[c].substr(0,8)+"&nbsp;"+g[c].substr(8,8)+"&nbsp;"+g[c].substr(16,8)+"&nbsp;"+g[c].substr(24,8)+"</td></tr>"}rows++}if(0==rows){h+="<tr style=\"font-family:'Consolas'; font-size:12pt;\"><td>&nbsp;</td><td style='border-style: solid; border-width:1px;' bgcolor="+d+">0x"+parseInt(b[skey].begin).toString(16).toUpperCase()+"</td><td style='border-style: solid; border-width:1px;' bgcolor="+d+">&nbsp;</td><td rowspan=";a+="<tr style=\"font-family:'Consolas'; font-size:12pt;\"><td>&nbsp;</td><td style='border-style: solid; border-width:1px;' bgcolor="+d+">0x"+parseInt(b[skey].end).toString(16).toUpperCase()+"</td><td style='border-style: solid; border-width:1px;' bgcolor="+d+">&nbsp;</td><td>&nbsp;</td></tr>";rows=2}h+=rows+" align=right>"+b[skey].name+"&nbsp;</td></tr>"+a;if(b[skey].name!=".stack"){h+="<tr style=\"font-family:'Consolas'; font-size:12pt;\"><td>&nbsp;</td><td valign=middle align=center height=25px>...</td><td valign=middle align=center height=25px>...</td><td>&nbsp;</td></tr>"}}h+="</table></center><br>";return h}function segments2html(a){var d="<br>";d+=" <center> <table height=400px> <tr> <td><table style='border-style: solid' border=1 width=100% height=100%>";for(skey in a){if(a[skey].name!=".stack"){d+="<tr><td valign=middle align=center height=60px bgcolor="+a[skey].color+">"+a[skey].name+"</td></tr><tr><td valign=middle align=center height=25px>...</td></tr>"}}d+="<tr><td valign=middle align=center bgcolor="+a[".stack"].color+">"+a[".stack"].name+"</td></tr></table> </td> <td width=20px>&nbsp;</td> <td> <table style='border-style: solid; border-width:0px; width:100%; height:100%'>";var e="";var b="";for(skey in a){e="<tr>    <td valign=top align=left height=30px style=''>    <div id='compile_begin_"+a[skey].name+"'>"+a[skey].begin+"</div>    </td> </tr> <tr>    <td valign=bottom align=left height=30px style=''>    <div id='compile_end_"+a[skey].name+"'>"+a[skey].end+"</div>    </td> </tr>";if(a[skey].name!=".stack"){d+=e+"<tr><td valign=middle align=center height=25px>...</td></tr>"}else{b=e}}d+=b+" </table> </td> </tr> </table> </center>";return d}function assembly2html(d,k,g,f){var e="";var p="";var m="";var b="#F0F0F0";var a="";var q=new Object();for(l in k){if(typeof q[k[l]]=="undefined"){q[k[l]]=new Array()}q[k[l]].push(l)}var n=new Object();for(l in g){laddr="0x"+g[l].begin.toString(16);n[laddr]=l}a+="<center><table data-role=table class='table ui-responsive'><tbody>";for(l in f){if(b=="#F0F0F0"){b="#F8F8F8"}else{b="#F0F0F0"}f[l].bgcolor=b;p=f[l].source;m=f[l].source_original;e="&nbsp;";if(typeof q[l]!="undefined"){for(var h=0;h<q[l].length;h++){e=e+"<span class='label label-primary'>"+q[l][h]+"</span>"}}if(typeof n[l]!="undefined"){a+="<tr bgcolor='#FEFEFE'><td colspan='7' style='line-height:0.3;' align=left><small><font color=gray>"+n[l]+"</font></small></td>"}"</tr>";a+="<tr id='asmdbg"+l+"' bgcolor='"+f[l].bgcolor+"'    onclick='asmdbg_set_breakpoint("+l+");              if (event.stopPropagation) event.stopPropagation();'><td                                             width='2%'></td><td class='asm_break'  style='line-height:0.9; padding:5 0 0 0;' width='10%' align='center' id='bp"+l+"'>&nbsp;</td><td class='asm_addr'   style='line-height:0.9;' width='15%'>"+l+"</td><td class='asm_label1' style='line-height:0.9;' width='10%' align=right>"+e+"</td><td class='asm_ins'    style='line-height:0.9;' width='25%' align=left>"+p+"</td><td class='asm_label2' style='line-height:0.9;' width='10%' align=right>"+e+"</td><td class='asm_pins'   style='line-height:0.9;' width='20%' align=left>"+m+"</td></tr>"}a+="</tbody></table></center>";return a}var tri_state_names=["T1","T2","T3","T4","T5","T6","T7","T8","T9","T10","T11"];function check_buses(f){if($("#databus_fire").is(":visible")){$("#databus_fire").hide()}if((sim_signals.TD.value!=0)&&(sim_signals.R.value!=0)){$("#databus_fire").show();sim_states.BUS_DB.value=4294967295}if(tri_state_names.indexOf(f)==-1){return}var a="";var d=0;var e="";for(var b=0;b<tri_state_names.length;b++){a=tri_state_names[b];if(sim_signals[a].value!=0){d++;e=a}if(d>1){break}}if(d>0){update_draw(sim_signals[e],1)}if($("#internalbus_fire").is(":visible")){$("#internalbus_fire").hide()}if(d>1){$("#internalbus_fire").show();sim_states.BUS_IB.value=4294967295}}function check_behavior(){for(var f in sim_signals){for(var h in sim_signals[f].behavior){var a=sim_signals[f].behavior[h].split(";");for(var e=0;e<a.length;e++){var b=a[e].trim();var k=b.split(" ");if(""==b){continue}if(typeof(syntax_behavior[k[0]])=="undefined"){alert("ALERT: Unknown operation -> "+k[0]+" ("+b+")");return}if(k.length!=syntax_behavior[k[0]].nparameters){alert("ALERT: Behavior has an incorrect number of elements --> "+b+"/"+syntax_behavior[k[0]].nparameters);return}for(var d=1;d<k.length;d++){if("E"==syntax_behavior[k[0]].types[d-1]){var g=k[d].split("/");if(typeof(sim_states[g[0]])=="undefined"){alert("ALERT: Behavior has an undefined reference to a object state -> '"+b);return}}else{if("S"==syntax_behavior[k[0]].types[d-1]){var g=k[d].split("/");if(typeof(sim_signals[g[0]])=="undefined"){alert("ALERT: Behavior has an undefined reference to a signal -> '"+b);return}}}}}}}}function load_check(){if(0==sim_signals.length){alert("ALERT: empty signals!!!")}if(0==sim_states.length){alert("ALERT: empty states!!!")}check_behavior()}function compute_behavior(d){var e=d.split(";");for(var b=0;b<e.length;b++){e[b]=e[b].trim();if(""==e[b]){continue}var a=e[b].split(" ");syntax_behavior[a[0]].operation(a)}}function update_state(b){var a=0;var d="";switch(sim_signals[b].behavior.length){case 0:return;break;case 1:a=sim_signals[b].value;d=sim_signals[b].behavior[0];break;default:a=sim_signals[b].value;if(a<sim_signals[b].behavior.length){d=sim_signals[b].behavior[a]}else{alert("ALERT: there are more signals values than behaviors defined!!!!\nkey: "+b+" and signal value: "+a)}break}compute_behavior(d)}function get_value(a){if(typeof a.value=="function"){return a.value()}else{if(typeof a.default_value=="object"){return a.value}else{return a.value}}}function set_value(a,b){if(typeof a.value=="function"){a.value(b)}else{if(typeof a.default_value=="object"){a.value=b}else{a.value=b}}}function reset_value(b){if(typeof b.value=="function"){set_value(b,b.default_value)}else{if(typeof b.default_value=="object"){b.value=Object.create(b.default_value)}else{if(b instanceof Array){for(var a=0;a<b.length;a++){set_value(b[a],b[a].default_value)}}else{set_value(b,b.default_value)}}}}function show_memories_values(){show_main_memory(MP,get_value(sim_states.REG_PC),true);show_control_memory(MC,MC_dashboard,get_value(sim_states.REG_MICROADDR),true)}function update_signal_firmware(d){var a=get_simware();var g=-1;for(var b=0;b<a.firmware.length;b++){if(parseInt(a.firmware[b]["mc-start"])>get_value(sim_states.REG_MICROADDR)){break}g=b}if(-1==g){alert("A new 'unknown' instruction is inserted,\nplease edit it (co, nwords, etc.) in the firmware textarea.");var e=new Object();e.name="unknown";e.signature="unknown";e.signatureGlobal="unknown";e.co=0;e.nwords=0;e["mc-start"]=0;e.fields=new Array();e.microcode=new Array();e.microcomments=new Array();a.firmware.push(e);g=a.firmware.length-1}var h=get_value(sim_states.REG_MICROADDR)-parseInt(a.firmware[g]["mc-start"]);if(typeof a.firmware[g]["microcode"][h]=="undefined"){a.firmware[g]["microcode"][h]=new Object();a.firmware[g]["microcomments"][h]=""}a.firmware[g]["microcode"][h][d]=sim_signals[d].value;if(sim_signals[d].default_value==sim_signals[d].value){delete a.firmware[g]["microcode"][h][d]}var f=get_value(sim_states.REG_IR).toString(2);f="00000000000000000000000000000000".substring(0,32-f.length)+f;show_memories_values()}function update_signal_loadhelp(a,d){var b="help/signals-"+get_cfg("ws_idiom")+".html #"+d;$(a).load(b,function(f,e,g){if($(a).html()==""){$(a).html("<br>Sorry, No more details available for this signal.<p>\n")}$(a).trigger("create")});ga("send","event","help","help.signal","help.signal."+d)}function update_signal(b){if(false===get_cfg("is_interactive")){return}for(var p in sim_signals){for(var f=0;f<sim_signals[p].fire_name.length;f++){var a=sim_signals[p].fire_name[f].split(":");if(a[1]==b.currentTarget.id){var q=0;if(sim_signals[p].nbits==1){q=((sim_signals[p].value>>>0)+1)%2}var o="";var g="";var m="";var s=new Array();var d=0;var h=Math.pow(2,sim_signals[p].nbits);if(sim_signals[p].behavior.length==h){for(var e=0;e<sim_signals[p].behavior.length;e++){if(e==q){g=' checked="checked" '}else{g=" "}s=sim_signals[p].behavior[e].split(";");if(sim_signals[p].default_value!=e){o=s[0]}else{o="<b>"+s[0]+"</b>"}d=sim_signals[p].behavior[e].indexOf(";");if(-1==d){d=sim_signals[p].behavior[e].length}o="&nbsp;"+o+'<span style="color:#CCCCCC">'+sim_signals[p].behavior[e].substring(d)+"</span>";d=e.toString(10);m+='<li><label><input aria-label="value '+d+'" type="radio" name="ask_svalue"        value="'+d+'" '+g+" />"+o+"</label></li>"}}else{m+='<div><center><label><input aria-label="value for '+p+'" type="number" size=4 min=0 max='+(h-1)+' class=dial        name="ask_svalue" value="'+sim_signals[p].value+'"/>&nbsp;&nbsp; 0 - '+(h-1)+"</center></label></div>\n"}bootbox.dialog({title:"<center>"+p+':  <div class="btn-group">   <button onclick="$(\'#bot_signal\').carousel(0);"            type="button" class="btn btn-info" style="height:34px !important;">Value</button>   <button onclick="$(\'#bot_signal\').carousel(1); update_signal_loadhelp(\'#help2\',$(\'#ask_skey\').val());"            type="button" class="btn btn-success" style="height:34px !important;">Help</button>   <button type="button" class="btn btn-success dropdown-toggle"            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height:34px !important;">     <span class="caret"></span>     <span class="sr-only">Toggle Help Idiom</span>   </button>   <ul class="dropdown-menu">    <li><a href="#" onclick="set_cfg(\'ws_idiom\',\'es\'); save_cfg(); $(\'#bot_signal\').carousel(1);                              update_signal_loadhelp(\'#help2\',$(\'#ask_skey\').val());">ES</a></li>    <li><a href="#" onclick="set_cfg(\'ws_idiom\',\'en\'); save_cfg(); $(\'#bot_signal\').carousel(1);                              update_signal_loadhelp(\'#help2\',$(\'#ask_skey\').val());">EN</a></li>   </ul> </div></center>',message:'<div id="bot_signal" class="carousel slide" data-ride="carousel" data-interval="false">  <div class="carousel-inner" role="listbox">    <div class="item active">         <div style="max-height:70vh; width:inherit; overflow:auto;">         <form class="form-horizontal" style="white-space:nowrap;">         <input aria-label="value for '+p+'" id="ask_skey" name="ask_skey" type="hidden" value="'+p+'" class="form-control input-md">          <ol start="0">'+m+'         </ol>         </form>         </div>    </div>    <div class="item">         <div id=help2 style="max-height:70vh; width:inherit; overflow:auto;">Loading...</div>    </div>  </div></div>',value:sim_signals[p].value,animate:false,buttons:{close:{label:"Close",className:"btn-danger",callback:function(){}},success:{label:"Save",className:"btn-primary",callback:function(){p=$("#ask_skey").val();user_input=$("input[name='ask_svalue']:checked").val();if(typeof user_input=="undefined"){user_input=$("input[name='ask_svalue']").val()}sim_signals[p].value=user_input;if(true===get_cfg("is_interactive")){if(sim_signals[p].value!=sim_signals[p].default_value){sim_states.REG_MICROINS.value[p]=sim_signals[p].value}else{delete (sim_states.REG_MICROINS.value[p])}if(typeof MC[get_value(sim_states.REG_MICROADDR)]=="undefined"){MC[get_value(sim_states.REG_MICROADDR)]=new Object();MC_dashboard[get_value(sim_states.REG_MICROADDR)]=new Object()}MC[get_value(sim_states.REG_MICROADDR)][p]=sim_signals[p].value;MC_dashboard[get_value(sim_states.REG_MICROADDR)][p]={comment:"",breakpoint:false,notify:new Array()};update_signal_firmware(p);var k=get_simware();document.getElementById("inputFirmware").value=saveFirmware(k)}compute_behavior("FIRE "+p)}}}});$(".dial").knob({min:0,max:(h-1)}).val(sim_signals[p].value).trigger("change")}}}show_states();show_rf_values()}function update_memories(r){set_simware(r);var k=get_simware();MC=new Object();MC_dashboard=new Object();for(var d=0;d<k.firmware.length;d++){var q=k.firmware[d]["microcode"].length;var m=k.firmware[d]["mc-start"];for(var b=0;b<q;b++){var f=k.firmware[d]["microcomments"][b];MC[m]=k.firmware[d]["microcode"][b];MC_dashboard[m]={comment:f,breakpoint:false,notify:f.trim().split("notify:")};m++}}ROM=new Object();for(var d=0;d<k.firmware.length;d++){if("begin"==k.firmware[d]["name"]){continue}var p=k.firmware[d]["mc-start"];var n=parseInt(k.firmware[d]["co"],2);var a=0;if(typeof k.firmware[d]["cop"]!="undefined"){a=parseInt(k.firmware[d]["cop"],2)}var e=64*n+a;ROM[e]=p;k.cihash[e]=k.firmware[d]["signature"]}MP=new Object();for(var o in k.mp){var g=parseInt(o);var h=parseInt(k.mp[o].replace(/ /g,""),2);MP[g]=h}segments=new Object();for(var o in k.seg){segments[o]=k.seg[o]}show_main_memory(MP,1,false);show_control_memory(MC,MC_dashboard,1,false)}function init(d,b,a,e){load_check();init_states(d);init_rf(b);init_io(a);init_config(e)}function init_eventlistener(e){for(var d in sim_signals){for(var b=0;b<sim_signals[d].fire_name.length;b++){var f=sim_signals[d].fire_name[b].split(":");if(f[0]!=e){continue}var g=document.getElementById(f[0]).contentDocument;if(null==g){console.log('warning: unreferenced graphic element context named "'+f[0]+'".');continue}var a=g.getElementById(f[1]);if(null==a){console.log('warning: unreferenced graphic element named "'+f[0]+":"+f[1]+'".');continue}a.addEventListener("click",update_signal,false)}}}function check_if_can_execute(b){if((typeof segments[".ktext"]=="undefined")&&(typeof segments[".text"]=="undefined")){if(b){alert("code segment .ktext/.text does not exist!")}return false}var a=get_simware();if((!((typeof segments[".ktext"]!="undefined")&&(a.labels2.kmain)))&&(!((typeof segments[".text"]!="undefined")&&(a.labels2.main)))){if(b){alert("labels 'kmain' (in .ktext) or 'main' (in .text) do not exist!")}return false}return true}function check_if_can_continue(a){var b=parseInt(get_value(sim_states.REG_PC));if((parseInt(get_value(sim_states.REG_MICROADDR))==0)&&((b>=parseInt(segments[".ktext"].end))||(b<parseInt(segments[".ktext"].begin)))&&((b>=parseInt(segments[".text"].end))||(b<parseInt(segments[".text"].begin)))){if(a){alert("PC register points outside .ktext/.text code segments!")}return false}return true}function reset(){var a=get_simware();compute_behavior("RESET");if((typeof segments[".ktext"]!="undefined")&&(a.labels2.kmain)){set_value(sim_states.REG_PC,parseInt(a.labels2.kmain));show_asmdbg_pc()}else{if((typeof segments[".text"]!="undefined")&&(a.labels2.main)){set_value(sim_states.REG_PC,parseInt(a.labels2.main));show_asmdbg_pc()}}if((typeof segments[".stack"]!="undefined")&&(typeof sim_states.BR[FIRMWARE.stackRegister]!="undefined")){set_value(sim_states.BR[FIRMWARE.stackRegister],parseInt(segments[".stack"].begin))}compute_behavior("CLOCK");show_dbg_ir(get_value(sim_states.REG_IR_DECO));show_states();show_rf_values();show_rf_names();show_main_memory(MP,0,false);show_control_memory(MC,MC_dashboard,0,false);set_screen_content("")}function execute_microinstruction(){var a=get_value(sim_states.REG_MICROADDR);if(typeof MC[a]=="undefined"){return false}if((0==a)&&(check_if_can_continue(true)==false)){return false}compute_behavior("CLOCK");show_states();show_rf_values();show_dbg_mpc();return true}function execute_microprogram(){if(check_if_can_continue(true)==false){return false}do{compute_behavior("CLOCK")}while((0!=get_value(sim_states.REG_MICROADDR))&&(typeof MC[get_value(sim_states.REG_MICROADDR)]!="undefined"));show_states();show_rf_values();if(get_cfg("DBG_level")=="microinstruction"){show_dbg_mpc()}return true}function load_firmware(a){if(""==a.trim()){var d=new Object();d.error="Empty Firmware";return d}try{var d=JSON.parse(a);update_memories(d);d.error=null;return d}catch(b){try{var d=loadFirmware(a);if(d.error==null){update_memories(d)}return d}catch(b){var d=new Object();d.error="ERROR: at line: "+b.lineNumber+" and column: "+b.columnNumber;return d}}}function nextToken(d){while(("# \t\n\r".indexOf(d.text[d.t])!=-1)&&(d.t<d.text.length)){if(d.text[d.t]=="#"){var g=d.t+1;while(("\n".indexOf(d.text[d.t])==-1)&&(d.t<d.text.length)){d.t++}var f=d.t;var a=d.text.substring(g,f);a=a.trim();d.comments.push(a)}if(d.text[d.t]=="\n"){d.line++;d.newlines.push(d.t)}d.t++}if(("{},()=:".indexOf(d.text[d.t])!=-1)&&(d.t<d.text.length)){var a=d.text[d.t];d.t++;d.tokens.push(a);d.token_types.push("TOKEN");d.i=d.tokens.length-1;return d}if('"'==d.text[d.t]){var g=d.t;d.t++;while(('"'.indexOf(d.text[d.t])==-1)&&(d.t<d.text.length)){if("\\".indexOf(d.text[d.t])!=-1){d.t++}d.t++}d.t++;var f=d.t;var e="STRING"}else{var g=d.t;while(("{},()=:# \t\n\r".indexOf(d.text[d.t])==-1)&&(d.t<d.text.length)){d.t++}var f=d.t;var e="TOKEN"}var b=d.t;while(("# \t\n\r".indexOf(d.text[b])!=-1)&&(b<d.text.length)){if(d.text[b]=="#"){while(("\n".indexOf(d.text[b])==-1)&&(b<d.text.length)){b++}}b++}if(":"==d.text[b]){e="TAG";d.t=b+1}var a=d.text.substring(g,f);a=a.trim();if("TAG"==e){a=a+":"}d.tokens.push(a);d.token_types.push(e);d.i=d.tokens.length-1;return d}function getToken(a){return a.tokens[a.i]}function getTokenType(a){return a.token_types[a.i]}function isToken(a,b){return(getToken(a)==b.trim())}function langError(f,g){var a=0;if(f.newlines.length>0){a=f.newlines[f.newlines.length-1]+1}var d=0;if(f.newlines.length>1){d=f.newlines[f.newlines.length-2]+1}var b=d;var h=Math.min(f.t-1,a+32);for(;(typeof f.text[h+1]!="undefined")&&(f.text[h+1]!="\n");h++){}var k=h+2;h++;for(;(typeof f.text[h+1]!="undefined")&&(f.text[h+1]!="\n");h++){}h++;f.error="<pre style='background-color: inherit !important'>...\n";for(var e=b;e<h;e++){if(e==d){f.error+=" "+(f.line-1)+"\t"}if(e==a){f.error+="*"+f.line+"\t"}if(e==k){f.error+=" "+(f.line+1)+"\t"}if(typeof f.text[e]!="undefined"){f.error+=f.text[e]}else{f.error+="&lt;EOF&gt;"}}f.error+="\n...\n</pre>(*) Problem around line "+f.line+":<br>"+g+".<br>";ga("send","event","compile","compile.error","compile.error."+g);return f}function getLabelContext(a){return{t:a.t,line:a.line,newlines:a.newlines.slice()}}function setLabelContext(b,a){b.t=a.t;b.line=a.line;b.newlines=a.newlines}function getComments(a){return a.comments.join("\n")}function resetComments(a){a.comments=new Array()}function read_microprg(a){var e=new Array();var p=new Array();resetComments(a);if(!isToken(a,"{")){return langError(a,"Expected '{' not found")}nextToken(a);while(!isToken(a,"}")){var m=new Object();if(!isToken(a,"(")){var n=getToken(a);n=n.substring(0,n.length-1);if("TAG"!=getTokenType(a)){return langError(a,"Expected '<label>:' not found but '"+n+"'.")}for(var d in a.etiquetas){if(a.etiquetas[d]==n){return langError(a,"Label is repeated: "+getToken(a))}}a.etiquetas[a.contadorMC]=n;if(n.match("[a-zA-Z_0-9]*")[0]!=n){return langError(a,"Label format is not valid for '"+getToken(a)+"'")}nextToken(a)}if(!isToken(a,"(")){return langError(a,"Expected '(' not found")}nextToken(a);while(!isToken(a,")")){var g=getToken(a).toUpperCase();if(g=="MADDR"){nextToken(a);if(!isToken(a,"=")){return langError(a,"Expected '=' not found")}nextToken(a);var o=new Object();o.nombre=getToken(a);o.cycle=e.length;o.index=a.i;o.instruction=a.instrucciones.length;var f=0;for(var h in a.etiquetas){if(isToken(a,a.etiquetas[h])){m[g]=h.toString();f=1}}if(f==0){a.labelsNotFound.push(o)}nextToken(a);if(isToken(a,",")){nextToken(a)}continue}if(typeof sim_signals[g]=="undefined"){return langError(a,"Signal does not exists: '"+g+"'")}m[g]=1;nextToken(a);if(isToken(a,"=")){nextToken(a);m[g]=parseInt(getToken(a),2);if(getToken(a).match("[01]*")[0]!=getToken(a)){return langError(a,"Incorrect binary format: "+getToken(a))}if(m[g]>=Math.pow(2,sim_signals[g].nbits)){return langError(a,"Value out of range: "+getToken(a))}nextToken(a)}if(isToken(a,",")){nextToken(a)}}var b=getComments(a);p.push(b);resetComments(a);e.push(m);a.contadorMC++;nextToken(a);if(isToken(a,",")){nextToken(a)}}nextToken(a);return{microprograma:e,microcomments:p}}function loadFirmware(q){var e=new Object();e.line=1;e.error=null;e.i=0;e.contadorMC=0;e.etiquetas=new Object();e.labelsNotFound=new Array();e.instrucciones=new Array();e.co_cop=new Object();e.registers=new Array();e.text=q;e.tokens=new Array();e.token_types=new Array();e.t=0;e.newlines=new Array();e.pseudoInstructions=new Array();e.stackRegister=null;e.comments=new Array();nextToken(e);while(e.t<e.text.length){if(isToken(e,"registers")){nextToken(e);if(!isToken(e,"{")){return langError(e,"Expected '{' not found")}nextToken(e);while(!isToken(e,"}")){var f=getToken(e);nextToken(e);if(!isToken(e,"=")){return langError(e,"Expected '=' not found")}nextToken(e);e.registers[f]=getToken(e);nextToken(e);if(isToken(e,"(")){if(e.stackRegister!=null){return langError(e,"Duplicate definition of stack pointer")}nextToken(e);if(!isToken(e,"stack_pointer")){return langError(e,"Expected stack_pointer token not found")}e.stackRegister=f;nextToken(e);if(!isToken(e,")")){return langError(e,"Expected ')' not found")}nextToken(e)}if(isToken(e,",")){nextToken(e)}}nextToken(e);continue}if(isToken(e,"pseudoinstructions")){nextToken(e);if(!isToken(e,"{")){return langError(e,"Expected '{' not found")}nextToken(e);while(!isToken(e,"}")){var u=new Object();var t=new Object();t.signature="";t.name="";t.fields=new Array();t.name=getToken(e);t.signature=t.signature+getToken(e)+",";nextToken(e);while(!isToken(e,"{")){var n=new Object();n.name=getToken(e);n.type=getToken(e).replace("num","inm");n.type=n.type.replace(/[_0-9]+$/,"");switch(n.type){case"reg":case"inm":case"addr":case"address":break;default:return langError(e,"Invalid parameter '"+n.type+"'. It only allows the following fields: reg, num, inm, addr, address")}t.fields.push(n);t.signature=t.signature+getToken(e)+",";nextToken(e);if(isToken(e,",")){nextToken(e)}}nextToken(e);t.signature=t.signature.substr(0,t.signature.length-1).replace(/num/g,"inm");u.initial=t;var C=0;var E=new Object();E.signature="";var x=0;var d=false;while(!isToken(e,"}")){if(x==0){for(z=0;z<e.instrucciones.length;z++){if(e.instrucciones[z].name==getToken(e)){d=true;break}}if(!d){return langError(e,"Undefined instruction '"+getToken(e)+"'")}}if(getToken(e)==";"){x=0}else{x++}E.signature=E.signature+getToken(e)+" ";nextToken(e)}u.finish=E;u.finish.signature=u.finish.signature.replace(";","\n");e.pseudoInstructions.push(u);nextToken(e)}nextToken(e);continue}if(isToken(e,"begin")){var r=new Object();r.name=getToken(e);r["mc-start"]=e.contadorMC;nextToken(e);var G=read_microprg(e);if(typeof G.error!="undefined"){return G}r.signature="begin";r.signatureGlobal="begin";r.signatureUser="begin";r.signatureRaw="begin";r.microcode=G.microprograma;r.microcomments=G.microcomments;e.instrucciones.push(r);e.contadorMC=e.contadorMC+9;continue}var r=new Object();r.name=getToken(e);r["mc-start"]=e.contadorMC;var v="";var k="";var F="";var b=0;var o=new Array();v=getToken(e)+",";F=getToken(e)+" ";nextToken(e);while(isToken(e,",")){nextToken(e)}while(!isToken(e,"{")){while(isToken(e,",")){nextToken(e)}var B=false;if(!isToken(e,",")&&!isToken(e,"(")&&!isToken(e,")")){var D=new Object();var s=getToken(e);if(s[s.length-1]=="+"){s=s.substring(0,s.length-1);B=true}D.name=s;o.push(D);b++;v=v+s;F=F+s;nextToken(e);if(b>100){return langError(e,"more than 100 fields in a single instruction.")}if(s=="co"){return langError(e,"instruction field has 'co' as name.")}if(s=="nwords"){return langError(e,"instruction field has 'nwords' as name.")}}if(isToken(e,"(")){v=v+",(";if(B){F=F+"+("}else{F=F+" ("}nextToken(e);if(!isToken(e,",")&&!isToken(e,"(")&&!isToken(e,")")){var D=new Object();D.name=getToken(e);o.push(D);b++;v=v+getToken(e);F=F+getToken(e);nextToken(e)}else{return langError(e,"'token' is missing after '(' on: "+e.co_cop[r.co].signature)}if(isToken(e,")")){v=v+")";F=F+")";nextToken(e)}else{return langError(e,"')' is missing on: "+e.co_cop[r.co].signature)}}v=v+",";F=F+" "}v=v.substr(0,v.length-1);F=F.substr(0,F.length-1);r.signature=v;r.signatureGlobal=v;r.signatureUser=F;r.signatureRaw=F;nextToken(e);if(!isToken(e,"co")){return langError(e,"Expected keyword 'co' not found")}nextToken(e);if(!isToken(e,"=")){return langError(e,"Expected '=' not found")}nextToken(e);r.co=getToken(e);if((getToken(e).match("[01]*")[0]!=getToken(e))||(getToken(e).length!=6)){return langError(e,"Incorrect binary format on 'co': "+getToken(e))}if((typeof e.co_cop[r.co]!="undefined")&&(e.co_cop[r.co].cop==null)){return langError(e,"'co' is already been used by: "+e.co_cop[r.co].signature)}if(typeof e.co_cop[r.co]=="undefined"){e.co_cop[r.co]=new Object();e.co_cop[r.co].signature=r.signature;e.co_cop[r.co].cop=null}nextToken(e);if(isToken(e,",")){nextToken(e)}if(isToken(e,"cop")){nextToken(e);if(!isToken(e,"=")){return langError(e,"Expected '=' not found")}nextToken(e);r.cop=getToken(e);if((getToken(e).match("[01]*")[0]!=getToken(e))||(getToken(e).length!=4)){return langError(e,"Incorrect binary format on 'cop': "+getToken(e))}if((e.co_cop[r.co].cop!=null)&&(typeof e.co_cop[r.co].cop[r.cop]!="undefined")){return langError(e,"'co+cop' is already been used by: "+e.co_cop[r.co].cop[r.cop])}if(e.co_cop[r.co].cop==null){e.co_cop[r.co].cop=new Object()}e.co_cop[r.co].cop[r.cop]=r.signature;nextToken(e);if(isToken(e,",")){nextToken(e)}}if(!isToken(e,"nwords")){return langError(e,"Expected keyword 'nwords' not found")}nextToken(e);if(!isToken(e,"=")){return langError(e,"Expected '=' not found")}nextToken(e);r.nwords=getToken(e);nextToken(e);if(isToken(e,",")){nextToken(e)}var m=0;var a=new Object();while(m<b){var A=getToken(e);if(o[m]["name"]!=A){return langError(e,"Unexpected field found: '"+A+"'")}nextToken(e);if(!isToken(e,"=")){return langError(e,"Expected '=' not found")}nextToken(e);if(!isToken(e,"reg")&&!isToken(e,"inm")&&!isToken(e,"address")){return langError(e,"Incorrect type of field (reg, inm or address)")}o[m]["type"]=getToken(e);v=v.replace(","+o[m]["name"],","+o[m]["type"]);v=v.replace("("+o[m]["name"],"("+o[m]["type"]);v=v.replace(")"+o[m]["name"],")"+o[m]["type"]);F=F.replace(o[m]["name"],o[m]["type"]);r.signature=v;r.signatureUser=F;k=v.replace("address","num");k=k.replace("inm","num");r.signatureGlobal=k;nextToken(e);if(!isToken(e,"(")){return langError(e,"Expected '(' not found")}nextToken(e);o[m]["startbit"]=getToken(e);var h=parseInt(o[m]["startbit"]);if(h>32*parseInt(r.nwords)-1){return langError(e,"startbit out of range: "+getToken(e))}nextToken(e);if(!isToken(e,",")){return langError(e,"Expected ',' not found")}nextToken(e);o[m]["stopbit"]=getToken(e);var w=parseInt(o[m]["stopbit"]);if(w>32*parseInt(r.nwords)){return langError(e,"stopbit out of range: "+getToken(e))}for(var z=w;z<=h;z++){if(typeof a[z]!="undefined"){return langError(e,"overlapping field: "+o[m]["name"])}a[z]=1}nextToken(e);if(!isToken(e,")")){return langError(e,"Expected ')' not found")}nextToken(e);if(o[m]["type"]=="address"){if(getToken(e)!="abs"&&getToken(e)!="rel"){return langError(e,"Type of addressing incorrect (abs or rel)")}o[m]["address_type"]=getToken(e);nextToken(e)}if(isToken(e,",")){nextToken(e)}m++}r.fields=o;var G=read_microprg(e);if(typeof G.error!="undefined"){return G}r.microcode=G.microprograma;r.microcomments=G.microcomments;e.instrucciones.push(r);e.contadorMC=e.contadorMC+9;if(!isToken(e,"}")){return langError(e,"Expected '}' not found")}nextToken(e)}if(e.stackRegister==null){return langError(e,"Stack pointer register was not defined")}var p=false;for(var z=0;z<e.instrucciones.length;z++){if(e.instrucciones[z].name=="begin"){for(var y=0;y<e.instrucciones[z].microcode.length;y++){if((typeof e.etiquetas[y]!="undefined")&&(e.etiquetas[y]=="fetch")){p=true}}if(p===false){return langError(e,"label 'fetch' not defined")}}}if(p===false){return langError(e,"'begin' not found")}var g=0;if(e.labelsNotFound.length>0){for(var z=0;z<e.labelsNotFound.length;z++){for(var y in e.etiquetas){if(e.etiquetas[y]==e.labelsNotFound[z].nombre){e.instrucciones[e.labelsNotFound[z].instruction].microcode[e.labelsNotFound[z].cycle].MADDR=y;g++}}if(g==0){return langError(e,"MADDR label not found : "+e.labelsNotFound[z].nombre)}g=0}}var G=new Object();G.error=null;G.firmware=e.instrucciones;G.labels_firm=e.etiquetas;G.mp=new Object();G.seg=new Object();G.registers=e.registers;G.pseudoInstructions=e.pseudoInstructions;G.stackRegister=e.stackRegister;return G}function saveFirmware(a){var f="";for(var e=0;e<a.firmware.length;e++){f+=a.firmware[e].signatureRaw;f+=" {\n";if(typeof a.firmware[e].co!="undefined"){f+="\tco="+a.firmware[e].co+",\n"}if(typeof a.firmware[e].cop!="undefined"){f+="\tcop="+a.firmware[e].cop+",\n"}if(typeof a.firmware[e].nwords!="undefined"){f+="\tnwords="+a.firmware[e].nwords+",\n"}if(typeof a.firmware[e].fields!="undefined"){if(a.firmware[e].fields.length>0){for(var d=0;d<a.firmware[e].fields.length;d++){f+="\t"+a.firmware[e].fields[d].name+" = "+a.firmware[e].fields[d].type;f+="("+a.firmware[e].fields[d].startbit+","+a.firmware[e].fields[d].stopbit+")";if(a.firmware[e].fields[d].type=="address"){f+=a.firmware[e].fields[d].address_type}f+=",\n"}}}if(typeof a.firmware[e].microcode!="undefined"){var m=a.firmware[e]["mc-start"];if(a.firmware[e].name!="begin"){f+="\t{"}for(var d=0;d<a.firmware[e].microcode.length;d++){if(""!=a.firmware[e].microcomments[d]){f+="\n\t\t# "+a.firmware[e].microcomments[d]}if(typeof a.labels_firm[m]!="undefined"){f+="\n"+a.labels_firm[m]+":\t"}else{f+="\n\t\t"}f+="(";var g=0;for(var b in a.firmware[e].microcode[d]){if("MADDR"==b){var h=a.firmware[e].microcode[d][b];if(typeof a.labels_firm[h]=="undefined"){f+=b+"="+h.toString(2)+", "}else{f+=b+"="+a.labels_firm[h]+", "}continue}f+=b+"="+a.firmware[e].microcode[d][b].toString(2)+", ";g=1}if(g==1){f=f.substr(0,f.length-2)}f+="),";m++}f=f.substr(0,f.length-1);if(a.firmware[e].name!="begin"){f+="\n\t}"}}f+="\n}\n\n"}if((typeof a.registers!="undefined")&&(a.registers.length>0)){f+="registers\n{\n";for(var e=0;e<a.registers.length;e++){if(a.stackRegister==e){f+="\t"+e+"="+a.registers[e]+" (stack_pointer),\n"}else{f+="\t"+e+"="+a.registers[e]+",\n"}}f=f.substr(0,f.length-2);f+="\n}\n"}return f}function decode_instruction(b){var d=b.substring(0,6);var f=b.substring(28,32);var a=null;for(var e in FIRMWARE.firmware){if(FIRMWARE.firmware[e].name=="begin"){continue}if((FIRMWARE.firmware[e].co==d)&&(typeof FIRMWARE.firmware[e].cop=="undefined")){a=FIRMWARE.firmware[e];break}if((FIRMWARE.firmware[e].co==d)&&(typeof FIRMWARE.firmware[e].cop!="undefined")&&(FIRMWARE.firmware[e].cop==f)){a=FIRMWARE.firmware[e];break}}return a}function decode_ram(){var d="\n";for(var a in MP){var b=MP[a].toString(2);b="00000000000000000000000000000000".substring(0,32-b.length)+b;d+="0x"+parseInt(a).toString(16)+":"+decode_instruction(b)+"\n"}return d}const BYTE_LENGTH=8;const WORD_BYTES=4;const WORD_LENGTH=WORD_BYTES*BYTE_LENGTH;directives=new Object();directives[".kdata"]={name:".kdata",kindof:"segment",size:0};directives[".ktext"]={name:".ktext",kindof:"segment",size:0};directives[".data"]={name:".data",kindof:"segment",size:0};directives[".text"]={name:".text",kindof:"segment",size:0};directives[".byte"]={name:".byte",kindof:"datatype",size:1};directives[".half"]={name:".half",kindof:"datatype",size:2};directives[".word"]={name:".word",kindof:"datatype",size:4};directives[".space"]={name:".space",kindof:"datatype",size:1};directives[".ascii"]={name:".ascii",kindof:"datatype",size:1};directives[".asciiz"]={name:".asciiz",kindof:"datatype",size:1};directives[".align"]={name:".align",kindof:"datatype",size:0};function get_datatype_size(a){if(typeof directives[a]=="undefined"){console.log("data type: "+a+" is not defined!!!\n");return 0}return directives[a].size}function isTokenKindOf(b,a){if(typeof directives[b]=="undefined"){return false}return(directives[b].kindof==a)}function is_directive(a){return(typeof directives[a]!="undefined")}function is_directive_segment(a){return isTokenKindOf(a,"segment")}function is_directive_datatype(a){return isTokenKindOf(a,"datatype")}function isDecimal(b){if(b.length>1&&b[0]=="0"){return false}if(!isNaN(parseFloat(b))&&isFinite(b)){var a=parseInt(b);if(typeof b=="string"&&b.includes(".")){alert("Truncating conversion has occurred: "+b+" became "+a)}return a}return false}function isOctal(d){if(d.substring(0,1)=="0"){var b=d.substring(1).replace(/\b0+/g,"");var a=parseInt(b,8);return(a.toString(8)===b)?a:false}return false}function isHex(d){if(d.substring(0,2).toLowerCase()=="0x"){var b=d.substring(2).toLowerCase().replace(/\b0+/g,"");if(b==""){b="0"}var a=parseInt(b,16);return(a.toString(16)===b)?a:false}return false}function isChar(a){if(a[0]=="'"&&a[2]=="'"){return a.charCodeAt(1)}return false}function decimal2binary(d,b){var a=d.toString(2);if(a.length>WORD_LENGTH){return[a,b-a.length]}a=(d>>>0).toString(2);if(d>=0){return[a,b-a.length]}a="1"+a.replace(/^[1]+/g,"");if(a.length>b){return[a,b-a.length]}a="1".repeat(b-a.length)+a;return[a,b-a.length]}function isValidTag(a){if(!(isDecimal(a[0])===false)){return false}var b=/[^a-z,_\d]/i;return !(b.test(a))}function sum_array(b){return b.reduce(function(e,d){return e+d},0)}function get_candidate(f,a){var d=false;var e=new Object();var g=new Object();for(i=0;i<f.length;i++){if(f[i]){e[i]=a[i].nwords;g[a[i].signature]=0}}if(Object.keys(g).length==1){var b=false;for(i in e){if(b==false){b=e[i];d=i}else{if(b==e[i]){d=false}else{if(b>e[i]){b=e[i];d=i}}}}}return d?parseInt(d):d}function reset_assembly(a){return"0".repeat(WORD_LENGTH*a)}function assembly_replacement(g,d,e,b,a){var f=g.substring(0,g.length-e+a);g=f+d+g.substring(g.length-b);return g}function assembly_co_cop(d,a,b){if(a!==false){d=assembly_replacement(d,a,WORD_LENGTH,WORD_LENGTH-6,0)}if(b!==false){d=assembly_replacement(d,b,4,0,0)}return d}function writememory_and_reset(b,d,a){if(d.byteWord>=WORD_BYTES){b["0x"+d.seg_ptr.toString(16)]=d.machineCode;d.seg_ptr=d.seg_ptr+WORD_BYTES;d.byteWord=0;d.machineCode=reset_assembly(a)}}function is_end_of_file(a){return""===getToken(a)&&a.t>=a.text.length}function treatControlSequences(a){var b=new Object();b.string="";b.error=false;for(i=0;i<a.length;i++){if("\\"!=a[i]){b.string=b.string+a[i];continue}i++;switch(a[i]){case"b":b.string=b.string+"\b";break;case"f":b.string=b.string+"\f";break;case"n":b.string=b.string+"\n";break;case"r":b.string=ret_string+"\r";break;case"t":b.string=b.string+"\t";break;case"v":b.string=b.string+"\v";break;case"a":b.string=b.string+String.fromCharCode(7);break;case"'":b.string=b.string+"'";break;case'"':b.string=b.string+'"';break;case"0":b.string=b.string+"\0";break;default:b.string="Unknown escape char '\\"+a[i]+"'";b.error=true;return b}}return b}function read_data(b,q,m){var k=getToken(b);var g=new Object();g.byteWord=0;g.machineCode=reset_assembly(1);g.seg_ptr=m.seg[k].begin;nextToken(b);while(!is_directive_segment(getToken(b))&&!is_end_of_file(b)){var r="";while(!is_directive_datatype(getToken(b))&&!is_end_of_file(b)){r=getToken(b);if("TAG"!=getTokenType(b)){return langError(b,"Expected tag or directive but found '"+r+"' instead")}var t=r.substring(0,r.length-1);if(!isValidTag(t)){return langError(b,"A tag must follow an alphanumeric format (starting with a letter or underscore) but found '"+t+"' instead")}if(b.firmware[t]){return langError(b,"A tag can not have the same name as an instruction ("+t+")")}if(m.labels2[t]){return langError(b,"Repeated tag: '"+t+"'")}m.labels2[t]="0x"+(g.seg_ptr+g.byteWord).toString(16);nextToken(b)}if(is_end_of_file(b)){break}var d=getToken(b);if((".word"==d)||(".half"==d)||(".byte"==d)){nextToken(b);var f=getToken(b);while(!is_directive(getToken(b))&&!is_end_of_file(b)){var e;var n=false;if((e=isOctal(f))!==false){}else{if((e=isHex(f))!==false){}else{if((e=isDecimal(f))!==false){}else{if((e=isChar(f))!==false){}else{if(".word"==d){if(!isValidTag(f)){return langError(b,"A tag must follow an alphanumeric format (starting with a letter or underscore) but found '"+f+"' instead")}if(b.firmware[f]){return langError(b,"A tag can not have the same name as an instruction ("+f+")")}e=0;n=true}else{return langError(b,"Expected value for numeric datatype but found '"+f+"' instead")}}}}}var s=get_datatype_size(d);var p=decimal2binary(e,s*BYTE_LENGTH);num_bits=p[0];free_space=p[1];if(free_space<0){return langError(b,"Expected value that fits in a '"+d+"' ("+s*BYTE_LENGTH+" bits), but inserted '"+f+"' ("+num_bits.length+" bits) instead")}writememory_and_reset(m.mp,g,1);while(((g.seg_ptr+g.byteWord)%s)!=0){g.byteWord++;writememory_and_reset(m.mp,g,1)}if(""!=r){m.labels2[r.substring(0,r.length-1)]="0x"+(g.seg_ptr+g.byteWord).toString(16);r=""}if(n){m.labels["0x"+g.seg_ptr.toString(16)]={name:f,addr:g.seg_ptr,startbit:31,stopbit:0,rel:undefined,nwords:1,labelContext:getLabelContext(b)}}g.machineCode=assembly_replacement(g.machineCode,num_bits,BYTE_LENGTH*(s+g.byteWord),BYTE_LENGTH*g.byteWord,free_space);g.byteWord+=s;nextToken(b);if(","==getToken(b)){nextToken(b)}if(is_directive(getToken(b))||("TAG"==getTokenType(b))||"."==getToken(b)[0]){break}f=getToken(b)}}else{if(".space"==d){nextToken(b);var f=getToken(b);if(!isDecimal(f)){return langError(b,"Expected number of bytes to reserve in .space but found '"+f+"' as number")}if(f<0){return langError(b,"Expected positive number but found '"+f+"' as positive number")}for(i=0;i<f;i++){writememory_and_reset(m.mp,g,1);g.byteWord++}nextToken(b)}else{if(".align"==d){nextToken(b);var f=getToken(b);if(!isDecimal(f)&&f>=0){return langError(b,"Expected the align parameter as positive number but found '"+f+"'. Remember that number is the power of two for alignment, see MIPS documentation..")}writememory_and_reset(m.mp,g,1);var h=Math.pow(2,parseInt(f));switch(h){case 1:break;case 2:if(g.byteWord&1==1){g.byteWord++}break;default:while(true){writememory_and_reset(m.mp,g,1);if(g.seg_ptr%h==0&&g.byteWord==0){break}g.byteWord++}}nextToken(b)}else{if(".ascii"==d||".asciiz"==d){nextToken(b);var f=getToken(b);var o=treatControlSequences(f);if(true==o.error){return langError(b,o.string)}f=o.string;while(!is_directive(getToken(b))&&!is_end_of_file(b)){writememory_and_reset(m.mp,g,1);if(""==f){return langError(b,"String is not closed (forgot to end it with quotation marks)")}if("STRING"!=getTokenType(b)){return langError(b,"Expected string between quotation marks but found '"+f+"' instead")}for(i=0;i<f.length;i++){writememory_and_reset(m.mp,g,1);if(f[i]=='"'){continue}num_bits=f.charCodeAt(i).toString(2);g.machineCode=assembly_replacement(g.machineCode,num_bits,BYTE_LENGTH*(1+g.byteWord),BYTE_LENGTH*g.byteWord,BYTE_LENGTH-num_bits.length);g.byteWord++}if(".asciiz"==d){writememory_and_reset(m.mp,g,1);num_bits="\0".charCodeAt(0).toString(2);g.machineCode=assembly_replacement(g.machineCode,num_bits,BYTE_LENGTH*(1+g.byteWord),BYTE_LENGTH*g.byteWord,BYTE_LENGTH-num_bits.length);g.byteWord++}nextToken(b);if(","==getToken(b)){nextToken(b)}if(is_directive(getToken(b))||("TAG"==getTokenType(b))||"."==getToken(b)[0]){break}f=getToken(b);o=treatControlSequences(f);if(true==o.error){return langError(b,o.string)}f=o.string}}else{return langError(b,"Unexpected datatype name '"+d)}}}}}if(g.byteWord>0){m.mp["0x"+g.seg_ptr.toString(16)]=g.machineCode;g.seg_ptr=g.seg_ptr+WORD_BYTES}m.seg[k].end=g.seg_ptr}function read_text(R,b,D){var G=getToken(R);var g=D.seg[G].begin;var C=R.firmware;var x=R.pseudoInstructions;var u=false;var e=-1;var Q=new Object();for(i=0;i<b.registers.length;i++){var n="$"+i;Q[n]=i;Q[b.registers[i]]=Q[n]}nextToken(R);while(!is_directive_segment(getToken(R))&&!is_end_of_file(R)){while(!u&&typeof C[getToken(R)]=="undefined"&&!is_end_of_file(R)){var d=getToken(R);if("TAG"!=getTokenType(R)){return langError(R,"Expected tag or instruction but found '"+d+"' instead")}var L=d.substring(0,d.length-1);if(!isValidTag(L)){return langError(R,"A tag must follow an alphanumeric format (starting with a letter or underscore) but found '"+L+"' instead")}if(C[L]){return langError(R,"A tag can not have the same name as an instruction ("+L+")")}if(D.labels2[L]){return langError(R,"Repeated tag: '"+L+"'")}D.labels2[L]="0x"+g.toString(16);nextToken(R)}if(is_end_of_file(R)){break}if(!u){var w=getToken(R);var m=[]}else{var w=m[M][e++]}var N=[];var a=[];var k=[];var P=0;var K=[];for(i=0;i<C[w].length;i++){N[i]=C[w][i].signature.split(",");a[i]=C[w][i].signatureUser.split(" ");N[i].shift();a[i].shift();k[i]=1;K[i]=[];P=Math.max(P,N[i].length);if(x[w]){m[i]=C[w][i].finish.replace(/ ,/g,"").replace(/num/g,"inm").split(" ");m[i].pop();u=true;var O=0;var t=new Object}}var J=[];J[0]=w;for(i=0;i<P;i++){if(e==-1){nextToken(R);if(","==getToken(R)){nextToken(R)}var I=getToken(R)}else{var F=m[M][e++];if(t[F]){var I=t[F]}else{var I=F}}var H;if("TAG"!=getTokenType(R)&&!C[I]){J[i+1]=I}for(j=0;j<k.length;j++){if(k[j]==0){continue}if(i>=N[j].length){if("TAG"!=getTokenType(R)&&!C[I]){k[j]=0}continue}var h=C[w][j].fields[i];var f=h.startbit-h.stopbit+1;var v=false;var p=false;switch(h.type){case"address":case"inm":if(u&&"sel"==I){e++;var z=m[M][e++];var q=m[M][e++];var I=t[m[M][e++]];e++;p=true}if((H=isOctal(I))!==false){}else{if((H=isHex(I))!==false){}else{if((H=isDecimal(I))!==false){}else{if((H=isChar(I))!==false){}else{if(!isValidTag(I)){var A="A tag must follow an alphanumeric format (starting with a letter or underscore) but found '"+I+"' instead";k[j]=0;break}if(C[I]){var A="A tag can not have the same name as an instruction ("+I+")";k[j]=0;break}v=true}}}}if(p){E=decimal2binary(H,WORD_LENGTH);if(E[1]<0){return langError(R,"'"+I+"' is bigger than "+WORD_LENGTH+" bits")}H="0".repeat(E[1])+E[0];H=H.substring(WORD_LENGTH-z-1,WORD_LENGTH-q);H=parseInt(H,2);J[i+1]="0x"+H.toString(16)}if(!v){var E=decimal2binary(H,f);if(h.type=="address"&&"rel"==h.address_type){E=decimal2binary(H-g-WORD_BYTES,f)}}break;case"reg":var n=false;if("("==I){if("(reg)"!=N[j][i]){var A="Expected register but found register beween parenthesis";k[j]=0;break}if(e==-1){nextToken(R);I=getToken(R)}else{I=t[m[M][e++]]}n=true}else{if("(reg)"==N[j][i]){var A="Expected register between parenthesis but found '"+I+"' instead";k[j]=0;break}}if(typeof Q[I]=="undefined"){var A="Expected register ($1, ...) but found '"+I+"' instead";k[j]=0;break}if(n){J[i+1]="("+I+")";if(e==-1){nextToken(R);n=getToken(R)}else{n=m[M][e++]}if(")"!=n){var A="String without end parenthesis ')'";k[j]=0;break}}H=isDecimal(Q[I]);var E=decimal2binary(H,f);break;default:return langError(R,"An unknown error ocurred (1)")}if(k[j]==1&&!v){if(E[1]<0){if(h.type=="address"&&"rel"==h.address_type){A="Relative value ("+(H-g-WORD_BYTES)+" in decimal) needs "+E[0].length+" bits in binary but there is space for only "+f+" bits"}else{var A="'"+I+"' needs "+E[0].length+" bits in binary but there is space for only "+f+" bits"}k[j]=0}}if(k[j]==1&&(!(u&&e==-1))){K[j][i]={num_bits:(v?false:E[0]),free_space:(v?false:E[1]),startbit:h.startbit,stopbit:h.stopbit,rel:(v?h.address_type:false),islabel:v,field_name:I}}}if(sum_array(k)==0){break}if("TAG"==getTokenType(R)||C[I]){break}}var M;for(i=0;i<k.length;i++){if(k[i]==1){M=i}}var B="";for(i=0;i<C[w].length;i++){if(i>0&&i<C[w].length-1){B+=", "}if(i>0&&i==C[w].length-1){B+=" or "}B+="'"+C[w][i].signatureUser+"'"}var y=sum_array(k);if(y==0){if(k.length==1){return langError(R,A+". Remember that the instruction format has been defined as: "+B)}return langError(R,"Instruction and fields don't match with microprogram. Remember that the instruction formats have been defined as: "+B+". Please check the microcode. Probably you forgot to add a field, a number does not fit in its space, or you just used a wrong instruction")}if(y>1){M=get_candidate(k,C[w]);if(M===false){return langError(R,"Instruction and fields match with more than one microprogram. Please check the microcode. Currently, the instruction format can be: "+B)}}if(u){if(e==-1){var o="";for(i=0;i<J.length;i++){o=o+J[i]+" "}o=o.substring(0,o.length-1);for(i=0;i<N[M].length;i++){t[N[M][i]]=J[i+1]}e++;continue}else{O++}if(O>1){o="&nbsp;"}if(m[M][e]=="\n"){e++}}var r=reset_assembly(C[w][M].nwords);r=assembly_co_cop(r,C[w][M].co,C[w][M].cop);for(i=0;i<K[M].length;i++){if(K[M][i].islabel){D.labels["0x"+g.toString(16)]={name:K[M][i].field_name,addr:g,startbit:K[M][i].startbit,stopbit:K[M][i].stopbit,rel:K[M][i].rel,nwords:C[w][M].nwords,labelContext:getLabelContext(R)}}else{r=assembly_replacement(r,K[M][i].num_bits,K[M][i].startbit-(-1),K[M][i].stopbit,K[M][i].free_space)}}s_def=J[0];for(i=0,j=1;i<a[M].length;i++,j++){switch(a[M][i]){case"address":case"inm":case"reg":case"(reg)":s_def=s_def+" "+J[j];break;default:s_def=s_def+" "+J[j]+J[j+1];j++}}if(!u){var o=s_def}for(i=C[w][M].nwords-1;i>=0;i--){if(i<C[w][M].nwords-1){s_def="---"}D.assembly["0x"+g.toString(16)]={breakpoint:false,binary:r.substring(i*WORD_LENGTH,(i+1)*WORD_LENGTH),source:s_def,source_original:o};D.mp["0x"+g.toString(16)]=r.substring(i*WORD_LENGTH,(i+1)*WORD_LENGTH);g=g+WORD_BYTES}if(!u&&P==N[M].length){nextToken(R)}if(u&&e==m[M].length){e=-1;O=0;u=false;nextToken(R)}if(R.t>=R.text.length){break}}D.seg[G].end=g}function simlang_compile(r,s){var d=new Object();d.line=1;d.error=null;d.i=0;d.contadorMC=0;d.etiquetas=new Object();d.labelsNotFound=new Array();d.instrucciones=new Array();d.co_cop=new Object();d.registers=new Array();d.text=r;d.tokens=new Array();d.token_types=new Array();d.t=0;d.newlines=new Array();d.pseudoInstructions=new Array();d.stackRegister=null;d.firmware=new Object();d.pseudoInstructions=new Object();d.comments=new Array();for(i=0;i<s.firmware.length;i++){var e=s.firmware[i];if(typeof d.firmware[e.name]=="undefined"){d.firmware[e.name]=new Array()}d.firmware[e.name].push({name:e.name,nwords:parseInt(e.nwords),co:(typeof e.co!="undefined"?e.co:false),cop:(typeof e.cop!="undefined"?e.cop:false),fields:(typeof e.fields!="undefined"?e.fields:false),signature:e.signature,signatureUser:(typeof e.signatureUser!="undefined"?e.signatureUser:e.name),isPseudoinstruction:false})}for(i=0;i<s.pseudoInstructions.length;i++){var g=s.pseudoInstructions[i].initial;var o=s.pseudoInstructions[i].finish;if(typeof d.pseudoInstructions[g.name]=="undefined"){d.pseudoInstructions[g.name]=0;d.firmware[g.name]=new Array()}d.pseudoInstructions[g.name]++;d.firmware[g.name].push({name:g.name,fields:(typeof g.fields!="undefined"?g.fields:false),signature:g.signature,signatureUser:g.signature.replace(/,/g," "),finish:o.signature,isPseudoinstruction:true})}var h=new Object();h.seg={".kdata":{name:".kdata",begin:0,end:255,color:"#FF99CC",kindof:"data"},".ktext":{name:".ktext",begin:256,end:4095,color:"#A9D0F5",kindof:"text"},".data":{name:".data",begin:4096,end:32767,color:"#FACC2E",kindof:"data"},".text":{name:".text",begin:32768,end:65280,color:"#BEF781",kindof:"text"},".stack":{name:".stack",begin:65535,end:65535,color:"#F1F2A3",kindof:"stack"}};h.mp=new Object();h.labels=new Object();h.labels2=new Object();h.assembly=new Object();data_found=false;text_found=false;nextToken(d);while(!is_end_of_file(d)){var f=getToken(d);if(typeof h.seg[f]=="undefined"){return langError(d,"Expected .data/.text/... segment but found '"+f+"' as segment")}if("data"==h.seg[f].kindof){read_data(d,s,h);data_found=true}if("text"==h.seg[f].kindof){read_text(d,s,h);text_found=true}if(d.error!=null){h.error=d.error;return h}}for(i in h.labels){var p=h.labels2[h.labels[i].name];if(typeof p==="undefined"){setLabelContext(d,h.labels[i].labelContext);return langError(d,"Label '"+h.labels[i].name+"' used but not defined in the assembly code")}var n="";var b=h.labels[i].addr;for(j=0;j<h.labels[i].nwords;j++){n=h.mp["0x"+b.toString(16)]+n;b+=WORD_BYTES}var t=h.labels[i].startbit-h.labels[i].stopbit+1;var q;if((q=isHex(p))!==false){var m=decimal2binary(q,t);num_bits=m[0];free_space=m[1];var k="'"+h.labels[i].name+"' needs "+num_bits.length+" bits in binary but there is space for only "+t+" bits";if("rel"==h.labels[i].rel){var m=decimal2binary(q-h.labels[i].addr-WORD_BYTES,t);num_bits=m[0];free_space=m[1];k="Relative value ("+(q-h.labels[i].addr-WORD_BYTES)+" in decimal) needs "+num_bits.length+" bits in binary but there is space for only "+t+" bits"}}else{return langError(d,"Unexpected error (2)")}if(free_space<0){setLabelContext(d,h.labels[i].labelContext);return langError(d,k)}n=assembly_replacement(n,num_bits,h.labels[i].startbit-(-1),h.labels[i].stopbit,free_space);b=h.labels[i].addr;for(j=h.labels[i].nwords-1;j>=0;j--){h.mp["0x"+b.toString(16)]=n.substring(j*WORD_LENGTH,(j+1)*WORD_LENGTH);b+=WORD_BYTES}}if(text_found){if((typeof h.labels2.main=="undefined")&&(typeof h.labels2.kmain=="undefined")){return langError(d,"Tags 'main' or 'kmain' are not defined in the text segment(s). It is compulsory to define at least one of those tags in order to execute a program")}}return h};